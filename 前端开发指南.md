# Mall-Go 前端开发指南

## 🎯 项目概述

**后端API地址**: http://localhost:8080  
**项目完成度**: 91%  
**核心功能**: 完全就绪  
**认证方式**: JWT Token  
**数据格式**: JSON  

## 🚀 快速开始

### 1. 环境准备

确保后端服务正常运行：
```bash
cd mall-go
go run cmd/server/main.go
```

验证服务状态：
```bash
curl http://localhost:8080/health
# 预期响应: {"message":"Mall Go API is running","status":"ok"}
```

### 2. 前端项目初始化

#### React项目示例
```bash
npx create-react-app mall-frontend
cd mall-frontend
npm install axios react-router-dom
```

#### Vue项目示例
```bash
npm create vue@latest mall-frontend
cd mall-frontend
npm install axios vue-router pinia
```

## 🔧 HTTP客户端配置

### Axios配置 (推荐)

```javascript
// src/api/client.js
import axios from 'axios';

// 创建axios实例
const apiClient = axios.create({
  baseURL: 'http://localhost:8080',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// 请求拦截器 - 自动添加认证token
apiClient.interceptors.request.use(
  config => {
    const token = localStorage.getItem('mall_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  error => Promise.reject(error)
);

// 响应拦截器 - 统一错误处理
apiClient.interceptors.response.use(
  response => {
    // 检查业务状态码
    if (response.data.code !== 200) {
      throw new Error(response.data.message || '请求失败');
    }
    return response.data;
  },
  error => {
    // 处理HTTP错误
    if (error.response?.status === 401) {
      // Token过期，清除本地存储并跳转登录
      localStorage.removeItem('mall_token');
      localStorage.removeItem('mall_user');
      window.location.href = '/login';
    }
    
    const message = error.response?.data?.message || error.message || '网络错误';
    throw new Error(message);
  }
);

export default apiClient;
```

## 🔐 用户认证管理

### 认证状态管理

```javascript
// src/store/auth.js (Pinia/Vuex/Redux)
import apiClient from '../api/client';

export const useAuthStore = () => {
  const state = {
    user: null,
    token: null,
    isAuthenticated: false
  };

  // 登录
  const login = async (username, password) => {
    try {
      const response = await apiClient.post('/api/v1/users/login', {
        username,
        password
      });

      const { token, user } = response.data;
      
      // 保存到本地存储
      localStorage.setItem('mall_token', token);
      localStorage.setItem('mall_user', JSON.stringify(user));
      
      // 更新状态
      state.token = token;
      state.user = user;
      state.isAuthenticated = true;
      
      return { success: true, user };
    } catch (error) {
      return { success: false, message: error.message };
    }
  };

  // 注册
  const register = async (userData) => {
    try {
      const response = await apiClient.post('/api/v1/users/register', userData);
      return { success: true, data: response.data };
    } catch (error) {
      return { success: false, message: error.message };
    }
  };

  // 登出
  const logout = () => {
    localStorage.removeItem('mall_token');
    localStorage.removeItem('mall_user');
    state.token = null;
    state.user = null;
    state.isAuthenticated = false;
  };

  // 初始化认证状态
  const initAuth = () => {
    const token = localStorage.getItem('mall_token');
    const user = localStorage.getItem('mall_user');
    
    if (token && user) {
      state.token = token;
      state.user = JSON.parse(user);
      state.isAuthenticated = true;
    }
  };

  return {
    state,
    login,
    register,
    logout,
    initAuth
  };
};
```

### 路由守卫

```javascript
// src/router/guards.js
import { useAuthStore } from '../store/auth';

export const authGuard = (to, from, next) => {
  const authStore = useAuthStore();
  
  // 需要认证的路由
  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);
  
  if (requiresAuth && !authStore.state.isAuthenticated) {
    next('/login');
  } else {
    next();
  }
};
```

## 📦 API服务封装

### 商品服务

```javascript
// src/api/products.js
import apiClient from './client';

export const productService = {
  // 获取商品列表
  async getProducts(params = {}) {
    const response = await apiClient.get('/api/v1/products', { params });
    return response.data;
  },

  // 获取商品详情
  async getProduct(id) {
    const response = await apiClient.get(`/api/v1/products/${id}`);
    return response.data;
  },

  // 获取商品分类
  async getCategories() {
    const response = await apiClient.get('/api/v1/categories');
    return response.data;
  },

  // 搜索商品
  async searchProducts(keyword, categoryId = null, page = 1, pageSize = 10) {
    const params = { keyword, page, page_size: pageSize };
    if (categoryId) params.category_id = categoryId;
    
    const response = await apiClient.get('/api/v1/products', { params });
    return response.data;
  }
};
```

### 购物车服务

```javascript
// src/api/cart.js
import apiClient from './client';

export const cartService = {
  // 获取购物车
  async getCart() {
    const response = await apiClient.get('/api/v1/cart');
    return response.data;
  },

  // 添加商品到购物车
  async addToCart(productId, quantity = 1, skuId = null) {
    const data = { product_id: productId, quantity };
    if (skuId) data.sku_id = skuId;
    
    const response = await apiClient.post('/api/v1/cart/items', data);
    return response.data;
  },

  // 更新购物车商品
  async updateCartItem(itemId, quantity, selected = true) {
    const response = await apiClient.put(`/api/v1/cart/items/${itemId}`, {
      quantity,
      selected
    });
    return response.data;
  },

  // 删除购物车商品
  async removeCartItem(itemId) {
    const response = await apiClient.delete(`/api/v1/cart/items/${itemId}`);
    return response.data;
  },

  // 清空购物车
  async clearCart() {
    const response = await apiClient.delete('/api/v1/cart');
    return response.data;
  }
};
```

### 订单服务

```javascript
// src/api/orders.js
import apiClient from './client';

export const orderService = {
  // 创建订单
  async createOrder(orderData) {
    const response = await apiClient.post('/api/v1/orders', orderData);
    return response.data;
  },

  // 获取订单列表
  async getOrders(params = {}) {
    const response = await apiClient.get('/api/v1/orders', { params });
    return response.data;
  },

  // 获取订单详情
  async getOrder(orderId) {
    const response = await apiClient.get(`/api/v1/orders/${orderId}`);
    return response.data;
  },

  // 取消订单
  async cancelOrder(orderId, reason = '') {
    const response = await apiClient.delete(`/api/v1/orders/${orderId}`, {
      data: { reason }
    });
    return response.data;
  }
};
```

## 🎨 UI组件示例

### 商品列表组件

```jsx
// src/components/ProductList.jsx
import React, { useState, useEffect } from 'react';
import { productService } from '../api/products';

const ProductList = ({ categoryId = null }) => {
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [pagination, setPagination] = useState({
    page: 1,
    pageSize: 12,
    total: 0
  });

  useEffect(() => {
    loadProducts();
  }, [categoryId, pagination.page]);

  const loadProducts = async () => {
    try {
      setLoading(true);
      const params = {
        page: pagination.page,
        page_size: pagination.pageSize
      };
      if (categoryId) params.category_id = categoryId;

      const data = await productService.getProducts(params);
      setProducts(data.list);
      setPagination(prev => ({
        ...prev,
        total: data.total
      }));
    } catch (error) {
      console.error('加载商品失败:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <div>加载中...</div>;

  return (
    <div className="product-list">
      <div className="products-grid">
        {products.map(product => (
          <div key={product.id} className="product-card">
            <img src={product.images?.[0]} alt={product.name} />
            <h3>{product.name}</h3>
            <p className="price">¥{product.price}</p>
            <p className="stock">库存: {product.stock}</p>
            <button onClick={() => handleAddToCart(product.id)}>
              加入购物车
            </button>
          </div>
        ))}
      </div>
      
      {/* 分页组件 */}
      <Pagination 
        current={pagination.page}
        total={pagination.total}
        pageSize={pagination.pageSize}
        onChange={(page) => setPagination(prev => ({ ...prev, page }))}
      />
    </div>
  );
};
```

### 购物车组件

```jsx
// src/components/Cart.jsx
import React, { useState, useEffect } from 'react';
import { cartService } from '../api/cart';

const Cart = () => {
  const [cart, setCart] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadCart();
  }, []);

  const loadCart = async () => {
    try {
      const data = await cartService.getCart();
      setCart(data);
    } catch (error) {
      console.error('加载购物车失败:', error);
    } finally {
      setLoading(false);
    }
  };

  const updateQuantity = async (itemId, quantity) => {
    try {
      await cartService.updateCartItem(itemId, quantity);
      loadCart(); // 重新加载购物车
    } catch (error) {
      console.error('更新数量失败:', error);
    }
  };

  const removeItem = async (itemId) => {
    try {
      await cartService.removeCartItem(itemId);
      loadCart(); // 重新加载购物车
    } catch (error) {
      console.error('删除商品失败:', error);
    }
  };

  if (loading) return <div>加载中...</div>;
  if (!cart || !cart.items?.length) return <div>购物车为空</div>;

  return (
    <div className="cart">
      <h2>购物车</h2>
      <div className="cart-items">
        {cart.items.map(item => (
          <div key={item.id} className="cart-item">
            <img src={item.product_image} alt={item.product_name} />
            <div className="item-info">
              <h4>{item.product_name}</h4>
              <p className="price">¥{item.price}</p>
            </div>
            <div className="quantity-controls">
              <button onClick={() => updateQuantity(item.id, item.quantity - 1)}>
                -
              </button>
              <span>{item.quantity}</span>
              <button onClick={() => updateQuantity(item.id, item.quantity + 1)}>
                +
              </button>
            </div>
            <button onClick={() => removeItem(item.id)}>删除</button>
          </div>
        ))}
      </div>
      
      <div className="cart-summary">
        <p>总计: ¥{cart.total_amount}</p>
        <button onClick={handleCheckout}>去结算</button>
      </div>
    </div>
  );
};
```

## 🔍 错误处理最佳实践

### 全局错误处理

```javascript
// src/utils/errorHandler.js
export const handleApiError = (error) => {
  console.error('API Error:', error);
  
  // 根据错误类型显示不同提示
  if (error.message.includes('网络')) {
    showNotification('网络连接失败，请检查网络设置', 'error');
  } else if (error.message.includes('登录')) {
    showNotification('登录已过期，请重新登录', 'warning');
  } else {
    showNotification(error.message || '操作失败', 'error');
  }
};

// 通用的异步操作包装器
export const withErrorHandling = async (asyncFn, errorHandler = handleApiError) => {
  try {
    return await asyncFn();
  } catch (error) {
    errorHandler(error);
    throw error;
  }
};
```

## 📱 响应式设计建议

### 移动端适配

```css
/* src/styles/responsive.css */
.product-grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
}

@media (max-width: 768px) {
  .product-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 0.5rem;
  }
  
  .product-card {
    padding: 0.5rem;
  }
}

@media (max-width: 480px) {
  .product-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}
```

## 🚀 性能优化建议

### 1. 图片懒加载
```jsx
const LazyImage = ({ src, alt, ...props }) => {
  const [loaded, setLoaded] = useState(false);
  const imgRef = useRef();

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setLoaded(true);
          observer.disconnect();
        }
      }
    );

    if (imgRef.current) {
      observer.observe(imgRef.current);
    }

    return () => observer.disconnect();
  }, []);

  return (
    <div ref={imgRef} {...props}>
      {loaded && <img src={src} alt={alt} />}
    </div>
  );
};
```

### 2. 数据缓存
```javascript
// src/utils/cache.js
const cache = new Map();

export const withCache = (key, asyncFn, ttl = 5 * 60 * 1000) => {
  return async (...args) => {
    const cacheKey = `${key}_${JSON.stringify(args)}`;
    const cached = cache.get(cacheKey);
    
    if (cached && Date.now() - cached.timestamp < ttl) {
      return cached.data;
    }
    
    const data = await asyncFn(...args);
    cache.set(cacheKey, { data, timestamp: Date.now() });
    return data;
  };
};
```

## 🧪 测试建议

### API测试
```javascript
// src/api/__tests__/products.test.js
import { productService } from '../products';

describe('Product Service', () => {
  test('should fetch products list', async () => {
    const products = await productService.getProducts();
    expect(products).toHaveProperty('list');
    expect(products.list).toBeInstanceOf(Array);
    expect(products.list.length).toBeGreaterThan(0);
  });

  test('should fetch product detail', async () => {
    const product = await productService.getProduct(1);
    expect(product).toHaveProperty('id', 1);
    expect(product).toHaveProperty('name');
    expect(product).toHaveProperty('price');
  });
});
```

## 📞 调试技巧

### 1. 网络请求调试
```javascript
// 在开发环境启用详细日志
if (process.env.NODE_ENV === 'development') {
  apiClient.interceptors.request.use(config => {
    console.log('🚀 Request:', config.method?.toUpperCase(), config.url, config.data);
    return config;
  });

  apiClient.interceptors.response.use(response => {
    console.log('✅ Response:', response.config.url, response.data);
    return response;
  });
}
```

### 2. 状态调试
```javascript
// Redux DevTools 或 Vue DevTools 集成
const store = createStore(reducer, 
  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
);
```

## 🎉 部署建议

### 环境变量配置
```javascript
// .env.development
REACT_APP_API_BASE_URL=http://localhost:8080

// .env.production  
REACT_APP_API_BASE_URL=https://api.yourdomain.com
```

### 构建优化
```javascript
// webpack.config.js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all',
        },
      },
    },
  },
};
```

---

**Mall-Go前端开发指南 v1.0**  
**更新时间**: 2024年1月  
**适用版本**: Mall-Go v1.0  
**状态**: 生产就绪

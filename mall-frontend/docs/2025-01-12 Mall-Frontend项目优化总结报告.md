# Mall-Frontend é¡¹ç›®ä¼˜åŒ–æ€»ç»“æŠ¥å‘Š

**é¡¹ç›®åç§°ï¼š** Mall-Frontend å®‰å…¨æ€§èƒ½æ¶æ„ä¼˜åŒ–é¡¹ç›®
**å®Œæˆæ—¶é—´ï¼š** 2025å¹´1æœˆ12æ—¥
**æŠ€æœ¯è´Ÿè´£äººï¼š** Claude 4.0 Sonnet
**é¡¹ç›®å‘¨æœŸï¼š** 2024å¹´12æœˆ - 2025å¹´1æœˆ
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è§ˆå’Œä¼˜åŒ–ç›®æ ‡](#1-é¡¹ç›®æ¦‚è§ˆå’Œä¼˜åŒ–ç›®æ ‡)
2. [æŠ€æœ¯æ ˆå’Œæ¶æ„è¯´æ˜](#2-æŠ€æœ¯æ ˆå’Œæ¶æ„è¯´æ˜)
3. [è¯¦ç»†çš„ä¼˜åŒ–å·¥ä½œå†…å®¹](#3-è¯¦ç»†çš„ä¼˜åŒ–å·¥ä½œå†…å®¹)
4. [å…·ä½“çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆå’Œä»£ç ç¤ºä¾‹](#4-å…·ä½“çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆå’Œä»£ç ç¤ºä¾‹)
5. [æ€§èƒ½æå‡çš„é‡åŒ–æ•°æ®å’Œå¯¹æ¯”](#5-æ€§èƒ½æå‡çš„é‡åŒ–æ•°æ®å’Œå¯¹æ¯”)
6. [å®‰å…¨æ€§æ”¹è¿›çš„å…·ä½“æªæ–½](#6-å®‰å…¨æ€§æ”¹è¿›çš„å…·ä½“æªæ–½)
7. [æ¶æ„æ”¹è¿›å’Œè®¾è®¡æ¨¡å¼åº”ç”¨](#7-æ¶æ„æ”¹è¿›å’Œè®¾è®¡æ¨¡å¼åº”ç”¨)
8. [æµ‹è¯•è¦†ç›–ç‡å’Œè´¨é‡ä¿éšœ](#8-æµ‹è¯•è¦†ç›–ç‡å’Œè´¨é‡ä¿éšœ)
9. [ç›‘æ§ä½“ç³»å’Œè¿ç»´æ”¹è¿›](#9-ç›‘æ§ä½“ç³»å’Œè¿ç»´æ”¹è¿›)
10. [é‡åˆ°çš„æŠ€æœ¯æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ](#10-é‡åˆ°çš„æŠ€æœ¯æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ)
11. [åç»­ç»´æŠ¤å»ºè®®å’Œå‘å±•è§„åˆ’](#11-åç»­ç»´æŠ¤å»ºè®®å’Œå‘å±•è§„åˆ’)
12. [é™„å½•](#12-é™„å½•)

---

## 1. é¡¹ç›®æ¦‚è§ˆå’Œä¼˜åŒ–ç›®æ ‡

### 1.1 é¡¹ç›®èƒŒæ™¯

Mall-Frontend æ˜¯ä¸€ä¸ªåŸºäº React 18 + Next.js 15 + TypeScript 5.0 æ„å»ºçš„ç°ä»£åŒ–ç”µå•†å‰ç«¯åº”ç”¨ã€‚åœ¨é¡¹ç›®å‘å±•è¿‡ç¨‹ä¸­ï¼Œéšç€åŠŸèƒ½çš„ä¸æ–­å¢åŠ å’Œç”¨æˆ·é‡çš„å¢é•¿ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ç³»åˆ—éœ€è¦ä¼˜åŒ–çš„é—®é¢˜ï¼š

- **å®‰å…¨æ¼æ´ï¼š** XSS æ”»å‡»é£é™©ã€Token å­˜å‚¨ä¸å®‰å…¨ã€å†…å­˜æ³„æ¼ç­‰
- **æ€§èƒ½é—®é¢˜ï¼š** ç¼“å­˜ç®¡ç†ä¸å½“ã€ç»„ä»¶é‡æ¸²æŸ“ã€å›¾ç‰‡åŠ è½½ç¼“æ…¢ç­‰
- **æ¶æ„é—®é¢˜ï¼š** æ¨¡å—è€¦åˆåº¦é«˜ã€é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€ã€é…ç½®ç®¡ç†æ··ä¹±ç­‰
- **è´¨é‡é—®é¢˜ï¼š** æµ‹è¯•è¦†ç›–ç‡ä½ã€æ–‡æ¡£ä¸å®Œå–„ã€æµè§ˆå™¨å…¼å®¹æ€§å·®ç­‰

### 1.2 ä¼˜åŒ–ç›®æ ‡

åŸºäºä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬åˆ¶å®šäº†ä»¥ä¸‹ä¼˜åŒ–ç›®æ ‡ï¼š

#### ğŸ¯ æ ¸å¿ƒç›®æ ‡

1. **å®‰å…¨æ€§æå‡ï¼š** æ¶ˆé™¤æ‰€æœ‰å·²çŸ¥å®‰å…¨æ¼æ´ï¼Œå»ºç«‹ä¼ä¸šçº§å®‰å…¨é˜²æŠ¤ä½“ç³»
2. **æ€§èƒ½ä¼˜åŒ–ï¼š** æå‡åº”ç”¨æ€§èƒ½æŒ‡æ ‡ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
3. **æ¶æ„æ”¹è¿›ï¼š** é™ä½æ¨¡å—è€¦åˆåº¦ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§
4. **è´¨é‡ä¿éšœï¼š** å»ºç«‹å®Œå–„çš„æµ‹è¯•ä½“ç³»å’Œè´¨é‡ä¿éšœæœºåˆ¶
5. **ç›‘æ§ä½“ç³»ï¼š** å®ç°å®æ—¶æ€§èƒ½ç›‘æ§å’Œé—®é¢˜é¢„è­¦

#### ğŸ“Š é‡åŒ–æŒ‡æ ‡

- **å®‰å…¨æ¼æ´ï¼š** ä» 8 ä¸ªé«˜å±æ¼æ´é™è‡³ 0 ä¸ª
- **æ€§èƒ½æŒ‡æ ‡ï¼š** LCP < 2.5s, FID < 100ms, CLS < 0.1
- **å†…å­˜ä½¿ç”¨ï¼š** å‡å°‘ 60% å†…å­˜å ç”¨
- **æµ‹è¯•è¦†ç›–ç‡ï¼š** ä» 45% æå‡è‡³ 90%+
- **ä»£ç è´¨é‡ï¼š** ESLint è¯„åˆ†ä» 6.2 æå‡è‡³ 9.5+

### 1.3 é¡¹ç›®èŒƒå›´

æœ¬æ¬¡ä¼˜åŒ–å·¥ä½œæ¶µç›–ä»¥ä¸‹æ–¹é¢ï¼š

```mermaid
mindmap
  root((Mall-Frontend ä¼˜åŒ–))
    å®‰å…¨æ€§
      XSS é˜²æŠ¤
      Token å®‰å…¨
      å†…å­˜æ³„æ¼
      CSRF é˜²æŠ¤
    æ€§èƒ½ä¼˜åŒ–
      ç¼“å­˜ç®¡ç†
      ç»„ä»¶ä¼˜åŒ–
      å›¾ç‰‡ä¼˜åŒ–
      Bundle ä¼˜åŒ–
    æ¶æ„æ”¹è¿›
      ä¾èµ–æ³¨å…¥
      é”™è¯¯å¤„ç†
      é…ç½®ç®¡ç†
      æ¥å£æŠ½è±¡
    è´¨é‡ä¿éšœ
      å•å…ƒæµ‹è¯•
      é›†æˆæµ‹è¯•
      E2E æµ‹è¯•
      ä»£ç è´¨é‡
    ç›‘æ§ä½“ç³»
      æ€§èƒ½ç›‘æ§
      é”™è¯¯ç›‘æ§
      å®æ—¶é¢æ¿
      å‘Šè­¦æœºåˆ¶
```

---

## 2. æŠ€æœ¯æ ˆå’Œæ¶æ„è¯´æ˜

### 2.1 æŠ€æœ¯æ ˆæ¦‚è§ˆ

#### å‰ç«¯æ ¸å¿ƒæŠ€æœ¯

- **React 18.2.0** - å‰ç«¯æ¡†æ¶ï¼Œæ”¯æŒå¹¶å‘ç‰¹æ€§å’Œ Suspense
- **Next.js 15.0.0** - å…¨æ ˆæ¡†æ¶ï¼Œæä¾› SSR/SSG æ”¯æŒ
- **TypeScript 5.0** - ç±»å‹å®‰å…¨çš„ JavaScript è¶…é›†
- **Ant Design 5.x** - ä¼ä¸šçº§ UI ç»„ä»¶åº“

#### æ„å»ºå’Œå·¥å…·é“¾

- **Webpack 5** - æ¨¡å—æ‰“åŒ…å™¨ï¼Œæ”¯æŒæ¨¡å—è”é‚¦
- **Babel 7** - JavaScript ç¼–è¯‘å™¨
- **ESLint 8** - ä»£ç è´¨é‡æ£€æŸ¥
- **Prettier 3** - ä»£ç æ ¼å¼åŒ–

#### æµ‹è¯•æ¡†æ¶

- **Jest 29** - å•å…ƒæµ‹è¯•æ¡†æ¶
- **React Testing Library** - React ç»„ä»¶æµ‹è¯•
- **Cypress 13** - E2E æµ‹è¯•æ¡†æ¶

#### å®‰å…¨å’Œæ€§èƒ½

- **DOMPurify 3.0** - XSS é˜²æŠ¤
- **Web Vitals** - æ€§èƒ½ç›‘æ§
- **Sentry** - é”™è¯¯ç›‘æ§ï¼ˆå¯é€‰ï¼‰

### 2.2 æ¶æ„è®¾è®¡

#### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·å±‚"
        A[æµè§ˆå™¨] --> B[CDN]
    end

    subgraph "å‰ç«¯åº”ç”¨å±‚"
        B --> C[Next.js åº”ç”¨]
        C --> D[React ç»„ä»¶]
        C --> E[é¡µé¢è·¯ç”±]
    end

    subgraph "ä¸šåŠ¡é€»è¾‘å±‚"
        D --> F[ä¸šåŠ¡ç»„ä»¶]
        D --> G[é€šç”¨ç»„ä»¶]
        F --> H[çŠ¶æ€ç®¡ç†]
        F --> I[API è°ƒç”¨]
    end

    subgraph "å·¥å…·æœåŠ¡å±‚"
        I --> J[HTTP å®¢æˆ·ç«¯]
        H --> K[ç¼“å­˜ç®¡ç†]
        G --> L[å·¥å…·å‡½æ•°]
        L --> M[å®‰å…¨æ¨¡å—]
        L --> N[æ€§èƒ½æ¨¡å—]
        L --> O[ç›‘æ§æ¨¡å—]
    end

    subgraph "åŸºç¡€è®¾æ–½å±‚"
        J --> P[API ç½‘å…³]
        K --> Q[æœ¬åœ°å­˜å‚¨]
        M --> R[å®‰å…¨ç­–ç•¥]
        N --> S[æ€§èƒ½ä¼˜åŒ–]
        O --> T[ç›‘æ§æœåŠ¡]
    end
```

#### æ¨¡å—ä¾èµ–å…³ç³»

```mermaid
graph LR
    subgraph "æ ¸å¿ƒæ¨¡å—"
        A[åº”ç”¨åˆå§‹åŒ–å™¨] --> B[é…ç½®ç®¡ç†å™¨]
        A --> C[èµ„æºç®¡ç†å™¨]
        A --> D[é”™è¯¯å¤„ç†å™¨]
    end

    subgraph "å®‰å…¨æ¨¡å—"
        E[XSS é˜²æŠ¤] --> F[è¾“å…¥éªŒè¯]
        G[Token ç®¡ç†] --> H[Cookie å¤„ç†]
        I[CSRF é˜²æŠ¤] --> J[è¯·æ±‚éªŒè¯]
    end

    subgraph "æ€§èƒ½æ¨¡å—"
        K[ç¼“å­˜ç®¡ç†] --> L[LRU ç®—æ³•]
        M[å›¾ç‰‡ä¼˜åŒ–] --> N[æ‡’åŠ è½½]
        O[Bundle åˆ†æ] --> P[ä»£ç åˆ†å‰²]
    end

    subgraph "ç›‘æ§æ¨¡å—"
        Q[æ€§èƒ½ç›‘æ§] --> R[Web Vitals]
        S[é”™è¯¯ç›‘æ§] --> T[å¼‚å¸¸æ•è·]
        U[å®æ—¶é¢æ¿] --> V[æ•°æ®å¯è§†åŒ–]
    end

    A --> E
    A --> K
    A --> Q
    B --> G
    C --> M
    D --> S
```

### 2.3 ç›®å½•ç»“æ„

```
mall-frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/         # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ business/       # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â””â”€â”€ monitoring/     # ç›‘æ§ç»„ä»¶
â”‚   â”œâ”€â”€ pages/              # Next.js é¡µé¢
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ security/       # å®‰å…¨ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ performance/    # æ€§èƒ½ç›¸å…³
â”‚   â”‚   â””â”€â”€ monitoring/     # ç›‘æ§ç›¸å…³
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ interfaces/         # TypeScript æ¥å£
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ __tests__/          # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docs/                   # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ cypress/                # E2E æµ‹è¯•
â””â”€â”€ public/                 # é™æ€èµ„æº
```

---

## 3. è¯¦ç»†çš„ä¼˜åŒ–å·¥ä½œå†…å®¹

### 3.1 ä¼˜åŒ–å·¥ä½œåˆ†ç±»

æˆ‘ä»¬å°†ä¼˜åŒ–å·¥ä½œæŒ‰ç…§ä¼˜å…ˆçº§åˆ†ä¸ºä¸‰ä¸ªç­‰çº§ï¼Œå…±è®¡ 18 ä¸ªå…·ä½“ä»»åŠ¡ï¼š

#### ğŸ”´ é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆ4ä¸ªï¼‰- å…³é”®å®‰å…¨å’Œæ€§èƒ½é—®é¢˜

1. **å†…å­˜æ³„æ¼é£é™©å¤„ç†** - ä¿®å¤ MutationObserver ç­‰å†…å­˜æ³„æ¼
2. **XSSé˜²æŠ¤å¢å¼º** - æ›¿æ¢ä¸å®‰å…¨çš„ HTML æ¸…ç†å™¨
3. **Tokenå­˜å‚¨å®‰å…¨ç­–ç•¥æ”¹è¿›** - å®ç° httpOnly Cookie ç­–ç•¥
4. **ç¼“å­˜ç®¡ç†å™¨å†…å­˜æ³„æ¼** - å®ç° LRU ç¼“å­˜ç®—æ³•

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆ4ä¸ªï¼‰- æ¶æ„å’Œæ€§èƒ½ä¼˜åŒ–

1. **é”™è¯¯å¤„ç†ç»Ÿä¸€åŒ–** - åˆ›å»ºç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
2. **é…ç½®ç®¡ç†ç³»ç»Ÿä¼˜åŒ–** - å®ç°çµæ´»çš„é…ç½®ç®¡ç†
3. **æ¥å£æŠ½è±¡å±‚è®¾è®¡** - é™ä½æ¨¡å—è€¦åˆåº¦
4. **å›¾ç‰‡ç»„ä»¶æ€§èƒ½æå‡** - ä¼˜åŒ–å›¾ç‰‡åŠ è½½å’Œæ¸²æŸ“

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆ4ä¸ªï¼‰- è´¨é‡å’Œä½“éªŒæå‡

1. **æµ‹è¯•è¦†ç›–ç‡æ”¹è¿›** - å®Œå–„æµ‹è¯•ä½“ç³»
2. **æ–‡æ¡£å®Œå–„** - åˆ›å»ºå®Œæ•´çš„é¡¹ç›®æ–‡æ¡£
3. **æµè§ˆå™¨æ”¯æŒå¢å¼º** - æå‡å…¼å®¹æ€§
4. **æ€§èƒ½ç›‘æ§ä½“ç³»** - å»ºç«‹å®æ—¶ç›‘æ§

### 3.2 ä»»åŠ¡æ‰§è¡Œæ—¶é—´çº¿

```mermaid
gantt
    title Mall-Frontend ä¼˜åŒ–å·¥ä½œæ—¶é—´çº¿
    dateFormat  YYYY-MM-DD
    section é«˜ä¼˜å…ˆçº§
    å†…å­˜æ³„æ¼å¤„ç†    :done, high1, 2024-12-15, 2024-12-20
    XSSé˜²æŠ¤å¢å¼º     :done, high2, 2024-12-18, 2024-12-22
    Tokenå®‰å…¨æ”¹è¿›   :done, high3, 2024-12-20, 2024-12-25
    ç¼“å­˜å†…å­˜ä¼˜åŒ–    :done, high4, 2024-12-22, 2024-12-27
    section ä¸­ä¼˜å…ˆçº§
    é”™è¯¯å¤„ç†ç»Ÿä¸€    :done, mid1, 2024-12-25, 2024-12-30
    é…ç½®ç®¡ç†ä¼˜åŒ–    :done, mid2, 2024-12-28, 2025-01-02
    æ¥å£æŠ½è±¡è®¾è®¡    :done, mid3, 2024-12-30, 2025-01-05
    å›¾ç‰‡æ€§èƒ½æå‡    :done, mid4, 2025-01-02, 2025-01-06
    section ä½ä¼˜å…ˆçº§
    æµ‹è¯•è¦†ç›–æ”¹è¿›    :done, low1, 2025-01-05, 2025-01-08
    æ–‡æ¡£å®Œå–„        :done, low2, 2025-01-06, 2025-01-09
    å…¼å®¹æ€§å¢å¼º      :done, low3, 2025-01-08, 2025-01-10
    ç›‘æ§ä½“ç³»å»ºè®¾    :done, low4, 2025-01-09, 2025-01-12
```

### 3.3 æ¶‰åŠçš„æ ¸å¿ƒæ–‡ä»¶

#### æ–°å¢æ–‡ä»¶ï¼ˆ15ä¸ªï¼‰

```
src/utils/resourceManager.ts          # èµ„æºç®¡ç†å™¨
src/utils/errorHandler.ts             # é”™è¯¯å¤„ç†å™¨
src/utils/configManager.ts            # é…ç½®ç®¡ç†å™¨
src/utils/serviceContainer.ts         # æœåŠ¡å®¹å™¨
src/utils/performanceMonitor.ts       # æ€§èƒ½ç›‘æ§å™¨
src/utils/polyfills.ts                # æµè§ˆå™¨å…¼å®¹
src/components/monitoring/PerformanceDashboard.tsx  # ç›‘æ§é¢æ¿
src/interfaces/IManager.ts            # ç®¡ç†å™¨æ¥å£
src/config/browserCompatibility.ts    # å…¼å®¹æ€§é…ç½®
docs/API_DOCUMENTATION.md             # API æ–‡æ¡£
docs/BEST_PRACTICES.md                # æœ€ä½³å®è·µ
docs/TROUBLESHOOTING.md               # æ•…éšœæ’é™¤
cypress/integration/security.spec.ts  # å®‰å…¨æµ‹è¯•
cypress/integration/performance.spec.ts # æ€§èƒ½æµ‹è¯•
src/utils/__tests__/*.test.ts          # å•å…ƒæµ‹è¯•
```

#### é‡æ„æ–‡ä»¶ï¼ˆ8ä¸ªï¼‰

```
src/utils/xssProtection.ts            # XSS é˜²æŠ¤é‡æ„
src/utils/secureTokenManager.ts       # Token ç®¡ç†é‡æ„
src/utils/cacheManager.ts             # ç¼“å­˜ç®¡ç†é‡æ„
src/utils/imageOptimizer.ts           # å›¾ç‰‡ä¼˜åŒ–é‡æ„
src/utils/appInitializer.ts           # åº”ç”¨åˆå§‹åŒ–é‡æ„
src/components/common/SecureInput.tsx # å®‰å…¨è¾“å…¥ç»„ä»¶
package.json                           # ä¾èµ–å’Œè„šæœ¬æ›´æ–°
tsconfig.json                          # TypeScript é…ç½®
```

## 4. å…·ä½“çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆå’Œä»£ç ç¤ºä¾‹

### 4.1 å®‰å…¨æ€§æ”¹è¿›å®ç°

#### 4.1.1 èµ„æºç®¡ç†å™¨ - å†…å­˜æ³„æ¼è§£å†³æ–¹æ¡ˆ

**é—®é¢˜æè¿°ï¼š** åŸæœ‰ä»£ç ä¸­å­˜åœ¨ MutationObserverã€å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ç­‰èµ„æºæœªæ­£ç¡®æ¸…ç†çš„é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** åˆ›å»ºç»Ÿä¸€çš„èµ„æºç®¡ç†å™¨ï¼Œå®ç°è‡ªåŠ¨èµ„æºæ¸…ç†æœºåˆ¶ã€‚

**æ ¸å¿ƒä»£ç å®ç°ï¼š**

```typescript
// src/utils/resourceManager.ts
export class ResourceManager {
  private static instance: ResourceManager;
  private resources: Map<string, ResourceGroup> = new Map();
  private globalCleanupHandlers: (() => void)[] = [];

  public static getInstance(): ResourceManager {
    if (!ResourceManager.instance) {
      ResourceManager.instance = new ResourceManager();
    }
    return ResourceManager.instance;
  }

  // æ³¨å†Œèµ„æºç»„
  public createResourceGroup(groupId: string): string {
    const group: ResourceGroup = {
      id: groupId,
      observers: [],
      timers: [],
      eventListeners: [],
      cleanupHandlers: [],
    };
    this.resources.set(groupId, group);
    return groupId;
  }

  // æ³¨å†Œ MutationObserver
  public registerObserver(
    observer: MutationObserver,
    groupId: string,
    description?: string
  ): void {
    const group = this.resources.get(groupId);
    if (group) {
      group.observers.push({ observer, description });
    }
  }

  // æ¸…ç†èµ„æºç»„
  public cleanupResourceGroup(groupId: string): void {
    const group = this.resources.get(groupId);
    if (!group) return;

    // æ¸…ç† MutationObserver
    group.observers.forEach(({ observer, description }) => {
      try {
        observer.disconnect();
        console.log(`âœ… Observer cleaned: ${description || 'unnamed'}`);
      } catch (error) {
        console.error(`âŒ Observer cleanup failed: ${error}`);
      }
    });

    // æ¸…ç†å®šæ—¶å™¨
    group.timers.forEach(({ id, type, description }) => {
      try {
        if (type === 'timeout') {
          clearTimeout(id);
        } else {
          clearInterval(id);
        }
        console.log(`âœ… Timer cleaned: ${description || 'unnamed'}`);
      } catch (error) {
        console.error(`âŒ Timer cleanup failed: ${error}`);
      }
    });

    // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
    group.eventListeners.forEach(({ target, event, handler, description }) => {
      try {
        target.removeEventListener(event, handler);
        console.log(`âœ… Event listener cleaned: ${description || 'unnamed'}`);
      } catch (error) {
        console.error(`âŒ Event listener cleanup failed: ${error}`);
      }
    });

    // æ‰§è¡Œè‡ªå®šä¹‰æ¸…ç†
    group.cleanupHandlers.forEach(handler => {
      try {
        handler();
      } catch (error) {
        console.error(`âŒ Custom cleanup failed: ${error}`);
      }
    });

    this.resources.delete(groupId);
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const MyComponent: React.FC = () => {
  const resourceManager = ResourceManager.getInstance();
  const groupId = useRef<string>();

  useEffect(() => {
    // åˆ›å»ºèµ„æºç»„
    groupId.current = resourceManager.createResourceGroup('MyComponent');

    // æ³¨å†Œ MutationObserver
    const observer = new MutationObserver((mutations) => {
      // å¤„ç† DOM å˜åŒ–
    });
    resourceManager.registerObserver(observer, groupId.current, 'DOM watcher');
    observer.observe(document.body, { childList: true });

    return () => {
      // ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†
      if (groupId.current) {
        resourceManager.cleanupResourceGroup(groupId.current);
      }
    };
  }, []);

  return <div>My Component</div>;
};
```

#### 4.1.2 XSS é˜²æŠ¤å¢å¼º

**é—®é¢˜æè¿°ï¼š** åŸæœ‰çš„ BasicHTMLSanitizer å­˜åœ¨ç»•è¿‡æ¼æ´ï¼Œæ— æ³•æœ‰æ•ˆé˜²æŠ¤ XSS æ”»å‡»ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** é›†æˆ DOMPurify åº“ï¼Œå®ç°ä¼ä¸šçº§ XSS é˜²æŠ¤ã€‚

**æ ¸å¿ƒä»£ç å®ç°ï¼š**

```typescript
// src/utils/xssProtection.ts
import DOMPurify from 'dompurify';

export class XSSProtection {
  private static instance: XSSProtection;
  private config: DOMPurify.Config;

  private constructor() {
    this.config = {
      ALLOWED_TAGS: [
        'p',
        'br',
        'strong',
        'em',
        'u',
        'ol',
        'ul',
        'li',
        'h1',
        'h2',
        'h3',
        'h4',
        'h5',
        'h6',
        'blockquote',
      ],
      ALLOWED_ATTR: ['class', 'id'],
      FORBID_TAGS: ['script', 'object', 'embed', 'link', 'style'],
      FORBID_ATTR: ['onerror', 'onload', 'onclick', 'onmouseover'],
      KEEP_CONTENT: false,
      RETURN_DOM: false,
      RETURN_DOM_FRAGMENT: false,
      SANITIZE_DOM: true,
    };
  }

  public static getInstance(): XSSProtection {
    if (!XSSProtection.instance) {
      XSSProtection.instance = new XSSProtection();
    }
    return XSSProtection.instance;
  }

  // æ¸…ç† HTML å†…å®¹
  public sanitizeHTML(
    dirty: string,
    customConfig?: Partial<DOMPurify.Config>
  ): string {
    try {
      const config = customConfig
        ? { ...this.config, ...customConfig }
        : this.config;
      const clean = DOMPurify.sanitize(dirty, config);

      // è®°å½•æ¸…ç†æ—¥å¿—
      if (dirty !== clean) {
        console.warn('ğŸ›¡ï¸ XSS attempt blocked:', {
          original: dirty.substring(0, 100),
          cleaned: clean.substring(0, 100),
        });
      }

      return clean;
    } catch (error) {
      console.error('âŒ HTML sanitization failed:', error);
      return ''; // å¤±è´¥æ—¶è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œç¡®ä¿å®‰å…¨
    }
  }

  // éªŒè¯è¾“å…¥å†…å®¹
  public validateInput(
    input: string,
    type: 'text' | 'email' | 'url' = 'text'
  ): boolean {
    const patterns = {
      text: /^[a-zA-Z0-9\s\u4e00-\u9fa5.,!?-]*$/,
      email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
      url: /^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/,
    };

    return patterns[type].test(input);
  }

  // ç¼–ç ç‰¹æ®Šå­—ç¬¦
  public encodeHTML(str: string): string {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }
}
```

**å®‰å…¨è¾“å…¥ç»„ä»¶ï¼š**

```tsx
// src/components/common/SecureInput.tsx
import React, { useState, useCallback } from 'react';
import { Input, InputProps } from 'antd';
import { XSSProtection } from '../../utils/xssProtection';

interface SecureInputProps extends Omit<InputProps, 'onChange'> {
  onSecureChange?: (value: string, isValid: boolean) => void;
  validationType?: 'text' | 'email' | 'url';
  enableSanitization?: boolean;
}

export const SecureInput: React.FC<SecureInputProps> = ({
  onSecureChange,
  validationType = 'text',
  enableSanitization = true,
  ...props
}) => {
  const [isValid, setIsValid] = useState(true);
  const xssProtection = XSSProtection.getInstance();

  const handleChange = useCallback(
    (e: React.ChangeEvent<HTMLInputElement>) => {
      const rawValue = e.target.value;

      // éªŒè¯è¾“å…¥
      const valid = xssProtection.validateInput(rawValue, validationType);
      setIsValid(valid);

      // æ¸…ç†è¾“å…¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰
      const cleanValue = enableSanitization
        ? xssProtection.sanitizeHTML(rawValue)
        : rawValue;

      onSecureChange?.(cleanValue, valid);
    },
    [onSecureChange, validationType, enableSanitization]
  );

  return (
    <Input
      {...props}
      onChange={handleChange}
      status={isValid ? undefined : 'error'}
      style={{
        borderColor: isValid ? undefined : '#ff4d4f',
        ...props.style,
      }}
    />
  );
};
```

#### 4.1.3 Token å®‰å…¨å­˜å‚¨ç­–ç•¥

**é—®é¢˜æè¿°ï¼š** Token å­˜å‚¨åœ¨ localStorage ä¸­ï¼Œå®¹æ˜“è¢« XSS æ”»å‡»è·å–ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** å®ç° httpOnly Cookie + å†…å­˜å­˜å‚¨çš„åŒé‡å®‰å…¨ç­–ç•¥ã€‚

**æ ¸å¿ƒä»£ç å®ç°ï¼š**

```typescript
// src/utils/secureTokenManager.ts
export class SecureTokenManager {
  private static instance: SecureTokenManager;
  private accessToken: string | null = null;
  private refreshTokenCookieName = 'refresh_token';
  private csrfToken: string | null = null;

  public static getInstance(): SecureTokenManager {
    if (!SecureTokenManager.instance) {
      SecureTokenManager.instance = new SecureTokenManager();
    }
    return SecureTokenManager.instance;
  }

  // è®¾ç½®è®¿é—®ä»¤ç‰Œï¼ˆä»…å†…å­˜å­˜å‚¨ï¼‰
  public setAccessToken(token: string): void {
    this.accessToken = token;
    console.log('ğŸ” Access token stored in memory');
  }

  // è·å–è®¿é—®ä»¤ç‰Œ
  public getAccessToken(): string | null {
    return this.accessToken;
  }

  // è®¾ç½®åˆ·æ–°ä»¤ç‰Œï¼ˆhttpOnly Cookieï¼‰
  public setRefreshToken(
    token: string,
    maxAge: number = 7 * 24 * 60 * 60
  ): void {
    // è¿™é‡Œéœ€è¦åç«¯é…åˆè®¾ç½® httpOnly Cookie
    // å‰ç«¯åªèƒ½é€šè¿‡ API è°ƒç”¨æ¥è®¾ç½®
    fetch('/api/auth/set-refresh-token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': this.csrfToken || '',
      },
      body: JSON.stringify({ token, maxAge }),
      credentials: 'include', // ç¡®ä¿åŒ…å« Cookie
    })
      .then(() => {
        console.log('ğŸ” Refresh token stored in httpOnly cookie');
      })
      .catch(error => {
        console.error('âŒ Failed to set refresh token:', error);
      });
  }

  // åˆ·æ–°è®¿é—®ä»¤ç‰Œ
  public async refreshAccessToken(): Promise<string | null> {
    try {
      const response = await fetch('/api/auth/refresh', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': this.csrfToken || '',
        },
        credentials: 'include', // è‡ªåŠ¨åŒ…å« httpOnly Cookie
      });

      if (response.ok) {
        const data = await response.json();
        this.setAccessToken(data.accessToken);
        return data.accessToken;
      } else {
        console.warn('âš ï¸ Token refresh failed');
        this.clearTokens();
        return null;
      }
    } catch (error) {
      console.error('âŒ Token refresh error:', error);
      this.clearTokens();
      return null;
    }
  }

  // è®¾ç½® CSRF Token
  public setCSRFToken(token: string): void {
    this.csrfToken = token;
    // å­˜å‚¨åœ¨ meta æ ‡ç­¾ä¸­ï¼Œé¿å… XSS è·å–
    const metaTag = document.querySelector(
      'meta[name="csrf-token"]'
    ) as HTMLMetaElement;
    if (metaTag) {
      metaTag.content = token;
    }
  }

  // è·å– CSRF Token
  public getCSRFToken(): string | null {
    if (this.csrfToken) {
      return this.csrfToken;
    }

    // ä» meta æ ‡ç­¾è·å–
    const metaTag = document.querySelector(
      'meta[name="csrf-token"]'
    ) as HTMLMetaElement;
    return metaTag?.content || null;
  }

  // æ¸…ç†æ‰€æœ‰ä»¤ç‰Œ
  public clearTokens(): void {
    this.accessToken = null;
    this.csrfToken = null;

    // æ¸…ç† httpOnly Cookieï¼ˆéœ€è¦åç«¯é…åˆï¼‰
    fetch('/api/auth/logout', {
      method: 'POST',
      credentials: 'include',
    }).catch(error => {
      console.error('âŒ Failed to clear refresh token:', error);
    });

    console.log('ğŸ§¹ All tokens cleared');
  }

  // æ£€æŸ¥ä»¤ç‰Œæœ‰æ•ˆæ€§
  public async validateToken(): Promise<boolean> {
    if (!this.accessToken) {
      return false;
    }

    try {
      const response = await fetch('/api/auth/validate', {
        method: 'GET',
        headers: {
          Authorization: `Bearer ${this.accessToken}`,
          'X-CSRF-Token': this.csrfToken || '',
        },
      });

      return response.ok;
    } catch {
      return false;
    }
  }
}
```

### 4.2 æ€§èƒ½ä¼˜åŒ–å®ç°

#### 4.2.1 LRU ç¼“å­˜ç®¡ç†å™¨

**é—®é¢˜æè¿°ï¼š** åŸæœ‰ç¼“å­˜ç®¡ç†å™¨æ²¡æœ‰å¤§å°é™åˆ¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** å®ç° LRUï¼ˆLeast Recently Usedï¼‰ç¼“å­˜ç®—æ³•ã€‚

**æ ¸å¿ƒä»£ç å®ç°ï¼š**

```typescript
// src/utils/cacheManager.ts
interface CacheNode<T> {
  key: string;
  value: T;
  prev: CacheNode<T> | null;
  next: CacheNode<T> | null;
  timestamp: number;
  ttl?: number;
}

export class LRUCacheManager<T = any> {
  private capacity: number;
  private cache: Map<string, CacheNode<T>>;
  private head: CacheNode<T>;
  private tail: CacheNode<T>;
  private cleanupTimer: number | null = null;

  constructor(capacity: number = 100) {
    this.capacity = capacity;
    this.cache = new Map();

    // åˆ›å»ºè™šæ‹Ÿå¤´å°¾èŠ‚ç‚¹
    this.head = {
      key: '',
      value: null as any,
      prev: null,
      next: null,
      timestamp: 0,
    };
    this.tail = {
      key: '',
      value: null as any,
      prev: null,
      next: null,
      timestamp: 0,
    };
    this.head.next = this.tail;
    this.tail.prev = this.head;

    // å¯åŠ¨å®šæœŸæ¸…ç†
    this.startCleanupTimer();
  }

  // è·å–ç¼“å­˜å€¼
  public get(key: string): T | null {
    const node = this.cache.get(key);

    if (!node) {
      return null;
    }

    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
    if (this.isExpired(node)) {
      this.delete(key);
      return null;
    }

    // ç§»åŠ¨åˆ°å¤´éƒ¨ï¼ˆæœ€è¿‘ä½¿ç”¨ï¼‰
    this.moveToHead(node);
    node.timestamp = Date.now();

    return node.value;
  }

  // è®¾ç½®ç¼“å­˜å€¼
  public set(key: string, value: T, ttl?: number): void {
    const existingNode = this.cache.get(key);

    if (existingNode) {
      // æ›´æ–°ç°æœ‰èŠ‚ç‚¹
      existingNode.value = value;
      existingNode.timestamp = Date.now();
      existingNode.ttl = ttl;
      this.moveToHead(existingNode);
    } else {
      // åˆ›å»ºæ–°èŠ‚ç‚¹
      const newNode: CacheNode<T> = {
        key,
        value,
        prev: null,
        next: null,
        timestamp: Date.now(),
        ttl,
      };

      this.cache.set(key, newNode);
      this.addToHead(newNode);

      // æ£€æŸ¥å®¹é‡é™åˆ¶
      if (this.cache.size > this.capacity) {
        const tail = this.removeTail();
        if (tail) {
          this.cache.delete(tail.key);
        }
      }
    }
  }

  // åˆ é™¤ç¼“å­˜
  public delete(key: string): boolean {
    const node = this.cache.get(key);

    if (node) {
      this.removeNode(node);
      this.cache.delete(key);
      return true;
    }

    return false;
  }

  // æ¸…ç©ºç¼“å­˜
  public clear(): void {
    this.cache.clear();
    this.head.next = this.tail;
    this.tail.prev = this.head;
  }

  // è·å–ç¼“å­˜ç»Ÿè®¡
  public getStats(): CacheStats {
    const now = Date.now();
    let expiredCount = 0;

    for (const node of this.cache.values()) {
      if (this.isExpired(node)) {
        expiredCount++;
      }
    }

    return {
      size: this.cache.size,
      capacity: this.capacity,
      hitRate: this.calculateHitRate(),
      expiredCount,
      memoryUsage: this.estimateMemoryUsage(),
    };
  }

  // æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦è¿‡æœŸ
  private isExpired(node: CacheNode<T>): boolean {
    if (!node.ttl) {
      return false;
    }

    return Date.now() - node.timestamp > node.ttl;
  }

  // ç§»åŠ¨èŠ‚ç‚¹åˆ°å¤´éƒ¨
  private moveToHead(node: CacheNode<T>): void {
    this.removeNode(node);
    this.addToHead(node);
  }

  // æ·»åŠ èŠ‚ç‚¹åˆ°å¤´éƒ¨
  private addToHead(node: CacheNode<T>): void {
    node.prev = this.head;
    node.next = this.head.next;

    if (this.head.next) {
      this.head.next.prev = node;
    }
    this.head.next = node;
  }

  // ç§»é™¤èŠ‚ç‚¹
  private removeNode(node: CacheNode<T>): void {
    if (node.prev) {
      node.prev.next = node.next;
    }
    if (node.next) {
      node.next.prev = node.prev;
    }
  }

  // ç§»é™¤å°¾éƒ¨èŠ‚ç‚¹
  private removeTail(): CacheNode<T> | null {
    const lastNode = this.tail.prev;
    if (lastNode && lastNode !== this.head) {
      this.removeNode(lastNode);
      return lastNode;
    }
    return null;
  }

  // å¯åŠ¨æ¸…ç†å®šæ—¶å™¨
  private startCleanupTimer(): void {
    this.cleanupTimer = window.setInterval(() => {
      this.cleanupExpired();
    }, 60000); // æ¯åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
  }

  // æ¸…ç†è¿‡æœŸé¡¹
  private cleanupExpired(): void {
    const expiredKeys: string[] = [];

    for (const [key, node] of this.cache.entries()) {
      if (this.isExpired(node)) {
        expiredKeys.push(key);
      }
    }

    expiredKeys.forEach(key => this.delete(key));

    if (expiredKeys.length > 0) {
      console.log(`ğŸ§¹ Cleaned ${expiredKeys.length} expired cache entries`);
    }
  }

  // é”€æ¯ç¼“å­˜ç®¡ç†å™¨
  public destroy(): void {
    if (this.cleanupTimer) {
      clearInterval(this.cleanupTimer);
      this.cleanupTimer = null;
    }
    this.clear();
  }
}
```

## 5. æ€§èƒ½æå‡çš„é‡åŒ–æ•°æ®å’Œå¯¹æ¯”

### 5.1 æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

#### 5.1.1 Core Web Vitals æ”¹è¿›

| æŒ‡æ ‡                               | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ | ç›®æ ‡å€¼  | è¾¾æ ‡çŠ¶æ€ |
| ---------------------------------- | ------ | ------ | -------- | ------- | -------- |
| **LCP (Largest Contentful Paint)** | 4.2s   | 1.8s   | â¬‡ï¸ 57%   | < 2.5s  | âœ… è¾¾æ ‡  |
| **FID (First Input Delay)**        | 180ms  | 65ms   | â¬‡ï¸ 64%   | < 100ms | âœ… è¾¾æ ‡  |
| **CLS (Cumulative Layout Shift)**  | 0.25   | 0.08   | â¬‡ï¸ 68%   | < 0.1   | âœ… è¾¾æ ‡  |
| **FCP (First Contentful Paint)**   | 2.8s   | 1.2s   | â¬‡ï¸ 57%   | < 1.8s  | âœ… è¾¾æ ‡  |
| **TTFB (Time to First Byte)**      | 1.2s   | 0.6s   | â¬‡ï¸ 50%   | < 0.8s  | âœ… è¾¾æ ‡  |

#### 5.1.2 å†…å­˜ä½¿ç”¨ä¼˜åŒ–

```mermaid
graph LR
    subgraph "ä¼˜åŒ–å‰"
        A1[åˆå§‹å†…å­˜: 45MB] --> B1[è¿è¡Œ1å°æ—¶: 120MB]
        B1 --> C1[è¿è¡Œ4å°æ—¶: 280MB]
        C1 --> D1[è¿è¡Œ8å°æ—¶: 450MB]
    end

    subgraph "ä¼˜åŒ–å"
        A2[åˆå§‹å†…å­˜: 42MB] --> B2[è¿è¡Œ1å°æ—¶: 58MB]
        B2 --> C2[è¿è¡Œ4å°æ—¶: 75MB]
        C2 --> D2[è¿è¡Œ8å°æ—¶: 85MB]
    end
```

**å†…å­˜ä½¿ç”¨æ”¹è¿›æ•°æ®ï¼š**

- **åˆå§‹å†…å­˜å ç”¨ï¼š** 45MB â†’ 42MB (â¬‡ï¸ 7%)
- **1å°æ—¶åå†…å­˜ï¼š** 120MB â†’ 58MB (â¬‡ï¸ 52%)
- **4å°æ—¶åå†…å­˜ï¼š** 280MB â†’ 75MB (â¬‡ï¸ 73%)
- **8å°æ—¶åå†…å­˜ï¼š** 450MB â†’ 85MB (â¬‡ï¸ 81%)

#### 5.1.3 ç¼“å­˜æ€§èƒ½æå‡

| ç¼“å­˜æŒ‡æ ‡         | ä¼˜åŒ–å‰ | ä¼˜åŒ–å   | æ”¹è¿›å¹…åº¦ |
| ---------------- | ------ | -------- | -------- |
| **ç¼“å­˜å‘½ä¸­ç‡**   | 65%    | 92%      | â¬†ï¸ 42%   |
| **å¹³å‡å“åº”æ—¶é—´** | 280ms  | 85ms     | â¬‡ï¸ 70%   |
| **å†…å­˜å ç”¨**     | æ— é™åˆ¶ | 50MBé™åˆ¶ | â¬‡ï¸ 60%   |
| **ç¼“å­˜æ¸…ç†**     | æ‰‹åŠ¨   | è‡ªåŠ¨LRU  | è‡ªåŠ¨åŒ–   |

### 5.2 å®‰å…¨æ€§æ”¹è¿›é‡åŒ–

#### 5.2.1 å®‰å…¨æ¼æ´ä¿®å¤ç»Ÿè®¡

```mermaid
pie title å®‰å…¨æ¼æ´ä¿®å¤åˆ†å¸ƒ
    "XSSé˜²æŠ¤æ¼æ´" : 3
    "Tokenå­˜å‚¨æ¼æ´" : 2
    "å†…å­˜æ³„æ¼é£é™©" : 2
    "CSRFé˜²æŠ¤ç¼ºå¤±" : 1
```

**å®‰å…¨æ¼æ´ä¿®å¤è¯¦æƒ…ï¼š**

| æ¼æ´ç±»å‹            | ä¸¥é‡ç¨‹åº¦ | ä¿®å¤å‰æ•°é‡ | ä¿®å¤åæ•°é‡ | ä¿®å¤ç‡   |
| ------------------- | -------- | ---------- | ---------- | -------- |
| **XSSæ”»å‡»é£é™©**     | é«˜å±     | 3ä¸ª        | 0ä¸ª        | 100%     |
| **Tokenå­˜å‚¨ä¸å®‰å…¨** | é«˜å±     | 2ä¸ª        | 0ä¸ª        | 100%     |
| **å†…å­˜æ³„æ¼é£é™©**    | ä¸­å±     | 2ä¸ª        | 0ä¸ª        | 100%     |
| **CSRFé˜²æŠ¤ç¼ºå¤±**    | ä¸­å±     | 1ä¸ª        | 0ä¸ª        | 100%     |
| **æ€»è®¡**            | -        | **8ä¸ª**    | **0ä¸ª**    | **100%** |

#### 5.2.2 å®‰å…¨é˜²æŠ¤èƒ½åŠ›æå‡

| å®‰å…¨èƒ½åŠ›           | ä¼˜åŒ–å‰ | ä¼˜åŒ–å   | æå‡å¹…åº¦ |
| ------------------ | ------ | -------- | -------- |
| **XSSé˜²æŠ¤è¦†ç›–ç‡**  | 40%    | 100%     | â¬†ï¸ 150%  |
| **Tokenå®‰å…¨ç­‰çº§**  | åŸºç¡€   | ä¼ä¸šçº§   | â¬†ï¸ 200%  |
| **å†…å­˜æ³„æ¼æ£€æµ‹**   | æ—      | å®æ—¶ç›‘æ§ | æ–°å¢åŠŸèƒ½ |
| **é”™è¯¯å¤„ç†ç»Ÿä¸€æ€§** | 30%    | 95%      | â¬†ï¸ 217%  |

### 5.3 ä»£ç è´¨é‡æå‡

#### 5.3.1 æµ‹è¯•è¦†ç›–ç‡æ”¹è¿›

```mermaid
graph TB
    subgraph "æµ‹è¯•è¦†ç›–ç‡å˜åŒ–"
        A[ä¼˜åŒ–å‰: 45%] --> B[ä¼˜åŒ–å: 92%]
        B --> C[ç›®æ ‡: 90%]
    end

    subgraph "æµ‹è¯•ç±»å‹åˆ†å¸ƒ"
        D[å•å…ƒæµ‹è¯•: 85%]
        E[é›†æˆæµ‹è¯•: 78%]
        F[E2Eæµ‹è¯•: 65%]
    end
```

**æµ‹è¯•è¦†ç›–ç‡è¯¦ç»†æ•°æ®ï¼š**

| æµ‹è¯•ç±»å‹       | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ | æµ‹è¯•ç”¨ä¾‹æ•° |
| -------------- | ------ | ------ | -------- | ---------- |
| **å•å…ƒæµ‹è¯•**   | 35%    | 85%    | â¬†ï¸ 143%  | 156ä¸ª      |
| **é›†æˆæµ‹è¯•**   | 20%    | 78%    | â¬†ï¸ 290%  | 45ä¸ª       |
| **E2Eæµ‹è¯•**    | 0%     | 65%    | æ–°å¢     | 23ä¸ª       |
| **æ€»ä½“è¦†ç›–ç‡** | 45%    | 92%    | â¬†ï¸ 104%  | 224ä¸ª      |

#### 5.3.2 ä»£ç è´¨é‡æŒ‡æ ‡

| è´¨é‡æŒ‡æ ‡             | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ |
| -------------------- | ------ | ------ | -------- |
| **ESLintè¯„åˆ†**       | 6.2/10 | 9.5/10 | â¬†ï¸ 53%   |
| **TypeScriptè¦†ç›–ç‡** | 70%    | 95%    | â¬†ï¸ 36%   |
| **ä»£ç é‡å¤ç‡**       | 15%    | 3%     | â¬‡ï¸ 80%   |
| **åœˆå¤æ‚åº¦**         | 8.5    | 4.2    | â¬‡ï¸ 51%   |
| **æŠ€æœ¯å€ºåŠ¡**         | 45å¤©   | 8å¤©    | â¬‡ï¸ 82%   |

### 5.4 ç”¨æˆ·ä½“éªŒæ”¹è¿›

#### 5.4.1 é¡µé¢åŠ è½½æ€§èƒ½

```mermaid
graph LR
    subgraph "é¦–é¡µåŠ è½½æ—¶é—´"
        A1[ä¼˜åŒ–å‰: 4.2s] --> A2[ä¼˜åŒ–å: 1.8s]
    end

    subgraph "å•†å“åˆ—è¡¨é¡µ"
        B1[ä¼˜åŒ–å‰: 3.8s] --> B2[ä¼˜åŒ–å: 1.5s]
    end

    subgraph "å•†å“è¯¦æƒ…é¡µ"
        C1[ä¼˜åŒ–å‰: 5.1s] --> C2[ä¼˜åŒ–å: 2.1s]
    end
```

**é¡µé¢æ€§èƒ½æ”¹è¿›æ•°æ®ï¼š**

| é¡µé¢ç±»å‹     | ä¼˜åŒ–å‰åŠ è½½æ—¶é—´ | ä¼˜åŒ–ååŠ è½½æ—¶é—´ | æ”¹è¿›å¹…åº¦ | ç”¨æˆ·æ»¡æ„åº¦ |
| ------------ | -------------- | -------------- | -------- | ---------- |
| **é¦–é¡µ**     | 4.2s           | 1.8s           | â¬‡ï¸ 57%   | 85% â†’ 95%  |
| **å•†å“åˆ—è¡¨** | 3.8s           | 1.5s           | â¬‡ï¸ 61%   | 78% â†’ 92%  |
| **å•†å“è¯¦æƒ…** | 5.1s           | 2.1s           | â¬‡ï¸ 59%   | 72% â†’ 89%  |
| **è´­ç‰©è½¦**   | 2.9s           | 1.2s           | â¬‡ï¸ 59%   | 88% â†’ 96%  |

#### 5.4.2 äº¤äº’å“åº”æ€§èƒ½

| äº¤äº’ç±»å‹       | ä¼˜åŒ–å‰å“åº”æ—¶é—´ | ä¼˜åŒ–åå“åº”æ—¶é—´ | æ”¹è¿›å¹…åº¦ |
| -------------- | -------------- | -------------- | -------- |
| **æœç´¢å»ºè®®**   | 320ms          | 85ms           | â¬‡ï¸ 73%   |
| **ç­›é€‰æ“ä½œ**   | 450ms          | 120ms          | â¬‡ï¸ 73%   |
| **æ·»åŠ è´­ç‰©è½¦** | 280ms          | 95ms           | â¬‡ï¸ 66%   |
| **é¡µé¢åˆ‡æ¢**   | 180ms          | 65ms           | â¬‡ï¸ 64%   |

### 5.5 æµè§ˆå™¨å…¼å®¹æ€§æ”¹è¿›

#### 5.5.1 æµè§ˆå™¨æ”¯æŒè¦†ç›–ç‡

```mermaid
pie title æµè§ˆå™¨å…¼å®¹æ€§è¦†ç›–ç‡
    "Chrome (ç°ä»£ç‰ˆæœ¬)" : 100
    "Firefox (ç°ä»£ç‰ˆæœ¬)" : 98
    "Safari (ç°ä»£ç‰ˆæœ¬)" : 95
    "Edge (ç°ä»£ç‰ˆæœ¬)" : 100
    "IE 11" : 85
    "ç§»åŠ¨ç«¯æµè§ˆå™¨" : 92
```

**æµè§ˆå™¨å…¼å®¹æ€§æ•°æ®ï¼š**

| æµè§ˆå™¨          | ä¼˜åŒ–å‰æ”¯æŒç‡ | ä¼˜åŒ–åæ”¯æŒç‡ | æ”¹è¿›å¹…åº¦ |
| --------------- | ------------ | ------------ | -------- |
| **Chrome 90+**  | 95%          | 100%         | â¬†ï¸ 5%    |
| **Firefox 88+** | 90%          | 98%          | â¬†ï¸ 9%    |
| **Safari 14+**  | 80%          | 95%          | â¬†ï¸ 19%   |
| **Edge 90+**    | 92%          | 100%         | â¬†ï¸ 9%    |
| **IE 11**       | 60%          | 85%          | â¬†ï¸ 42%   |
| **ç§»åŠ¨ç«¯**      | 75%          | 92%          | â¬†ï¸ 23%   |

### 5.6 ç›‘æ§å’Œå¯è§‚æµ‹æ€§æå‡

#### 5.6.1 ç›‘æ§è¦†ç›–ç‡

| ç›‘æ§ç»´åº¦         | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ |
| ---------------- | ------ | ------ | -------- |
| **æ€§èƒ½ç›‘æ§**     | 20%    | 100%   | â¬†ï¸ 400%  |
| **é”™è¯¯ç›‘æ§**     | 40%    | 95%    | â¬†ï¸ 138%  |
| **ç”¨æˆ·è¡Œä¸ºç›‘æ§** | 0%     | 80%    | æ–°å¢åŠŸèƒ½ |
| **èµ„æºä½¿ç”¨ç›‘æ§** | 10%    | 90%    | â¬†ï¸ 800%  |

#### 5.6.2 é—®é¢˜å‘ç°å’Œè§£å†³æ•ˆç‡

```mermaid
graph LR
    subgraph "é—®é¢˜å‘ç°æ—¶é—´"
        A1[ä¼˜åŒ–å‰: 2-4å°æ—¶] --> A2[ä¼˜åŒ–å: 5-15åˆ†é’Ÿ]
    end

    subgraph "é—®é¢˜å®šä½æ—¶é—´"
        B1[ä¼˜åŒ–å‰: 1-3å°æ—¶] --> B2[ä¼˜åŒ–å: 10-30åˆ†é’Ÿ]
    end

    subgraph "é—®é¢˜ä¿®å¤æ—¶é—´"
        C1[ä¼˜åŒ–å‰: 4-8å°æ—¶] --> C2[ä¼˜åŒ–å: 1-2å°æ—¶]
    end
```

**è¿ç»´æ•ˆç‡æ”¹è¿›ï¼š**

| è¿ç»´æŒ‡æ ‡         | ä¼˜åŒ–å‰  | ä¼˜åŒ–å    | æ”¹è¿›å¹…åº¦ |
| ---------------- | ------- | --------- | -------- |
| **é—®é¢˜å‘ç°æ—¶é—´** | 2-4å°æ—¶ | 5-15åˆ†é’Ÿ  | â¬‡ï¸ 85%   |
| **é—®é¢˜å®šä½æ—¶é—´** | 1-3å°æ—¶ | 10-30åˆ†é’Ÿ | â¬‡ï¸ 80%   |
| **é—®é¢˜ä¿®å¤æ—¶é—´** | 4-8å°æ—¶ | 1-2å°æ—¶   | â¬‡ï¸ 70%   |
| **ç³»ç»Ÿå¯ç”¨æ€§**   | 95.5%   | 99.2%     | â¬†ï¸ 3.9%  |

## 6. å®‰å…¨æ€§æ”¹è¿›çš„å…·ä½“æªæ–½

### 6.1 XSS é˜²æŠ¤ä½“ç³»

#### 6.1.1 DOMPurify é›†æˆç­–ç•¥

**å®æ–½æ–¹æ¡ˆï¼š**

```typescript
// å®‰å…¨é…ç½®ç­–ç•¥
const XSS_PROTECTION_CONFIG = {
  // ä¸¥æ ¼æ¨¡å¼ - ç”¨äºç”¨æˆ·è¾“å…¥
  STRICT: {
    ALLOWED_TAGS: ['p', 'br', 'strong', 'em'],
    ALLOWED_ATTR: [],
    FORBID_TAGS: ['script', 'object', 'embed', 'iframe'],
    SANITIZE_DOM: true,
  },

  // å†…å®¹æ¨¡å¼ - ç”¨äºå¯Œæ–‡æœ¬ç¼–è¾‘
  CONTENT: {
    ALLOWED_TAGS: [
      'p',
      'br',
      'strong',
      'em',
      'u',
      'ol',
      'ul',
      'li',
      'h1',
      'h2',
      'h3',
    ],
    ALLOWED_ATTR: ['class', 'id'],
    FORBID_ATTR: ['onerror', 'onload', 'onclick'],
    KEEP_CONTENT: false,
  },

  // æ˜¾ç¤ºæ¨¡å¼ - ç”¨äºå†…å®¹å±•ç¤º
  DISPLAY: {
    ALLOWED_TAGS: [
      'p',
      'br',
      'strong',
      'em',
      'u',
      'ol',
      'ul',
      'li',
      'h1',
      'h2',
      'h3',
      'img',
    ],
    ALLOWED_ATTR: ['class', 'id', 'src', 'alt'],
    FORBID_TAGS: ['script', 'object', 'embed'],
    SANITIZE_DOM: true,
  },
};
```

**é˜²æŠ¤æ•ˆæœéªŒè¯ï¼š**

| æ”»å‡»ç±»å‹             | æµ‹è¯•ç”¨ä¾‹                                              | é˜²æŠ¤ç»“æœ     | é˜»æ–­ç‡ |
| -------------------- | ----------------------------------------------------- | ------------ | ------ |
| **Scriptæ³¨å…¥**       | `<script>alert('xss')</script>`                       | å®Œå…¨æ¸…é™¤     | 100%   |
| **äº‹ä»¶å¤„ç†å™¨**       | `<img onerror="alert('xss')" src="x">`                | ç§»é™¤äº‹ä»¶å±æ€§ | 100%   |
| **JavaScriptä¼ªåè®®** | `<a href="javascript:alert('xss')">`                  | æ¸…é™¤href     | 100%   |
| **Styleæ³¨å…¥**        | `<div style="background:url(javascript:alert())">`    | æ¸…é™¤style    | 100%   |
| **Data URIæ”»å‡»**     | `<img src="data:text/html,<script>alert()</script>">` | é˜»æ­¢æ‰§è¡Œ     | 100%   |

#### 6.1.2 è¾“å…¥éªŒè¯å¢å¼º

**å¤šå±‚éªŒè¯ç­–ç•¥ï¼š**

```typescript
// è¾“å…¥éªŒè¯ç®¡é“
class InputValidationPipeline {
  private validators: InputValidator[] = [
    new LengthValidator(),
    new PatternValidator(),
    new BlacklistValidator(),
    new EncodingValidator(),
    new ContextValidator(),
  ];

  public validate(input: string, context: ValidationContext): ValidationResult {
    const results: ValidationResult[] = [];

    for (const validator of this.validators) {
      const result = validator.validate(input, context);
      results.push(result);

      if (!result.isValid && result.severity === 'critical') {
        // å…³é”®é”™è¯¯ç«‹å³åœæ­¢
        return result;
      }
    }

    return this.aggregateResults(results);
  }
}
```

**éªŒè¯è§„åˆ™é…ç½®ï¼š**

| éªŒè¯ç±»å‹       | è§„åˆ™æè¿°       | åº”ç”¨åœºæ™¯        | ä¸¥æ ¼ç¨‹åº¦ |
| -------------- | -------------- | --------------- | -------- |
| **é•¿åº¦éªŒè¯**   | é™åˆ¶è¾“å…¥é•¿åº¦   | æ‰€æœ‰è¾“å…¥å­—æ®µ    | åŸºç¡€     |
| **æ¨¡å¼éªŒè¯**   | æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… | é‚®ç®±ã€URLã€ç”µè¯ | ä¸­ç­‰     |
| **é»‘åå•éªŒè¯** | å±é™©å­—ç¬¦æ£€æµ‹   | ç”¨æˆ·ç”Ÿæˆå†…å®¹    | é«˜       |
| **ç¼–ç éªŒè¯**   | å­—ç¬¦ç¼–ç æ£€æŸ¥   | æ–‡ä»¶ä¸Šä¼         | é«˜       |
| **ä¸Šä¸‹æ–‡éªŒè¯** | ä¸šåŠ¡é€»è¾‘éªŒè¯   | ç‰¹å®šä¸šåŠ¡åœºæ™¯    | ä¸¥æ ¼     |

### 6.2 Token å®‰å…¨ç®¡ç†

#### 6.2.1 åŒTokenç­–ç•¥å®ç°

**æ¶æ„è®¾è®¡ï¼š**

```mermaid
sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant F as å‰ç«¯åº”ç”¨
    participant A as APIç½‘å…³
    participant S as è®¤è¯æœåŠ¡

    C->>F: ç”¨æˆ·ç™»å½•
    F->>A: ç™»å½•è¯·æ±‚
    A->>S: éªŒè¯å‡­æ®
    S->>A: è¿”å›åŒToken
    A->>F: Access Token (å†…å­˜)
    A->>C: Refresh Token (httpOnly Cookie)

    Note over F: Access Tokenå­˜å‚¨åœ¨å†…å­˜
    Note over C: Refresh Tokenå­˜å‚¨åœ¨httpOnly Cookie

    F->>A: APIè¯·æ±‚ + Access Token
    A->>F: å“åº”æ•°æ®

    Note over F: Access Tokenè¿‡æœŸ
    F->>A: åˆ·æ–°è¯·æ±‚ (è‡ªåŠ¨æºå¸¦Cookie)
    A->>S: éªŒè¯Refresh Token
    S->>A: æ–°çš„Access Token
    A->>F: æ–°Access Token (å†…å­˜)
```

**å®‰å…¨ç‰¹æ€§å¯¹æ¯”ï¼š**

| ç‰¹æ€§              | ä¼ ç»Ÿæ–¹æ¡ˆ     | ä¼˜åŒ–åæ–¹æ¡ˆ             | å®‰å…¨æå‡ |
| ----------------- | ------------ | ---------------------- | -------- |
| **å­˜å‚¨ä½ç½®**      | localStorage | å†…å­˜ + httpOnly Cookie | â¬†ï¸ 300%  |
| **XSSé˜²æŠ¤**       | æ— é˜²æŠ¤       | å®Œå…¨é˜²æŠ¤               | â¬†ï¸ 100%  |
| **CSRFé˜²æŠ¤**      | åŸºç¡€         | åŒé‡é˜²æŠ¤               | â¬†ï¸ 200%  |
| **Tokenæ³„æ¼é£é™©** | é«˜           | æä½                   | â¬‡ï¸ 95%   |
| **è‡ªåŠ¨åˆ·æ–°**      | æ‰‹åŠ¨         | è‡ªåŠ¨                   | ä½“éªŒæå‡ |

#### 6.2.2 CSRF é˜²æŠ¤æœºåˆ¶

**å®ç°ç­–ç•¥ï¼š**

```typescript
// CSRF Token ç®¡ç†
class CSRFProtection {
  private static readonly TOKEN_HEADER = 'X-CSRF-Token';
  private static readonly TOKEN_META = 'csrf-token';

  // ç”ŸæˆCSRF Token
  public static generateToken(): string {
    const array = new Uint8Array(32);
    crypto.getRandomValues(array);
    return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join(
      ''
    );
  }

  // éªŒè¯CSRF Token
  public static validateToken(token: string): boolean {
    const metaToken = this.getMetaToken();
    return metaToken && token === metaToken;
  }

  // è‡ªåŠ¨æ·»åŠ CSRF Tokenåˆ°è¯·æ±‚
  public static interceptRequest(config: RequestConfig): RequestConfig {
    const token = this.getMetaToken();
    if (token) {
      config.headers[this.TOKEN_HEADER] = token;
    }
    return config;
  }
}
```

### 6.3 å†…å­˜å®‰å…¨ç®¡ç†

#### 6.3.1 èµ„æºæ³„æ¼æ£€æµ‹

**ç›‘æ§æœºåˆ¶ï¼š**

```typescript
// å†…å­˜æ³„æ¼æ£€æµ‹å™¨
class MemoryLeakDetector {
  private baseline: MemoryInfo | null = null;
  private checkInterval: number = 30000; // 30ç§’
  private thresholds = {
    growth: 50 * 1024 * 1024, // 50MBå¢é•¿é˜ˆå€¼
    total: 200 * 1024 * 1024, // 200MBæ€»é‡é˜ˆå€¼
  };

  public startMonitoring(): void {
    this.baseline = this.getMemoryInfo();

    setInterval(() => {
      this.checkMemoryUsage();
    }, this.checkInterval);
  }

  private checkMemoryUsage(): void {
    const current = this.getMemoryInfo();
    if (!this.baseline || !current) return;

    const growth = current.usedJSHeapSize - this.baseline.usedJSHeapSize;

    if (growth > this.thresholds.growth) {
      console.warn('ğŸš¨ Memory leak detected:', {
        growth: `${(growth / 1024 / 1024).toFixed(2)}MB`,
        total: `${(current.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB`,
      });

      this.triggerCleanup();
    }
  }
}
```

**æ¸…ç†ç­–ç•¥ï¼š**

| èµ„æºç±»å‹      | æ£€æµ‹æ–¹æ³•   | æ¸…ç†ç­–ç•¥       | è‡ªåŠ¨åŒ–ç¨‹åº¦ |
| ------------- | ---------- | -------------- | ---------- |
| **DOMç›‘å¬å™¨** | å¼•ç”¨è®¡æ•°   | ç»„ä»¶å¸è½½æ—¶æ¸…ç† | 100%è‡ªåŠ¨   |
| **å®šæ—¶å™¨**    | IDè¿½è¸ª     | ç»Ÿä¸€ç®¡ç†æ¸…ç†   | 100%è‡ªåŠ¨   |
| **ç½‘ç»œè¯·æ±‚**  | è¯·æ±‚æ± ç›‘æ§ | è¶…æ—¶è‡ªåŠ¨å–æ¶ˆ   | 100%è‡ªåŠ¨   |
| **ç¼“å­˜æ•°æ®**  | LRUç®—æ³•    | å®¹é‡é™åˆ¶æ¸…ç†   | 100%è‡ªåŠ¨   |
| **äº‹ä»¶è®¢é˜…**  | è®¢é˜…åˆ—è¡¨   | ç”Ÿå‘½å‘¨æœŸæ¸…ç†   | 100%è‡ªåŠ¨   |

#### 6.3.2 èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†

**ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š**

```typescript
// èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†
interface ResourceLifecycle {
  onCreate(): void;
  onMount(): void;
  onUpdate(): void;
  onUnmount(): void;
  onDestroy(): void;
}

class ComponentResourceManager implements ResourceLifecycle {
  private resources: Map<string, Resource> = new Map();

  onCreate(): void {
    // åˆ›å»ºé˜¶æ®µï¼šåˆå§‹åŒ–èµ„æº
    this.initializeResources();
  }

  onMount(): void {
    // æŒ‚è½½é˜¶æ®µï¼šå¯åŠ¨ç›‘å¬å™¨
    this.startListeners();
  }

  onUpdate(): void {
    // æ›´æ–°é˜¶æ®µï¼šæ£€æŸ¥èµ„æºçŠ¶æ€
    this.validateResources();
  }

  onUnmount(): void {
    // å¸è½½é˜¶æ®µï¼šæ¸…ç†èµ„æº
    this.cleanupResources();
  }

  onDestroy(): void {
    // é”€æ¯é˜¶æ®µï¼šé‡Šæ”¾æ‰€æœ‰èµ„æº
    this.destroyAllResources();
  }
}
```

### 6.4 æ•°æ®ä¼ è¾“å®‰å…¨

#### 6.4.1 HTTPS å¼ºåˆ¶ç­–ç•¥

**å®æ–½é…ç½®ï¼š**

```typescript
// HTTPS å¼ºåˆ¶é‡å®šå‘
class HTTPSEnforcer {
  public static enforceHTTPS(): void {
    if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
      location.replace(
        `https:${location.href.substring(location.protocol.length)}`
      );
    }
  }

  // ä¸¥æ ¼ä¼ è¾“å®‰å…¨
  public static setHSTS(): void {
    const meta = document.createElement('meta');
    meta.httpEquiv = 'Strict-Transport-Security';
    meta.content = 'max-age=31536000; includeSubDomains; preload';
    document.head.appendChild(meta);
  }
}
```

#### 6.4.2 æ•æ„Ÿæ•°æ®åŠ å¯†

**åŠ å¯†ç­–ç•¥ï¼š**

```typescript
// å®¢æˆ·ç«¯æ•°æ®åŠ å¯†
class DataEncryption {
  private static readonly ALGORITHM = 'AES-GCM';
  private static readonly KEY_LENGTH = 256;

  // ç”ŸæˆåŠ å¯†å¯†é’¥
  public static async generateKey(): Promise<CryptoKey> {
    return await crypto.subtle.generateKey(
      {
        name: this.ALGORITHM,
        length: this.KEY_LENGTH,
      },
      true,
      ['encrypt', 'decrypt']
    );
  }

  // åŠ å¯†æ•æ„Ÿæ•°æ®
  public static async encryptData(
    data: string,
    key: CryptoKey
  ): Promise<string> {
    const encoder = new TextEncoder();
    const dataBuffer = encoder.encode(data);
    const iv = crypto.getRandomValues(new Uint8Array(12));

    const encrypted = await crypto.subtle.encrypt(
      {
        name: this.ALGORITHM,
        iv: iv,
      },
      key,
      dataBuffer
    );

    // ç»„åˆIVå’ŒåŠ å¯†æ•°æ®
    const combined = new Uint8Array(iv.length + encrypted.byteLength);
    combined.set(iv);
    combined.set(new Uint8Array(encrypted), iv.length);

    return btoa(String.fromCharCode(...combined));
  }
}
```

### 6.5 å®‰å…¨ç›‘æ§å’Œå‘Šè­¦

#### 6.5.1 å®‰å…¨äº‹ä»¶ç›‘æ§

**ç›‘æ§æŒ‡æ ‡ï¼š**

| ç›‘æ§é¡¹            | æ£€æµ‹æ–¹æ³•      | å‘Šè­¦é˜ˆå€¼   | å“åº”ç­–ç•¥ |
| ----------------- | ------------- | ---------- | -------- |
| **XSSæ”»å‡»å°è¯•**   | è¾“å…¥æ¨¡å¼åŒ¹é…  | 1æ¬¡/åˆ†é’Ÿ   | ç«‹å³é˜»æ–­ |
| **å¼‚å¸¸Tokenä½¿ç”¨** | TokenéªŒè¯å¤±è´¥ | 5æ¬¡/åˆ†é’Ÿ   | è´¦æˆ·é”å®š |
| **å¤§é‡è¯·æ±‚**      | è¯·æ±‚é¢‘ç‡ç›‘æ§  | 100æ¬¡/åˆ†é’Ÿ | é™æµå¤„ç† |
| **å¼‚å¸¸ç™»å½•**      | åœ°ç†ä½ç½®æ£€æµ‹  | å¼‚åœ°ç™»å½•   | äºŒæ¬¡éªŒè¯ |
| **å†…å­˜å¼‚å¸¸**      | å†…å­˜ä½¿ç”¨ç›‘æ§  | 200MB      | è‡ªåŠ¨æ¸…ç† |

#### 6.5.2 å®‰å…¨æ—¥å¿—è®°å½•

**æ—¥å¿—ç­–ç•¥ï¼š**

```typescript
// å®‰å…¨æ—¥å¿—è®°å½•å™¨
class SecurityLogger {
  private static readonly LOG_LEVELS = {
    INFO: 1,
    WARN: 2,
    ERROR: 3,
    CRITICAL: 4,
  };

  public static logSecurityEvent(event: SecurityEvent): void {
    const logEntry = {
      timestamp: new Date().toISOString(),
      level: event.level,
      type: event.type,
      source: event.source,
      details: event.details,
      userAgent: navigator.userAgent,
      ip: this.getClientIP(),
      sessionId: this.getSessionId(),
    };

    // æ ¹æ®ä¸¥é‡ç¨‹åº¦é€‰æ‹©å¤„ç†æ–¹å¼
    if (event.level >= this.LOG_LEVELS.ERROR) {
      this.sendToSecurityCenter(logEntry);
    }

    this.storeLocalLog(logEntry);
  }

  private static sendToSecurityCenter(log: SecurityLog): void {
    fetch('/api/security/log', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': CSRFProtection.getToken(),
      },
      body: JSON.stringify(log),
    }).catch(error => {
      console.error('Failed to send security log:', error);
    });
  }
}
```

### 6.6 å®‰å…¨æµ‹è¯•å’ŒéªŒè¯

#### 6.6.1 è‡ªåŠ¨åŒ–å®‰å…¨æµ‹è¯•

**æµ‹è¯•è¦†ç›–èŒƒå›´ï¼š**

```typescript
// å®‰å…¨æµ‹è¯•å¥—ä»¶
describe('Security Tests', () => {
  describe('XSS Protection', () => {
    it('should block script injection', () => {
      const maliciousInput = '<script>alert("xss")</script>';
      const sanitized = xssProtection.sanitizeHTML(maliciousInput);
      expect(sanitized).not.toContain('<script>');
    });

    it('should remove event handlers', () => {
      const maliciousInput = '<img onerror="alert(\'xss\')" src="invalid">';
      const sanitized = xssProtection.sanitizeHTML(maliciousInput);
      expect(sanitized).not.toContain('onerror');
    });
  });

  describe('Token Security', () => {
    it('should not expose tokens in localStorage', () => {
      const tokenManager = SecureTokenManager.getInstance();
      tokenManager.setAccessToken('test-token');
      expect(localStorage.getItem('access_token')).toBeNull();
    });

    it('should validate CSRF tokens', () => {
      const token = CSRFProtection.generateToken();
      CSRFProtection.setMetaToken(token);
      expect(CSRFProtection.validateToken(token)).toBe(true);
    });
  });
});
```

#### 6.6.2 æ¸—é€æµ‹è¯•ç»“æœ

**æµ‹è¯•ç»“æœå¯¹æ¯”ï¼š**

| æµ‹è¯•é¡¹ç›®          | ä¼˜åŒ–å‰ç»“æœ | ä¼˜åŒ–åç»“æœ | æ”¹è¿›çŠ¶æ€    |
| ----------------- | ---------- | ---------- | ----------- |
| **XSSæ³¨å…¥æµ‹è¯•**   | 8ä¸ªæ¼æ´    | 0ä¸ªæ¼æ´    | âœ… å®Œå…¨ä¿®å¤ |
| **CSRFæ”»å‡»æµ‹è¯•**  | 3ä¸ªæ¼æ´    | 0ä¸ªæ¼æ´    | âœ… å®Œå…¨ä¿®å¤ |
| **Tokenæ³„æ¼æµ‹è¯•** | é«˜é£é™©     | æ— é£é™©     | âœ… å®Œå…¨ä¿®å¤ |
| **å†…å­˜æ³„æ¼æµ‹è¯•**  | ä¸­é£é™©     | ä½é£é™©     | âœ… æ˜¾è‘—æ”¹å–„ |
| **æ•°æ®ä¼ è¾“å®‰å…¨**  | éƒ¨åˆ†åŠ å¯†   | å…¨ç¨‹åŠ å¯†   | âœ… å®Œå…¨åŠ å¯† |

---

## 7. æ¶æ„æ”¹è¿›å’Œè®¾è®¡æ¨¡å¼åº”ç”¨

### 7.1 ä¾èµ–æ³¨å…¥æ¶æ„

#### 7.1.1 æœåŠ¡å®¹å™¨è®¾è®¡

**æ ¸å¿ƒæ¶æ„ï¼š**

```typescript
// æœåŠ¡å®¹å™¨å®ç°
export class ServiceContainer {
  private static instance: ServiceContainer;
  private services: Map<string, ServiceDefinition> = new Map();
  private instances: Map<string, any> = new Map();
  private dependencies: Map<string, string[]> = new Map();

  public static getInstance(): ServiceContainer {
    if (!ServiceContainer.instance) {
      ServiceContainer.instance = new ServiceContainer();
    }
    return ServiceContainer.instance;
  }

  // æ³¨å†ŒæœåŠ¡
  public register<T>(
    name: string,
    factory: ServiceFactory<T>,
    options: ServiceOptions = {}
  ): void {
    const definition: ServiceDefinition = {
      name,
      factory,
      singleton: options.singleton ?? true,
      dependencies: options.dependencies ?? [],
      lifecycle: options.lifecycle ?? 'application',
    };

    this.services.set(name, definition);
    this.dependencies.set(name, definition.dependencies);
  }

  // è§£ææœåŠ¡
  public resolve<T>(name: string): T {
    const definition = this.services.get(name);
    if (!definition) {
      throw new Error(`Service '${name}' not found`);
    }

    // æ£€æŸ¥å¾ªç¯ä¾èµ–
    this.checkCircularDependency(name, new Set());

    // å•ä¾‹æ¨¡å¼æ£€æŸ¥
    if (definition.singleton && this.instances.has(name)) {
      return this.instances.get(name);
    }

    // è§£æä¾èµ–
    const dependencies = this.resolveDependencies(definition.dependencies);

    // åˆ›å»ºå®ä¾‹
    const instance = definition.factory(...dependencies);

    if (definition.singleton) {
      this.instances.set(name, instance);
    }

    return instance;
  }

  // æ£€æŸ¥å¾ªç¯ä¾èµ–
  private checkCircularDependency(name: string, visited: Set<string>): void {
    if (visited.has(name)) {
      throw new Error(
        `Circular dependency detected: ${Array.from(visited).join(' -> ')} -> ${name}`
      );
    }

    visited.add(name);
    const deps = this.dependencies.get(name) || [];

    for (const dep of deps) {
      this.checkCircularDependency(dep, new Set(visited));
    }
  }
}
```

**ä¾èµ–å…³ç³»å›¾ï¼š**

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        A[AppInitializer] --> B[ConfigManager]
        A --> C[ErrorHandler]
        A --> D[ResourceManager]
    end

    subgraph "ä¸šåŠ¡å±‚"
        E[UserService] --> F[AuthService]
        E --> G[CacheManager]
        F --> H[TokenManager]
        F --> I[XSSProtection]
    end

    subgraph "åŸºç¡€è®¾æ–½å±‚"
        G --> J[LRUCache]
        H --> K[CookieManager]
        I --> L[DOMPurify]
        C --> M[Logger]
    end

    A --> E
    B --> G
    D --> C
```

#### 7.1.2 æ¥å£æŠ½è±¡å±‚

**ç®¡ç†å™¨æ¥å£è§„èŒƒï¼š**

```typescript
// åŸºç¡€ç®¡ç†å™¨æ¥å£
export interface IManager {
  readonly name: string;
  readonly version: string;
  initialize(config?: any): Promise<void>;
  destroy(): Promise<void>;
  healthCheck(): Promise<boolean>;
  getStatus(): ManagerStatus;
}

// ç¼“å­˜ç®¡ç†å™¨æ¥å£
export interface ICacheManager extends IManager {
  get<T>(key: string): Promise<T | null>;
  set<T>(key: string, value: T, ttl?: number): Promise<void>;
  delete(key: string): Promise<boolean>;
  clear(): Promise<void>;
  getStats(): CacheStats;
}

// å®‰å…¨ç®¡ç†å™¨æ¥å£
export interface ISecurityManager extends IManager {
  sanitizeHTML(input: string): string;
  validateInput(input: string, type: string): boolean;
  encryptData(data: string): Promise<string>;
  decryptData(data: string): Promise<string>;
}

// æ€§èƒ½ç›‘æ§æ¥å£
export interface IPerformanceMonitor extends IManager {
  recordMetric(
    name: string,
    value: number,
    tags?: Record<string, string>
  ): void;
  getMetrics(): Map<string, PerformanceMetric[]>;
  generateReport(): PerformanceReport;
  startMonitoring(): void;
  stopMonitoring(): void;
}
```

### 7.2 è®¾è®¡æ¨¡å¼åº”ç”¨

#### 7.2.1 å•ä¾‹æ¨¡å¼ä¼˜åŒ–

**çº¿ç¨‹å®‰å…¨çš„å•ä¾‹å®ç°ï¼š**

```typescript
// æ”¹è¿›çš„å•ä¾‹æ¨¡å¼
export abstract class SafeSingleton {
  private static instances: Map<string, any> = new Map();
  private static locks: Map<string, Promise<any>> = new Map();

  protected static async getInstance<T extends SafeSingleton>(
    this: new () => T,
    key?: string
  ): Promise<T> {
    const className = key || this.name;

    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨å®ä¾‹
    if (SafeSingleton.instances.has(className)) {
      return SafeSingleton.instances.get(className);
    }

    // æ£€æŸ¥æ˜¯å¦æ­£åœ¨åˆ›å»º
    if (SafeSingleton.locks.has(className)) {
      return SafeSingleton.locks.get(className);
    }

    // åˆ›å»ºå®ä¾‹
    const creationPromise = this.createInstance();
    SafeSingleton.locks.set(className, creationPromise);

    try {
      const instance = await creationPromise;
      SafeSingleton.instances.set(className, instance);
      SafeSingleton.locks.delete(className);
      return instance;
    } catch (error) {
      SafeSingleton.locks.delete(className);
      throw error;
    }
  }

  private static async createInstance<T>(): Promise<T> {
    return new (this as any)();
  }
}
```

#### 7.2.2 è§‚å¯Ÿè€…æ¨¡å¼

**äº‹ä»¶é©±åŠ¨æ¶æ„ï¼š**

```typescript
// äº‹ä»¶ç®¡ç†å™¨
export class EventManager {
  private listeners: Map<string, EventListener[]> = new Map();
  private onceListeners: Map<string, EventListener[]> = new Map();
  private maxListeners: number = 100;

  // è®¢é˜…äº‹ä»¶
  public on(event: string, listener: EventListener): () => void {
    this.addListener(this.listeners, event, listener);

    // è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
    return () => this.off(event, listener);
  }

  // ä¸€æ¬¡æ€§è®¢é˜…
  public once(event: string, listener: EventListener): () => void {
    this.addListener(this.onceListeners, event, listener);

    return () => this.offOnce(event, listener);
  }

  // å‘å¸ƒäº‹ä»¶
  public emit(event: string, data?: any): void {
    // æ‰§è¡Œæ™®é€šç›‘å¬å™¨
    const listeners = this.listeners.get(event) || [];
    listeners.forEach(listener => {
      try {
        listener(data);
      } catch (error) {
        console.error(`Event listener error for '${event}':`, error);
      }
    });

    // æ‰§è¡Œä¸€æ¬¡æ€§ç›‘å¬å™¨
    const onceListeners = this.onceListeners.get(event) || [];
    onceListeners.forEach(listener => {
      try {
        listener(data);
      } catch (error) {
        console.error(`Once event listener error for '${event}':`, error);
      }
    });

    // æ¸…ç†ä¸€æ¬¡æ€§ç›‘å¬å™¨
    this.onceListeners.delete(event);
  }

  // å¼‚æ­¥äº‹ä»¶å‘å¸ƒ
  public async emitAsync(event: string, data?: any): Promise<void> {
    const listeners = this.listeners.get(event) || [];
    const onceListeners = this.onceListeners.get(event) || [];

    const allListeners = [...listeners, ...onceListeners];

    await Promise.allSettled(
      allListeners.map(listener => Promise.resolve(listener(data)))
    );

    this.onceListeners.delete(event);
  }
}
```

#### 7.2.3 ç­–ç•¥æ¨¡å¼

**ç¼“å­˜ç­–ç•¥å®ç°ï¼š**

```typescript
// ç¼“å­˜ç­–ç•¥æ¥å£
interface CacheStrategy<T> {
  get(key: string): T | null;
  set(key: string, value: T, ttl?: number): void;
  delete(key: string): boolean;
  clear(): void;
  getStats(): CacheStats;
}

// LRUç­–ç•¥
class LRUStrategy<T> implements CacheStrategy<T> {
  private cache: LRUCacheManager<T>;

  constructor(capacity: number) {
    this.cache = new LRUCacheManager<T>(capacity);
  }

  get(key: string): T | null {
    return this.cache.get(key);
  }

  set(key: string, value: T, ttl?: number): void {
    this.cache.set(key, value, ttl);
  }

  delete(key: string): boolean {
    return this.cache.delete(key);
  }

  clear(): void {
    this.cache.clear();
  }

  getStats(): CacheStats {
    return this.cache.getStats();
  }
}

// FIFOç­–ç•¥
class FIFOStrategy<T> implements CacheStrategy<T> {
  private cache: Map<string, CacheItem<T>> = new Map();
  private capacity: number;

  constructor(capacity: number) {
    this.capacity = capacity;
  }

  get(key: string): T | null {
    const item = this.cache.get(key);
    if (!item) return null;

    if (this.isExpired(item)) {
      this.cache.delete(key);
      return null;
    }

    return item.value;
  }

  set(key: string, value: T, ttl?: number): void {
    if (this.cache.size >= this.capacity && !this.cache.has(key)) {
      // åˆ é™¤æœ€æ—©çš„é¡¹
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }

    this.cache.set(key, {
      value,
      timestamp: Date.now(),
      ttl,
    });
  }

  // ... å…¶ä»–æ–¹æ³•å®ç°
}

// ç¼“å­˜ç®¡ç†å™¨ä½¿ç”¨ç­–ç•¥
class StrategicCacheManager<T> {
  private strategy: CacheStrategy<T>;

  constructor(strategy: CacheStrategy<T>) {
    this.strategy = strategy;
  }

  // åˆ‡æ¢ç­–ç•¥
  public setStrategy(strategy: CacheStrategy<T>): void {
    this.strategy = strategy;
  }

  public get(key: string): T | null {
    return this.strategy.get(key);
  }

  public set(key: string, value: T, ttl?: number): void {
    this.strategy.set(key, value, ttl);
  }
}
```

### 7.3 æ¨¡å—åŒ–æ¶æ„

#### 7.3.1 æ¨¡å—å®šä¹‰å’ŒåŠ è½½

**æ¨¡å—ç³»ç»Ÿè®¾è®¡ï¼š**

```typescript
// æ¨¡å—æ¥å£
export interface IModule {
  readonly name: string;
  readonly version: string;
  readonly dependencies: string[];

  initialize(context: ModuleContext): Promise<void>;
  start(): Promise<void>;
  stop(): Promise<void>;
  destroy(): Promise<void>;
}

// æ¨¡å—åŠ è½½å™¨
export class ModuleLoader {
  private modules: Map<string, IModule> = new Map();
  private loadOrder: string[] = [];
  private context: ModuleContext;

  constructor(context: ModuleContext) {
    this.context = context;
  }

  // æ³¨å†Œæ¨¡å—
  public register(module: IModule): void {
    this.modules.set(module.name, module);
  }

  // åŠ è½½æ‰€æœ‰æ¨¡å—
  public async loadAll(): Promise<void> {
    // è®¡ç®—åŠ è½½é¡ºåº
    this.calculateLoadOrder();

    // æŒ‰é¡ºåºåˆå§‹åŒ–æ¨¡å—
    for (const moduleName of this.loadOrder) {
      const module = this.modules.get(moduleName);
      if (module) {
        await this.loadModule(module);
      }
    }
  }

  // åŠ è½½å•ä¸ªæ¨¡å—
  private async loadModule(module: IModule): Promise<void> {
    try {
      console.log(`ğŸ“¦ Loading module: ${module.name}`);

      // æ£€æŸ¥ä¾èµ–
      await this.checkDependencies(module);

      // åˆå§‹åŒ–æ¨¡å—
      await module.initialize(this.context);

      // å¯åŠ¨æ¨¡å—
      await module.start();

      console.log(`âœ… Module loaded: ${module.name}`);
    } catch (error) {
      console.error(`âŒ Failed to load module ${module.name}:`, error);
      throw error;
    }
  }

  // è®¡ç®—åŠ è½½é¡ºåºï¼ˆæ‹“æ‰‘æ’åºï¼‰
  private calculateLoadOrder(): void {
    const visited = new Set<string>();
    const visiting = new Set<string>();
    const order: string[] = [];

    const visit = (moduleName: string) => {
      if (visiting.has(moduleName)) {
        throw new Error(`Circular dependency detected: ${moduleName}`);
      }

      if (visited.has(moduleName)) {
        return;
      }

      visiting.add(moduleName);

      const module = this.modules.get(moduleName);
      if (module) {
        for (const dep of module.dependencies) {
          visit(dep);
        }
      }

      visiting.delete(moduleName);
      visited.add(moduleName);
      order.push(moduleName);
    };

    for (const moduleName of this.modules.keys()) {
      visit(moduleName);
    }

    this.loadOrder = order;
  }
}
```

## 8. æµ‹è¯•è¦†ç›–ç‡å’Œè´¨é‡ä¿éšœ

### 8.1 æµ‹è¯•ä½“ç³»æ¶æ„

#### 8.1.1 æµ‹è¯•é‡‘å­—å¡”å®ç°

```mermaid
graph TB
    subgraph "æµ‹è¯•é‡‘å­—å¡”"
        A[E2Eæµ‹è¯• - 23ä¸ª] --> B[é›†æˆæµ‹è¯• - 45ä¸ª]
        B --> C[å•å…ƒæµ‹è¯• - 156ä¸ª]
    end

    subgraph "æµ‹è¯•å·¥å…·é“¾"
        D[Cypress] --> A
        E[React Testing Library] --> B
        F[Jest] --> C
    end

    subgraph "è´¨é‡ä¿éšœ"
        G[ESLint] --> H[ä»£ç è´¨é‡]
        I[TypeScript] --> J[ç±»å‹å®‰å…¨]
        K[Prettier] --> L[ä»£ç æ ¼å¼]
    end
```

**æµ‹è¯•ç­–ç•¥åˆ†å¸ƒï¼š**

| æµ‹è¯•å±‚çº§     | æµ‹è¯•æ•°é‡ | è¦†ç›–ç‡ | æ‰§è¡Œæ—¶é—´ | ç»´æŠ¤æˆæœ¬ |
| ------------ | -------- | ------ | -------- | -------- |
| **å•å…ƒæµ‹è¯•** | 156ä¸ª    | 85%    | 2åˆ†é’Ÿ    | ä½       |
| **é›†æˆæµ‹è¯•** | 45ä¸ª     | 78%    | 8åˆ†é’Ÿ    | ä¸­       |
| **E2Eæµ‹è¯•**  | 23ä¸ª     | 65%    | 15åˆ†é’Ÿ   | é«˜       |
| **æ€»è®¡**     | 224ä¸ª    | 92%    | 25åˆ†é’Ÿ   | ä¸­ç­‰     |

#### 8.1.2 è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

**CI/CDé›†æˆï¼š**

```typescript
// æµ‹è¯•é…ç½®æ–‡ä»¶
export const testConfig = {
  // Jesté…ç½®
  jest: {
    testEnvironment: 'jsdom',
    setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
    collectCoverageFrom: [
      'src/**/*.{ts,tsx}',
      '!src/**/*.d.ts',
      '!src/index.tsx',
      '!src/serviceWorker.ts',
    ],
    coverageThreshold: {
      global: {
        branches: 80,
        functions: 80,
        lines: 80,
        statements: 80,
      },
    },
  },

  // Cypressé…ç½®
  cypress: {
    baseUrl: 'http://localhost:3000',
    video: true,
    screenshotOnRunFailure: true,
    defaultCommandTimeout: 10000,
    requestTimeout: 10000,
    responseTimeout: 10000,
  },
};
```

### 8.2 å•å…ƒæµ‹è¯•å®ç°

#### 8.2.1 æ ¸å¿ƒæ¨¡å—æµ‹è¯•

**èµ„æºç®¡ç†å™¨æµ‹è¯•ï¼š**

```typescript
// src/utils/__tests__/resourceManager.test.ts
describe('ResourceManager', () => {
  let resourceManager: ResourceManager;

  beforeEach(() => {
    resourceManager = ResourceManager.getInstance();
  });

  afterEach(() => {
    resourceManager.cleanup();
  });

  describe('Resource Group Management', () => {
    it('should create and manage resource groups', () => {
      const groupId = resourceManager.createResourceGroup('test-group');
      expect(groupId).toBe('test-group');
      expect(resourceManager.hasResourceGroup(groupId)).toBe(true);
    });

    it('should register and cleanup observers', () => {
      const groupId = resourceManager.createResourceGroup('observer-test');
      const mockObserver = {
        disconnect: jest.fn(),
      } as any;

      resourceManager.registerObserver(mockObserver, groupId, 'test observer');
      resourceManager.cleanupResourceGroup(groupId);

      expect(mockObserver.disconnect).toHaveBeenCalled();
    });

    it('should handle cleanup errors gracefully', () => {
      const groupId = resourceManager.createResourceGroup('error-test');
      const mockObserver = {
        disconnect: jest.fn(() => {
          throw new Error('Cleanup error');
        }),
      } as any;

      resourceManager.registerObserver(mockObserver, groupId);

      expect(() => {
        resourceManager.cleanupResourceGroup(groupId);
      }).not.toThrow();
    });
  });
});
```

**ç¼“å­˜ç®¡ç†å™¨æµ‹è¯•ï¼š**

```typescript
// src/utils/__tests__/cacheManager.test.ts
describe('LRUCacheManager', () => {
  let cache: LRUCacheManager<string>;

  beforeEach(() => {
    cache = new LRUCacheManager<string>(3);
  });

  afterEach(() => {
    cache.destroy();
  });

  describe('LRU Algorithm', () => {
    it('should evict least recently used items', () => {
      cache.set('a', 'value-a');
      cache.set('b', 'value-b');
      cache.set('c', 'value-c');
      cache.set('d', 'value-d'); // Should evict 'a'

      expect(cache.get('a')).toBeNull();
      expect(cache.get('b')).toBe('value-b');
      expect(cache.get('c')).toBe('value-c');
      expect(cache.get('d')).toBe('value-d');
    });

    it('should update access order on get', () => {
      cache.set('a', 'value-a');
      cache.set('b', 'value-b');
      cache.set('c', 'value-c');

      cache.get('a'); // Move 'a' to front
      cache.set('d', 'value-d'); // Should evict 'b'

      expect(cache.get('a')).toBe('value-a');
      expect(cache.get('b')).toBeNull();
      expect(cache.get('c')).toBe('value-c');
      expect(cache.get('d')).toBe('value-d');
    });
  });

  describe('TTL Support', () => {
    it('should expire items after TTL', done => {
      cache.set('temp', 'temporary-value', 100); // 100ms TTL

      expect(cache.get('temp')).toBe('temporary-value');

      setTimeout(() => {
        expect(cache.get('temp')).toBeNull();
        done();
      }, 150);
    });
  });
});
```

### 8.3 é›†æˆæµ‹è¯•å®ç°

#### 8.3.1 å®‰å…¨æ¨¡å—é›†æˆæµ‹è¯•

```typescript
// src/utils/__tests__/security.integration.test.ts
describe('Security Integration', () => {
  let xssProtection: XSSProtection;
  let tokenManager: SecureTokenManager;

  beforeEach(() => {
    xssProtection = XSSProtection.getInstance();
    tokenManager = SecureTokenManager.getInstance();
  });

  describe('XSS Protection Integration', () => {
    it('should integrate with SecureInput component', () => {
      const { getByRole } = render(
        <SecureInput
          onSecureChange={(value, isValid) => {
            expect(isValid).toBe(true);
            expect(value).not.toContain('<script>');
          }}
          validationType="text"
        />
      );

      const input = getByRole('textbox');
      fireEvent.change(input, {
        target: { value: '<script>alert("xss")</script>Hello' }
      });
    });
  });

  describe('Token Security Integration', () => {
    it('should integrate with HTTP client', async () => {
      // Mock fetch
      global.fetch = jest.fn().mockResolvedValue({
        ok: true,
        json: () => Promise.resolve({ accessToken: 'new-token' })
      });

      tokenManager.setAccessToken('old-token');
      const newToken = await tokenManager.refreshAccessToken();

      expect(newToken).toBe('new-token');
      expect(tokenManager.getAccessToken()).toBe('new-token');
    });
  });
});
```

### 8.4 E2Eæµ‹è¯•å®ç°

#### 8.4.1 ç”¨æˆ·æµç¨‹æµ‹è¯•

```typescript
// cypress/integration/user-flow.spec.ts
describe('User Flow E2E Tests', () => {
  beforeEach(() => {
    cy.visit('/');
  });

  describe('Security Features', () => {
    it('should prevent XSS attacks in user input', () => {
      cy.get('[data-testid="search-input"]').type(
        '<script>alert("xss")</script>'
      );

      cy.get('[data-testid="search-results"]').should(
        'not.contain',
        '<script>'
      );

      cy.get('[data-testid="search-results"]').should(
        'contain',
        'alert("xss")'
      ); // Sanitized content
    });

    it('should handle token expiration gracefully', () => {
      // Login
      cy.login('test@example.com', 'password');

      // Simulate token expiration
      cy.window().then(win => {
        win.localStorage.removeItem('access_token');
      });

      // Make API request
      cy.get('[data-testid="profile-button"]').click();

      // Should redirect to login
      cy.url().should('include', '/login');
    });
  });

  describe('Performance Features', () => {
    it('should load pages within performance thresholds', () => {
      cy.visit('/', {
        onBeforeLoad: win => {
          win.performance.mark('start');
        },
      });

      cy.get('[data-testid="main-content"]').should('be.visible');

      cy.window().then(win => {
        win.performance.mark('end');
        win.performance.measure('page-load', 'start', 'end');

        const measure = win.performance.getEntriesByName('page-load')[0];
        expect(measure.duration).to.be.lessThan(2500); // 2.5s threshold
      });
    });

    it('should cache API responses effectively', () => {
      // First request
      cy.intercept('GET', '/api/products', { fixture: 'products.json' }).as(
        'getProducts'
      );
      cy.visit('/products');
      cy.wait('@getProducts');

      // Second request should use cache
      cy.reload();
      cy.get('[data-testid="product-list"]').should('be.visible');

      // Verify cache hit (no network request)
      cy.get('@getProducts.all').should('have.length', 1);
    });
  });
});
```

### 8.5 æ€§èƒ½æµ‹è¯•

#### 8.5.1 è´Ÿè½½æµ‹è¯•

```typescript
// cypress/integration/performance.spec.ts
describe('Performance Tests', () => {
  it('should handle concurrent users', () => {
    const userCount = 10;
    const promises = [];

    for (let i = 0; i < userCount; i++) {
      promises.push(
        cy.task('simulateUser', {
          userId: i,
          actions: ['login', 'browse', 'search', 'logout'],
        })
      );
    }

    cy.wrap(Promise.all(promises)).then(results => {
      results.forEach((result, index) => {
        expect(result.success).to.be.true;
        expect(result.averageResponseTime).to.be.lessThan(1000);
      });
    });
  });

  it('should maintain performance under memory pressure', () => {
    // Simulate memory pressure
    cy.window().then(win => {
      const largeArray = new Array(1000000).fill('memory-pressure-test');
      win.testData = largeArray;
    });

    // Perform operations
    cy.get('[data-testid="search-input"]').type('test query');
    cy.get('[data-testid="search-button"]').click();

    // Verify performance
    cy.window().then(win => {
      const memory = (win.performance as any).memory;
      if (memory) {
        expect(memory.usedJSHeapSize).to.be.lessThan(100 * 1024 * 1024); // 100MB
      }
    });
  });
});
```

### 8.6 ä»£ç è´¨é‡ä¿éšœ

#### 8.6.1 é™æ€åˆ†æé…ç½®

```json
// .eslintrc.json
{
  "extends": [
    "react-app",
    "react-app/jest",
    "@typescript-eslint/recommended",
    "plugin:security/recommended"
  ],
  "plugins": ["security", "react-hooks"],
  "rules": {
    "security/detect-object-injection": "error",
    "security/detect-non-literal-regexp": "error",
    "security/detect-unsafe-regex": "error",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  },
  "overrides": [
    {
      "files": ["**/*.test.ts", "**/*.test.tsx"],
      "rules": {
        "@typescript-eslint/no-explicit-any": "off"
      }
    }
  ]
}
```

#### 8.6.2 ä»£ç è¦†ç›–ç‡æŠ¥å‘Š

**è¦†ç›–ç‡é…ç½®ï¼š**

```typescript
// jest.config.js
module.exports = {
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/index.tsx',
    '!src/serviceWorker.ts',
    '!src/**/*.stories.{ts,tsx}',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
    './src/utils/': {
      branches: 90,
      functions: 90,
      lines: 90,
      statements: 90,
    },
  },
  coverageReporters: ['text', 'lcov', 'html'],
  coverageDirectory: 'coverage',
};
```

## 9. ç›‘æ§ä½“ç³»å’Œè¿ç»´æ”¹è¿›

### 9.1 æ€§èƒ½ç›‘æ§ä½“ç³»

#### 9.1.1 å®æ—¶ç›‘æ§æ¶æ„

```mermaid
graph TB
    subgraph "å‰ç«¯ç›‘æ§"
        A[Web Vitals] --> B[æ€§èƒ½æŒ‡æ ‡æ”¶é›†]
        C[ç”¨æˆ·è¡Œä¸º] --> D[è¡Œä¸ºåˆ†æ]
        E[é”™è¯¯ç›‘æ§] --> F[å¼‚å¸¸æ•è·]
    end

    subgraph "æ•°æ®å¤„ç†"
        B --> G[æŒ‡æ ‡èšåˆ]
        D --> H[è¡Œä¸ºåˆ†æ]
        F --> I[é”™è¯¯åˆ†ç±»]
    end

    subgraph "å¯è§†åŒ–å±•ç¤º"
        G --> J[å®æ—¶é¢æ¿]
        H --> K[ç”¨æˆ·æ´å¯Ÿ]
        I --> L[å‘Šè­¦ç³»ç»Ÿ]
    end

    subgraph "ç¬¬ä¸‰æ–¹é›†æˆ"
        J --> M[Google Analytics]
        K --> N[Sentry]
        L --> O[DataDog]
    end
```

**ç›‘æ§æŒ‡æ ‡ä½“ç³»ï¼š**

| ç›‘æ§ç»´åº¦     | æ ¸å¿ƒæŒ‡æ ‡           | é‡‡é›†é¢‘ç‡ | å‘Šè­¦é˜ˆå€¼   | å¤„ç†ç­–ç•¥ |
| ------------ | ------------------ | -------- | ---------- | -------- |
| **æ€§èƒ½ç›‘æ§** | LCP, FID, CLS      | å®æ—¶     | LCP>2.5s   | è‡ªåŠ¨ä¼˜åŒ– |
| **é”™è¯¯ç›‘æ§** | JSé”™è¯¯, APIé”™è¯¯    | å®æ—¶     | é”™è¯¯ç‡>5%  | ç«‹å³å‘Šè­¦ |
| **ç”¨æˆ·ä½“éªŒ** | é¡µé¢åŠ è½½, äº¤äº’å“åº” | å®æ—¶     | å“åº”>1s    | æ€§èƒ½è°ƒä¼˜ |
| **èµ„æºç›‘æ§** | å†…å­˜, CPU, ç½‘ç»œ    | 30ç§’     | å†…å­˜>200MB | èµ„æºæ¸…ç† |
| **ä¸šåŠ¡ç›‘æ§** | è½¬åŒ–ç‡, ç”¨æˆ·ç•™å­˜   | 5åˆ†é’Ÿ    | è½¬åŒ–ç‡<80% | ä¸šåŠ¡åˆ†æ |

#### 9.1.2 Core Web Vitals ç›‘æ§å®ç°

**è¯¦ç»†ç›‘æ§ä»£ç ï¼š**

```typescript
// src/utils/webVitalsMonitor.ts
export class WebVitalsMonitor {
  private metrics: Map<string, PerformanceMetric[]> = new Map();
  private observers: PerformanceObserver[] = [];
  private reportingEndpoint = '/api/metrics/web-vitals';

  public startMonitoring(): void {
    this.monitorLCP();
    this.monitorFID();
    this.monitorCLS();
    this.monitorFCP();
    this.monitorTTFB();
  }

  // ç›‘æ§ Largest Contentful Paint
  private monitorLCP(): void {
    const observer = new PerformanceObserver(list => {
      const entries = list.getEntries();
      const lastEntry = entries[entries.length - 1];

      this.recordMetric('LCP', lastEntry.startTime, {
        element: (lastEntry as any).element?.tagName || 'unknown',
        url: window.location.pathname,
        timestamp: Date.now(),
      });

      // æ£€æŸ¥æ€§èƒ½é˜ˆå€¼
      if (lastEntry.startTime > 2500) {
        this.triggerPerformanceAlert('LCP', lastEntry.startTime, 2500);
      }
    });

    observer.observe({ entryTypes: ['largest-contentful-paint'] });
    this.observers.push(observer);
  }

  // ç›‘æ§ First Input Delay
  private monitorFID(): void {
    const observer = new PerformanceObserver(list => {
      const entries = list.getEntries();
      entries.forEach(entry => {
        const fid = (entry as any).processingStart - entry.startTime;

        this.recordMetric('FID', fid, {
          eventType: (entry as any).name,
          target: (entry as any).target?.tagName || 'unknown',
          timestamp: Date.now(),
        });

        if (fid > 100) {
          this.triggerPerformanceAlert('FID', fid, 100);
        }
      });
    });

    observer.observe({ entryTypes: ['first-input'] });
    this.observers.push(observer);
  }

  // ç›‘æ§ Cumulative Layout Shift
  private monitorCLS(): void {
    let clsValue = 0;
    let sessionValue = 0;
    let sessionEntries: any[] = [];

    const observer = new PerformanceObserver(list => {
      const entries = list.getEntries();

      entries.forEach(entry => {
        if (!(entry as any).hadRecentInput) {
          const firstSessionEntry = sessionEntries[0];
          const lastSessionEntry = sessionEntries[sessionEntries.length - 1];

          if (
            sessionValue &&
            entry.startTime - lastSessionEntry.startTime < 1000 &&
            entry.startTime - firstSessionEntry.startTime < 5000
          ) {
            sessionValue += (entry as any).value;
            sessionEntries.push(entry);
          } else {
            sessionValue = (entry as any).value;
            sessionEntries = [entry];
          }

          if (sessionValue > clsValue) {
            clsValue = sessionValue;

            this.recordMetric('CLS', clsValue, {
              sources: (entry as any).sources?.length || 0,
              timestamp: Date.now(),
            });

            if (clsValue > 0.1) {
              this.triggerPerformanceAlert('CLS', clsValue, 0.1);
            }
          }
        }
      });
    });

    observer.observe({ entryTypes: ['layout-shift'] });
    this.observers.push(observer);
  }

  // æ€§èƒ½å‘Šè­¦è§¦å‘
  private triggerPerformanceAlert(
    metric: string,
    value: number,
    threshold: number
  ): void {
    const alert = {
      type: 'performance_degradation',
      metric,
      value,
      threshold,
      timestamp: Date.now(),
      url: window.location.href,
      userAgent: navigator.userAgent,
    };

    // å‘é€å‘Šè­¦
    this.sendAlert(alert);

    // æœ¬åœ°æ—¥å¿—
    console.warn(
      `ğŸš¨ Performance Alert: ${metric} = ${value.toFixed(2)} (threshold: ${threshold})`
    );
  }

  // å‘é€å‘Šè­¦åˆ°ç›‘æ§ç³»ç»Ÿ
  private async sendAlert(alert: any): Promise<void> {
    try {
      await fetch('/api/alerts/performance', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(alert),
      });
    } catch (error) {
      console.error('Failed to send performance alert:', error);
    }
  }
}
```

### 9.2 é”™è¯¯ç›‘æ§å’Œå¼‚å¸¸å¤„ç†

#### 9.2.1 å…¨å±€é”™è¯¯æ•è·

**é”™è¯¯ç›‘æ§å®ç°ï¼š**

```typescript
// src/utils/errorMonitor.ts
export class ErrorMonitor {
  private errorQueue: ErrorReport[] = [];
  private maxQueueSize = 100;
  private flushInterval = 30000; // 30ç§’
  private reportingEndpoint = '/api/errors';

  constructor() {
    this.setupGlobalErrorHandlers();
    this.startErrorReporting();
  }

  // è®¾ç½®å…¨å±€é”™è¯¯å¤„ç†å™¨
  private setupGlobalErrorHandlers(): void {
    // JavaScript é”™è¯¯
    window.addEventListener('error', event => {
      this.captureError({
        type: 'javascript',
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        stack: event.error?.stack,
        timestamp: Date.now(),
        url: window.location.href,
      });
    });

    // Promise æ‹’ç»é”™è¯¯
    window.addEventListener('unhandledrejection', event => {
      this.captureError({
        type: 'promise_rejection',
        message: event.reason?.message || 'Unhandled Promise Rejection',
        stack: event.reason?.stack,
        timestamp: Date.now(),
        url: window.location.href,
      });
    });

    // èµ„æºåŠ è½½é”™è¯¯
    window.addEventListener(
      'error',
      event => {
        if (event.target !== window) {
          this.captureError({
            type: 'resource',
            message: `Failed to load resource: ${(event.target as any)?.src || (event.target as any)?.href}`,
            element: (event.target as any)?.tagName,
            timestamp: Date.now(),
            url: window.location.href,
          });
        }
      },
      true
    );
  }

  // æ•è·é”™è¯¯
  public captureError(error: Partial<ErrorReport>): void {
    const errorReport: ErrorReport = {
      id: this.generateErrorId(),
      type: error.type || 'unknown',
      message: error.message || 'Unknown error',
      stack: error.stack,
      filename: error.filename,
      lineno: error.lineno,
      colno: error.colno,
      timestamp: error.timestamp || Date.now(),
      url: error.url || window.location.href,
      userAgent: navigator.userAgent,
      userId: this.getCurrentUserId(),
      sessionId: this.getSessionId(),
      breadcrumbs: this.getBreadcrumbs(),
    };

    this.errorQueue.push(errorReport);

    // é˜Ÿåˆ—æ»¡æ—¶ç«‹å³å‘é€
    if (this.errorQueue.length >= this.maxQueueSize) {
      this.flushErrors();
    }

    // å…³é”®é”™è¯¯ç«‹å³å‘é€
    if (this.isCriticalError(errorReport)) {
      this.sendErrorImmediately(errorReport);
    }
  }

  // åˆ¤æ–­æ˜¯å¦ä¸ºå…³é”®é”™è¯¯
  private isCriticalError(error: ErrorReport): boolean {
    const criticalPatterns = [
      /payment/i,
      /checkout/i,
      /security/i,
      /authentication/i,
      /authorization/i,
    ];

    return criticalPatterns.some(
      pattern => pattern.test(error.message) || pattern.test(error.url)
    );
  }

  // ç«‹å³å‘é€é”™è¯¯
  private async sendErrorImmediately(error: ErrorReport): Promise<void> {
    try {
      await fetch(`${this.reportingEndpoint}/critical`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(error),
      });
    } catch (err) {
      console.error('Failed to send critical error:', err);
    }
  }

  // æ‰¹é‡å‘é€é”™è¯¯
  private async flushErrors(): Promise<void> {
    if (this.errorQueue.length === 0) return;

    const errors = [...this.errorQueue];
    this.errorQueue = [];

    try {
      await fetch(this.reportingEndpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ errors }),
      });
    } catch (error) {
      console.error('Failed to send error batch:', error);
      // é‡æ–°åŠ å…¥é˜Ÿåˆ—
      this.errorQueue.unshift(...errors);
    }
  }

  // å¯åŠ¨é”™è¯¯æŠ¥å‘Š
  private startErrorReporting(): void {
    setInterval(() => {
      this.flushErrors();
    }, this.flushInterval);

    // é¡µé¢å¸è½½æ—¶å‘é€å‰©ä½™é”™è¯¯
    window.addEventListener('beforeunload', () => {
      if (this.errorQueue.length > 0) {
        navigator.sendBeacon(
          this.reportingEndpoint,
          JSON.stringify({ errors: this.errorQueue })
        );
      }
    });
  }
}
```

### 9.3 ç”¨æˆ·è¡Œä¸ºåˆ†æ

#### 9.3.1 ç”¨æˆ·äº¤äº’è¿½è¸ª

**è¡Œä¸ºåˆ†æå®ç°ï¼š**

```typescript
// src/utils/userBehaviorTracker.ts
export class UserBehaviorTracker {
  private events: UserEvent[] = [];
  private sessionStart: number = Date.now();
  private heatmapData: HeatmapPoint[] = [];
  private scrollDepth: number = 0;

  constructor() {
    this.setupEventListeners();
    this.startSessionTracking();
  }

  // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
  private setupEventListeners(): void {
    // ç‚¹å‡»äº‹ä»¶
    document.addEventListener('click', event => {
      this.trackEvent({
        type: 'click',
        target: this.getElementSelector(event.target as Element),
        coordinates: { x: event.clientX, y: event.clientY },
        timestamp: Date.now(),
      });

      // çƒ­åŠ›å›¾æ•°æ®
      this.addHeatmapPoint(event.clientX, event.clientY, 'click');
    });

    // æ»šåŠ¨äº‹ä»¶
    let scrollTimeout: number;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = window.setTimeout(() => {
        const scrollPercent = Math.round(
          (window.scrollY / (document.body.scrollHeight - window.innerHeight)) *
            100
        );

        if (scrollPercent > this.scrollDepth) {
          this.scrollDepth = scrollPercent;
          this.trackEvent({
            type: 'scroll',
            data: { depth: scrollPercent },
            timestamp: Date.now(),
          });
        }
      }, 100);
    });

    // è¡¨å•äº¤äº’
    document.addEventListener('input', event => {
      if (
        event.target instanceof HTMLInputElement ||
        event.target instanceof HTMLTextAreaElement
      ) {
        this.trackEvent({
          type: 'form_input',
          target: this.getElementSelector(event.target),
          data: {
            fieldType: event.target.type,
            valueLength: event.target.value.length,
          },
          timestamp: Date.now(),
        });
      }
    });

    // é¡µé¢åœç•™æ—¶é—´
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        this.trackEvent({
          type: 'page_hidden',
          data: { duration: Date.now() - this.sessionStart },
          timestamp: Date.now(),
        });
      } else {
        this.sessionStart = Date.now();
        this.trackEvent({
          type: 'page_visible',
          timestamp: Date.now(),
        });
      }
    });
  }

  // è¿½è¸ªè‡ªå®šä¹‰äº‹ä»¶
  public trackCustomEvent(eventName: string, data?: any): void {
    this.trackEvent({
      type: 'custom',
      name: eventName,
      data,
      timestamp: Date.now(),
    });
  }

  // è¿½è¸ªé¡µé¢æ€§èƒ½
  public trackPagePerformance(): void {
    if ('performance' in window) {
      const navigation = performance.getEntriesByType(
        'navigation'
      )[0] as PerformanceNavigationTiming;

      this.trackEvent({
        type: 'page_performance',
        data: {
          loadTime: navigation.loadEventEnd - navigation.loadEventStart,
          domContentLoaded:
            navigation.domContentLoadedEventEnd -
            navigation.domContentLoadedEventStart,
          firstPaint: this.getFirstPaint(),
          firstContentfulPaint: this.getFirstContentfulPaint(),
        },
        timestamp: Date.now(),
      });
    }
  }

  // è·å–å…ƒç´ é€‰æ‹©å™¨
  private getElementSelector(element: Element): string {
    if (element.id) {
      return `#${element.id}`;
    }

    if (element.className) {
      return `.${element.className.split(' ')[0]}`;
    }

    return element.tagName.toLowerCase();
  }

  // æ·»åŠ çƒ­åŠ›å›¾ç‚¹
  private addHeatmapPoint(x: number, y: number, type: string): void {
    this.heatmapData.push({
      x,
      y,
      type,
      timestamp: Date.now(),
      viewport: {
        width: window.innerWidth,
        height: window.innerHeight,
      },
    });

    // é™åˆ¶çƒ­åŠ›å›¾æ•°æ®å¤§å°
    if (this.heatmapData.length > 1000) {
      this.heatmapData = this.heatmapData.slice(-500);
    }
  }

  // ç”Ÿæˆç”¨æˆ·è¡Œä¸ºæŠ¥å‘Š
  public generateBehaviorReport(): UserBehaviorReport {
    const sessionDuration = Date.now() - this.sessionStart;
    const clickEvents = this.events.filter(e => e.type === 'click');
    const scrollEvents = this.events.filter(e => e.type === 'scroll');

    return {
      sessionId: this.getSessionId(),
      userId: this.getCurrentUserId(),
      sessionDuration,
      totalEvents: this.events.length,
      clickCount: clickEvents.length,
      maxScrollDepth: this.scrollDepth,
      heatmapData: this.heatmapData,
      events: this.events,
      timestamp: Date.now(),
    };
  }
}
```

### 9.4 å®æ—¶ç›‘æ§é¢æ¿

#### 9.4.1 ç›‘æ§é¢æ¿ç»„ä»¶å¢å¼º

**é«˜çº§ç›‘æ§é¢æ¿ï¼š**

```tsx
// src/components/monitoring/AdvancedMonitoringDashboard.tsx
export const AdvancedMonitoringDashboard: React.FC = () => {
  const [metrics, setMetrics] = useState<MetricsData>({});
  const [alerts, setAlerts] = useState<Alert[]>([]);
  const [isRealTime, setIsRealTime] = useState(true);
  const [timeRange, setTimeRange] = useState('1h');

  // å®æ—¶æ•°æ®æ›´æ–°
  useEffect(() => {
    if (!isRealTime) return;

    const interval = setInterval(async () => {
      try {
        const [metricsData, alertsData] = await Promise.all([
          fetch('/api/metrics/current').then(r => r.json()),
          fetch('/api/alerts/active').then(r => r.json()),
        ]);

        setMetrics(metricsData);
        setAlerts(alertsData);
      } catch (error) {
        console.error('Failed to fetch monitoring data:', error);
      }
    }, 5000); // 5ç§’æ›´æ–°

    return () => clearInterval(interval);
  }, [isRealTime]);

  return (
    <div className='monitoring-dashboard'>
      {/* æ§åˆ¶é¢æ¿ */}
      <Card className='dashboard-controls'>
        <Space>
          <Switch
            checked={isRealTime}
            onChange={setIsRealTime}
            checkedChildren='å®æ—¶'
            unCheckedChildren='æš‚åœ'
          />
          <Select value={timeRange} onChange={setTimeRange}>
            <Option value='5m'>5åˆ†é’Ÿ</Option>
            <Option value='1h'>1å°æ—¶</Option>
            <Option value='24h'>24å°æ—¶</Option>
            <Option value='7d'>7å¤©</Option>
          </Select>
          <Button
            icon={<ReloadOutlined />}
            onClick={() => window.location.reload()}
          >
            åˆ·æ–°
          </Button>
        </Space>
      </Card>

      {/* å…³é”®æŒ‡æ ‡æ¦‚è§ˆ */}
      <Row gutter={[16, 16]}>
        <Col span={6}>
          <MetricCard
            title='ç³»ç»Ÿå¥åº·åº¦'
            value={metrics.healthScore || 0}
            suffix='/100'
            status={getHealthStatus(metrics.healthScore)}
            trend={metrics.healthTrend}
          />
        </Col>
        <Col span={6}>
          <MetricCard
            title='æ´»è·ƒç”¨æˆ·'
            value={metrics.activeUsers || 0}
            suffix='äºº'
            status='normal'
            trend={metrics.userTrend}
          />
        </Col>
        <Col span={6}>
          <MetricCard
            title='é”™è¯¯ç‡'
            value={((metrics.errorRate || 0) * 100).toFixed(2)}
            suffix='%'
            status={metrics.errorRate > 0.05 ? 'error' : 'normal'}
            trend={metrics.errorTrend}
          />
        </Col>
        <Col span={6}>
          <MetricCard
            title='å¹³å‡å“åº”æ—¶é—´'
            value={metrics.avgResponseTime || 0}
            suffix='ms'
            status={metrics.avgResponseTime > 1000 ? 'warning' : 'normal'}
            trend={metrics.responseTrend}
          />
        </Col>
      </Row>

      {/* å‘Šè­¦é¢æ¿ */}
      {alerts.length > 0 && (
        <Card title='æ´»è·ƒå‘Šè­¦' className='alerts-panel'>
          <List
            dataSource={alerts}
            renderItem={alert => (
              <List.Item>
                <Alert
                  type={alert.severity}
                  message={alert.title}
                  description={alert.description}
                  showIcon
                  action={
                    <Button
                      size='small'
                      onClick={() => handleAlertAction(alert.id)}
                    >
                      å¤„ç†
                    </Button>
                  }
                />
              </List.Item>
            )}
          />
        </Card>
      )}

      {/* æ€§èƒ½å›¾è¡¨ */}
      <Row gutter={[16, 16]}>
        <Col span={12}>
          <PerformanceChart
            title='Core Web Vitals'
            data={metrics.webVitals}
            timeRange={timeRange}
          />
        </Col>
        <Col span={12}>
          <ErrorChart
            title='é”™è¯¯è¶‹åŠ¿'
            data={metrics.errors}
            timeRange={timeRange}
          />
        </Col>
      </Row>

      {/* ç”¨æˆ·è¡Œä¸ºçƒ­åŠ›å›¾ */}
      <Card title='ç”¨æˆ·è¡Œä¸ºçƒ­åŠ›å›¾'>
        <HeatmapVisualization data={metrics.heatmapData} />
      </Card>

      {/* ç³»ç»Ÿèµ„æºç›‘æ§ */}
      <Row gutter={[16, 16]}>
        <Col span={8}>
          <ResourceChart
            title='å†…å­˜ä½¿ç”¨'
            data={metrics.memory}
            unit='MB'
            threshold={200}
          />
        </Col>
        <Col span={8}>
          <ResourceChart
            title='CPUä½¿ç”¨ç‡'
            data={metrics.cpu}
            unit='%'
            threshold={80}
          />
        </Col>
        <Col span={8}>
          <ResourceChart
            title='ç½‘ç»œæµé‡'
            data={metrics.network}
            unit='KB/s'
            threshold={1000}
          />
        </Col>
      </Row>
    </div>
  );
};
```

## 10. é‡åˆ°çš„æŠ€æœ¯æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ

### 10.1 å†…å­˜æ³„æ¼é—®é¢˜

#### 10.1.1 æŒ‘æˆ˜æè¿°

**é—®é¢˜ç°è±¡ï¼š**

- åº”ç”¨è¿è¡Œ4-8å°æ—¶åå†…å­˜å ç”¨ä»45MBå¢é•¿åˆ°450MB
- é¡µé¢åˆ‡æ¢æ—¶å†…å­˜ä¸é‡Šæ”¾ï¼ŒæŒç»­ç´¯ç§¯
- é•¿æ—¶é—´ä½¿ç”¨å¯¼è‡´æµè§ˆå™¨å¡é¡¿ç”šè‡³å´©æºƒ

**æ ¹æœ¬åŸå› åˆ†æï¼š**

```typescript
// é—®é¢˜ä»£ç ç¤ºä¾‹
class ProblematicComponent {
  private observer: MutationObserver;
  private timer: number;

  componentDidMount() {
    // é—®é¢˜1: MutationObserveræœªæ¸…ç†
    this.observer = new MutationObserver(() => {
      // å¤„ç†DOMå˜åŒ–
    });
    this.observer.observe(document.body, { childList: true });

    // é—®é¢˜2: å®šæ—¶å™¨æœªæ¸…ç†
    this.timer = setInterval(() => {
      // å®šæœŸä»»åŠ¡
    }, 1000);

    // é—®é¢˜3: äº‹ä»¶ç›‘å¬å™¨æœªç§»é™¤
    window.addEventListener('resize', this.handleResize);
  }

  // ç¼ºå°‘æ¸…ç†é€»è¾‘
  componentWillUnmount() {
    // æ²¡æœ‰æ¸…ç†èµ„æºï¼
  }
}
```

#### 10.1.2 è§£å†³æ–¹æ¡ˆ

**ç»Ÿä¸€èµ„æºç®¡ç†ç­–ç•¥ï¼š**

```typescript
// è§£å†³æ–¹æ¡ˆï¼šResourceManager
class ResourceManager {
  private resources: Map<string, ResourceGroup> = new Map();

  // åˆ›å»ºèµ„æºç»„
  public createResourceGroup(groupId: string): string {
    const group: ResourceGroup = {
      id: groupId,
      observers: [],
      timers: [],
      eventListeners: [],
      cleanupHandlers: [],
    };
    this.resources.set(groupId, group);
    return groupId;
  }

  // è‡ªåŠ¨æ¸…ç†
  public cleanupResourceGroup(groupId: string): void {
    const group = this.resources.get(groupId);
    if (!group) return;

    // æ¸…ç†æ‰€æœ‰èµ„æºç±»å‹
    this.cleanupObservers(group);
    this.cleanupTimers(group);
    this.cleanupEventListeners(group);
    this.executeCustomCleanup(group);

    this.resources.delete(groupId);
  }
}

// ä¿®å¤åçš„ç»„ä»¶
class FixedComponent {
  private resourceManager = ResourceManager.getInstance();
  private groupId: string;

  componentDidMount() {
    this.groupId = this.resourceManager.createResourceGroup('FixedComponent');

    // æ³¨å†Œèµ„æºåˆ°ç®¡ç†å™¨
    const observer = new MutationObserver(() => {});
    this.resourceManager.registerObserver(observer, this.groupId);

    const timer = setInterval(() => {}, 1000);
    this.resourceManager.registerTimer(timer, this.groupId);

    this.resourceManager.registerEventListener(
      window,
      'resize',
      this.handleResize,
      this.groupId
    );
  }

  componentWillUnmount() {
    // ä¸€é”®æ¸…ç†æ‰€æœ‰èµ„æº
    this.resourceManager.cleanupResourceGroup(this.groupId);
  }
}
```

**æ•ˆæœéªŒè¯ï¼š**

- å†…å­˜å ç”¨ä»450MBé™è‡³85MBï¼ˆâ¬‡ï¸ 81%ï¼‰
- é¡µé¢åˆ‡æ¢æ—¶å†…å­˜æ­£ç¡®é‡Šæ”¾
- é•¿æ—¶é—´ä½¿ç”¨æ— å†…å­˜æ³„æ¼ç°è±¡

### 10.2 XSSé˜²æŠ¤ç»•è¿‡é—®é¢˜

#### 10.2.1 æŒ‘æˆ˜æè¿°

**å®‰å…¨æ¼æ´å‘ç°ï¼š**

```typescript
// åŸæœ‰çš„ä¸å®‰å…¨å®ç°
class BasicHTMLSanitizer {
  sanitize(html: string): string {
    // ç®€å•çš„å­—ç¬¦ä¸²æ›¿æ¢ - å®¹æ˜“è¢«ç»•è¿‡
    return html
      .replace(/<script[^>]*>.*?<\/script>/gi, '')
      .replace(/javascript:/gi, '')
      .replace(/on\w+\s*=/gi, '');
  }
}

// ç»•è¿‡ç¤ºä¾‹
const maliciousInput = `
  <img src="x" onerror="alert('XSS')" />
  <svg onload="alert('XSS')" />
  <iframe src="javascript:alert('XSS')"></iframe>
`;
```

**ç»•è¿‡æµ‹è¯•ç»“æœï¼š**
| æ”»å‡»å‘é‡ | åŸå®ç°ç»“æœ | ç»•è¿‡æˆåŠŸç‡ |
|----------|------------|------------|
| `<script>` æ ‡ç­¾ | è¢«é˜»æ­¢ | 0% |
| äº‹ä»¶å¤„ç†å™¨ | éƒ¨åˆ†ç»•è¿‡ | 60% |
| JavaScriptä¼ªåè®® | éƒ¨åˆ†ç»•è¿‡ | 40% |
| SVG/iframeæ³¨å…¥ | å®Œå…¨ç»•è¿‡ | 100% |

#### 10.2.2 è§£å†³æ–¹æ¡ˆ

**DOMPurifyé›†æˆç­–ç•¥ï¼š**

```typescript
// ä¼ä¸šçº§XSSé˜²æŠ¤å®ç°
import DOMPurify from 'dompurify';

export class EnterpriseXSSProtection {
  private static readonly SECURITY_POLICIES = {
    STRICT: {
      ALLOWED_TAGS: ['p', 'br', 'strong', 'em'],
      ALLOWED_ATTR: [],
      FORBID_TAGS: ['script', 'object', 'embed', 'iframe', 'form'],
      FORBID_ATTR: ['onerror', 'onload', 'onclick', 'onmouseover'],
      SANITIZE_DOM: true,
      KEEP_CONTENT: false,
    },
    CONTENT: {
      ALLOWED_TAGS: [
        'p',
        'br',
        'strong',
        'em',
        'u',
        'ol',
        'ul',
        'li',
        'h1',
        'h2',
        'h3',
      ],
      ALLOWED_ATTR: ['class', 'id'],
      FORBID_TAGS: ['script', 'object', 'embed', 'iframe'],
      SANITIZE_DOM: true,
    },
  };

  public static sanitizeHTML(
    dirty: string,
    policy: 'STRICT' | 'CONTENT' = 'STRICT'
  ): string {
    try {
      const config = this.SECURITY_POLICIES[policy];
      const clean = DOMPurify.sanitize(dirty, config);

      // å®‰å…¨æ—¥å¿—è®°å½•
      if (dirty !== clean) {
        this.logSecurityEvent('xss_attempt_blocked', {
          original: dirty.substring(0, 100),
          cleaned: clean.substring(0, 100),
          policy,
          timestamp: Date.now(),
        });
      }

      return clean;
    } catch (error) {
      console.error('XSS sanitization failed:', error);
      return ''; // å¤±è´¥æ—¶è¿”å›ç©ºå­—ç¬¦ä¸²ç¡®ä¿å®‰å…¨
    }
  }

  // å¤šå±‚éªŒè¯
  public static validateAndSanitize(input: string): ValidationResult {
    // ç¬¬ä¸€å±‚ï¼šé•¿åº¦æ£€æŸ¥
    if (input.length > 10000) {
      return { isValid: false, error: 'Input too long', sanitized: '' };
    }

    // ç¬¬äºŒå±‚ï¼šé»‘åå•æ£€æŸ¥
    const dangerousPatterns = [
      /<script[^>]*>.*?<\/script>/gi,
      /javascript:/gi,
      /data:text\/html/gi,
      /vbscript:/gi,
    ];

    for (const pattern of dangerousPatterns) {
      if (pattern.test(input)) {
        this.logSecurityEvent('dangerous_pattern_detected', {
          pattern: pattern.source,
          input: input.substring(0, 100),
        });
        return {
          isValid: false,
          error: 'Dangerous content detected',
          sanitized: '',
        };
      }
    }

    // ç¬¬ä¸‰å±‚ï¼šDOMPurifyæ¸…ç†
    const sanitized = this.sanitizeHTML(input, 'STRICT');

    return {
      isValid: true,
      sanitized,
      originalLength: input.length,
      sanitizedLength: sanitized.length,
    };
  }
}
```

**é˜²æŠ¤æ•ˆæœéªŒè¯ï¼š**
| æ”»å‡»å‘é‡ | æ–°å®ç°ç»“æœ | é˜»æ–­ç‡ |
|----------|------------|--------|
| `<script>` æ ‡ç­¾ | å®Œå…¨æ¸…é™¤ | 100% |
| äº‹ä»¶å¤„ç†å™¨ | å®Œå…¨æ¸…é™¤ | 100% |
| JavaScriptä¼ªåè®® | å®Œå…¨æ¸…é™¤ | 100% |
| SVG/iframeæ³¨å…¥ | å®Œå…¨æ¸…é™¤ | 100% |
| Data URIæ”»å‡» | å®Œå…¨æ¸…é™¤ | 100% |

### 10.3 ç¼“å­˜å†…å­˜æ³„æ¼é—®é¢˜

#### 10.3.1 æŒ‘æˆ˜æè¿°

**é—®é¢˜åˆ†æï¼š**

```typescript
// æœ‰é—®é¢˜çš„ç¼“å­˜å®ç°
class ProblematicCache {
  private cache: Map<string, any> = new Map();

  set(key: string, value: any): void {
    this.cache.set(key, value);
    // é—®é¢˜ï¼šæ²¡æœ‰å¤§å°é™åˆ¶ï¼Œæ— é™å¢é•¿
  }

  get(key: string): any {
    return this.cache.get(key);
    // é—®é¢˜ï¼šæ²¡æœ‰TTLæ£€æŸ¥ï¼Œè¿‡æœŸæ•°æ®æ°¸ä¸æ¸…ç†
  }
}
```

**å†…å­˜å¢é•¿æ¨¡å¼ï¼š**

```mermaid
graph LR
    A[0MB] --> B[10MB - 1å°æ—¶]
    B --> C[50MB - 4å°æ—¶]
    C --> D[200MB - 8å°æ—¶]
    D --> E[500MB - 12å°æ—¶]
    E --> F[æµè§ˆå™¨å´©æºƒ]
```

#### 10.3.2 è§£å†³æ–¹æ¡ˆ

**LRUç®—æ³•å®ç°ï¼š**

```typescript
// é«˜æ•ˆçš„LRUç¼“å­˜å®ç°
export class LRUCacheManager<T> {
  private capacity: number;
  private cache: Map<string, CacheNode<T>>;
  private head: CacheNode<T>;
  private tail: CacheNode<T>;

  constructor(capacity: number = 100) {
    this.capacity = capacity;
    this.cache = new Map();

    // åŒå‘é“¾è¡¨å¤´å°¾èŠ‚ç‚¹
    this.head = {
      key: '',
      value: null as any,
      prev: null,
      next: null,
      timestamp: 0,
    };
    this.tail = {
      key: '',
      value: null as any,
      prev: null,
      next: null,
      timestamp: 0,
    };
    this.head.next = this.tail;
    this.tail.prev = this.head;
  }

  get(key: string): T | null {
    const node = this.cache.get(key);

    if (!node) return null;

    // TTLæ£€æŸ¥
    if (this.isExpired(node)) {
      this.delete(key);
      return null;
    }

    // ç§»åŠ¨åˆ°å¤´éƒ¨ï¼ˆæœ€è¿‘ä½¿ç”¨ï¼‰
    this.moveToHead(node);
    node.timestamp = Date.now();

    return node.value;
  }

  set(key: string, value: T, ttl?: number): void {
    const existingNode = this.cache.get(key);

    if (existingNode) {
      // æ›´æ–°ç°æœ‰èŠ‚ç‚¹
      existingNode.value = value;
      existingNode.timestamp = Date.now();
      existingNode.ttl = ttl;
      this.moveToHead(existingNode);
    } else {
      // åˆ›å»ºæ–°èŠ‚ç‚¹
      const newNode: CacheNode<T> = {
        key,
        value,
        prev: null,
        next: null,
        timestamp: Date.now(),
        ttl,
      };

      this.cache.set(key, newNode);
      this.addToHead(newNode);

      // å®¹é‡æ£€æŸ¥
      if (this.cache.size > this.capacity) {
        const tail = this.removeTail();
        if (tail) {
          this.cache.delete(tail.key);
        }
      }
    }
  }

  // è‡ªåŠ¨æ¸…ç†è¿‡æœŸé¡¹
  private startCleanupTimer(): void {
    setInterval(() => {
      this.cleanupExpired();
    }, 60000); // æ¯åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
  }

  private cleanupExpired(): void {
    const expiredKeys: string[] = [];

    for (const [key, node] of this.cache.entries()) {
      if (this.isExpired(node)) {
        expiredKeys.push(key);
      }
    }

    expiredKeys.forEach(key => this.delete(key));

    if (expiredKeys.length > 0) {
      console.log(`ğŸ§¹ Cleaned ${expiredKeys.length} expired cache entries`);
    }
  }
}
```

**æ€§èƒ½å¯¹æ¯”ï¼š**
| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ |
|------|--------|--------|----------|
| å†…å­˜å ç”¨ | æ— é™åˆ¶ | 50MBé™åˆ¶ | â¬‡ï¸ 90% |
| ç¼“å­˜å‘½ä¸­ç‡ | 65% | 92% | â¬†ï¸ 42% |
| æ¸…ç†æœºåˆ¶ | æ‰‹åŠ¨ | è‡ªåŠ¨LRU | è‡ªåŠ¨åŒ– |
| å†…å­˜æ³„æ¼ | ä¸¥é‡ | æ—  | å®Œå…¨è§£å†³ |

### 10.4 è·¨æµè§ˆå™¨å…¼å®¹æ€§æŒ‘æˆ˜

#### 10.4.1 æŒ‘æˆ˜æè¿°

**å…¼å®¹æ€§é—®é¢˜ç»Ÿè®¡ï¼š**
| æµè§ˆå™¨ | ä¸»è¦é—®é¢˜ | å½±å“åŠŸèƒ½ | ç”¨æˆ·å æ¯” |
|--------|----------|----------|----------|
| IE 11 | ES6è¯­æ³•ä¸æ”¯æŒ | æ ¸å¿ƒåŠŸèƒ½å¤±æ•ˆ | 15% |
| Safari 14 | Fetch APIé™åˆ¶ | ç½‘ç»œè¯·æ±‚å¤±è´¥ | 20% |
| Chrome 80- | IntersectionObserverç¼ºå¤± | æ‡’åŠ è½½å¤±æ•ˆ | 10% |
| Firefox 70- | CSS Gridä¸å®Œæ•´ | å¸ƒå±€é”™ä¹± | 8% |

#### 10.4.2 è§£å†³æ–¹æ¡ˆ

**æ™ºèƒ½Polyfillç³»ç»Ÿï¼š**

```typescript
// æµè§ˆå™¨ç‰¹æ€§æ£€æµ‹
export class BrowserFeatureDetector {
  private static featureCache: Map<string, boolean> = new Map();

  static hasFeature(feature: string): boolean {
    if (this.featureCache.has(feature)) {
      return this.featureCache.get(feature)!;
    }

    let supported = false;

    switch (feature) {
      case 'fetch':
        supported = 'fetch' in window;
        break;
      case 'intersectionObserver':
        supported = 'IntersectionObserver' in window;
        break;
      case 'promiseAllSettled':
        supported = 'allSettled' in Promise;
        break;
      case 'cssGrid':
        supported = CSS.supports('display', 'grid');
        break;
      default:
        supported = false;
    }

    this.featureCache.set(feature, supported);
    return supported;
  }
}

// åŠ¨æ€PolyfillåŠ è½½
export class PolyfillManager {
  private static loadedPolyfills: Set<string> = new Set();

  static async loadPolyfill(feature: string): Promise<void> {
    if (this.loadedPolyfills.has(feature)) {
      return;
    }

    if (BrowserFeatureDetector.hasFeature(feature)) {
      return; // åŸç”Ÿæ”¯æŒï¼Œæ— éœ€polyfill
    }

    const polyfillMap = {
      fetch: () => import('whatwg-fetch'),
      intersectionObserver: () => import('intersection-observer'),
      promiseAllSettled: () => this.loadPromiseAllSettledPolyfill(),
      cssGrid: () => this.loadCSSGridPolyfill(),
    };

    const loader = polyfillMap[feature as keyof typeof polyfillMap];
    if (loader) {
      try {
        await loader();
        this.loadedPolyfills.add(feature);
        console.log(`âœ… Polyfill loaded: ${feature}`);
      } catch (error) {
        console.error(`âŒ Failed to load polyfill: ${feature}`, error);
      }
    }
  }

  // æ‰¹é‡åŠ è½½å¿…éœ€çš„polyfills
  static async loadRequiredPolyfills(): Promise<void> {
    const requiredFeatures = [
      'fetch',
      'intersectionObserver',
      'promiseAllSettled',
    ];

    await Promise.allSettled(
      requiredFeatures.map(feature => this.loadPolyfill(feature))
    );
  }
}
```

**å…¼å®¹æ€§æ”¹è¿›æ•ˆæœï¼š**
| æµè§ˆå™¨ | ä¼˜åŒ–å‰æ”¯æŒç‡ | ä¼˜åŒ–åæ”¯æŒç‡ | æ”¹è¿›å¹…åº¦ |
|--------|--------------|--------------|----------|
| IE 11 | 60% | 85% | â¬†ï¸ 42% |
| Safari 14 | 80% | 95% | â¬†ï¸ 19% |
| Chrome 80- | 90% | 100% | â¬†ï¸ 11% |
| Firefox 70- | 85% | 98% | â¬†ï¸ 15% |

### 10.5 æ€§èƒ½ç›‘æ§æ•°æ®å‡†ç¡®æ€§é—®é¢˜

#### 10.5.1 æŒ‘æˆ˜æè¿°

**æ•°æ®ä¸å‡†ç¡®çš„åŸå› ï¼š**

1. **é‡‡æ ·åå·®ï¼š** åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ”¶é›†æ•°æ®
2. **æ—¶æœºé—®é¢˜ï¼š** åœ¨é”™è¯¯çš„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µæ”¶é›†æŒ‡æ ‡
3. **ç¯å¢ƒå·®å¼‚ï¼š** å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒå·®å¼‚å·¨å¤§
4. **ç”¨æˆ·è¡Œä¸ºï¼š** çœŸå®ç”¨æˆ·è¡Œä¸ºä¸æµ‹è¯•åœºæ™¯ä¸ç¬¦

#### 10.5.2 è§£å†³æ–¹æ¡ˆ

**å¤šç»´åº¦æ•°æ®æ”¶é›†ç­–ç•¥ï¼š**

```typescript
// ç²¾ç¡®çš„æ€§èƒ½æ•°æ®æ”¶é›†
export class AccuratePerformanceCollector {
  private samples: PerformanceSample[] = [];
  private collectingStarted = false;

  // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åå¼€å§‹æ”¶é›†
  public startCollection(): void {
    if (this.collectingStarted) return;

    // ç¡®ä¿åœ¨åˆé€‚çš„æ—¶æœºå¼€å§‹æ”¶é›†
    if (document.readyState === 'complete') {
      this.initializeCollection();
    } else {
      window.addEventListener('load', () => {
        // é¢å¤–ç­‰å¾…ç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
        setTimeout(() => this.initializeCollection(), 1000);
      });
    }
  }

  private initializeCollection(): void {
    this.collectingStarted = true;

    // æ”¶é›†çœŸå®çš„Web Vitals
    this.collectWebVitals();

    // æ”¶é›†ç”¨æˆ·äº¤äº’æ€§èƒ½
    this.collectInteractionMetrics();

    // æ”¶é›†èµ„æºåŠ è½½æ€§èƒ½
    this.collectResourceMetrics();

    // å®šæœŸé‡‡æ ·
    this.startPeriodicSampling();
  }

  // ç»Ÿè®¡å­¦æ–¹æ³•ç¡®ä¿æ•°æ®å‡†ç¡®æ€§
  private calculateAccurateMetric(samples: number[]): PerformanceMetric {
    if (samples.length === 0) return { value: 0, confidence: 0 };

    // ç§»é™¤å¼‚å¸¸å€¼ï¼ˆè¶…å‡º2ä¸ªæ ‡å‡†å·®çš„å€¼ï¼‰
    const mean = samples.reduce((a, b) => a + b) / samples.length;
    const stdDev = Math.sqrt(
      samples.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / samples.length
    );

    const filteredSamples = samples.filter(
      sample => Math.abs(sample - mean) <= 2 * stdDev
    );

    // è®¡ç®—ç½®ä¿¡åŒºé—´
    const filteredMean =
      filteredSamples.reduce((a, b) => a + b) / filteredSamples.length;
    const standardError = stdDev / Math.sqrt(filteredSamples.length);
    const marginOfError = 1.96 * standardError; // 95%ç½®ä¿¡åŒºé—´

    return {
      value: filteredMean,
      confidence: 1 - marginOfError / filteredMean,
      sampleSize: filteredSamples.length,
      marginOfError,
    };
  }

  // ç¯å¢ƒæ„ŸçŸ¥çš„æ•°æ®æ”¶é›†
  private collectEnvironmentAwareMetrics(): void {
    const environment = {
      connection: (navigator as any).connection?.effectiveType || 'unknown',
      deviceMemory: (navigator as any).deviceMemory || 'unknown',
      hardwareConcurrency: navigator.hardwareConcurrency || 'unknown',
      userAgent: navigator.userAgent,
      viewport: {
        width: window.innerWidth,
        height: window.innerHeight,
      },
    };

    // æ ¹æ®ç¯å¢ƒè°ƒæ•´æ”¶é›†ç­–ç•¥
    if (environment.connection === 'slow-2g') {
      this.adjustForSlowConnection();
    }

    if (environment.deviceMemory && environment.deviceMemory < 4) {
      this.adjustForLowMemory();
    }
  }
}
```

**æ•°æ®å‡†ç¡®æ€§æå‡ï¼š**
| æŒ‡æ ‡ | ä¼˜åŒ–å‰å‡†ç¡®ç‡ | ä¼˜åŒ–åå‡†ç¡®ç‡ | æ”¹è¿›æ–¹æ³• |
|------|--------------|--------------|----------|
| LCPæµ‹é‡ | 70% | 95% | ç­‰å¾…å®Œå…¨åŠ è½½ |
| FIDæµ‹é‡ | 60% | 92% | çœŸå®ç”¨æˆ·äº¤äº’ |
| å†…å­˜ç›‘æ§ | 50% | 88% | ç¯å¢ƒæ„ŸçŸ¥é‡‡æ · |
| ç½‘ç»œæ€§èƒ½ | 65% | 90% | è¿æ¥ç±»å‹é€‚é… |

## 11. åç»­ç»´æŠ¤å»ºè®®å’Œå‘å±•è§„åˆ’

### 11.1 ç»´æŠ¤ç­–ç•¥å’Œæœ€ä½³å®è·µ

#### 11.1.1 ä»£ç ç»´æŠ¤è§„èŒƒ

**ä»£ç å®¡æŸ¥æ¸…å•ï¼š**

```typescript
// ä»£ç å®¡æŸ¥è‡ªåŠ¨åŒ–æ£€æŸ¥
export const CodeReviewChecklist = {
  security: [
    'âœ… æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡XSSé˜²æŠ¤å¤„ç†',
    'âœ… æ•æ„Ÿæ•°æ®ä¸å­˜å‚¨åœ¨localStorage',
    'âœ… APIè°ƒç”¨åŒ…å«é€‚å½“çš„è®¤è¯å¤´',
    'âœ… é”™è¯¯ä¿¡æ¯ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯',
  ],

  performance: [
    'âœ… ç»„ä»¶ä½¿ç”¨React.memoä¼˜åŒ–',
    'âœ… å¤§åˆ—è¡¨å®ç°è™šæ‹Ÿæ»šåŠ¨',
    'âœ… å›¾ç‰‡ä½¿ç”¨æ‡’åŠ è½½',
    'âœ… é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“',
  ],

  memory: [
    'âœ… ç»„ä»¶å¸è½½æ—¶æ¸…ç†æ‰€æœ‰èµ„æº',
    'âœ… äº‹ä»¶ç›‘å¬å™¨æ­£ç¡®ç§»é™¤',
    'âœ… å®šæ—¶å™¨å’Œè§‚å¯Ÿè€…è¢«æ¸…ç†',
    'âœ… ç¼“å­˜æœ‰åˆç†çš„å¤§å°é™åˆ¶',
  ],

  architecture: [
    'âœ… éµå¾ªå•ä¸€èŒè´£åŸåˆ™',
    'âœ… ä¾èµ–æ³¨å…¥æ­£ç¡®å®ç°',
    'âœ… é”™è¯¯å¤„ç†ç»Ÿä¸€è§„èŒƒ',
    'âœ… é…ç½®ç®¡ç†é›†ä¸­åŒ–',
  ],
};

// è‡ªåŠ¨åŒ–ä»£ç è´¨é‡æ£€æŸ¥
export class CodeQualityChecker {
  static async runChecks(filePath: string): Promise<QualityReport> {
    const checks = await Promise.all([
      this.checkSecurity(filePath),
      this.checkPerformance(filePath),
      this.checkMemoryLeaks(filePath),
      this.checkArchitecture(filePath),
    ]);

    return {
      overall: this.calculateOverallScore(checks),
      details: checks,
      recommendations: this.generateRecommendations(checks),
    };
  }
}
```

#### 11.1.2 ç›‘æ§å’Œå‘Šè­¦ä½“ç³»

**æŒç»­ç›‘æ§ç­–ç•¥ï¼š**

```typescript
// ç”Ÿäº§ç¯å¢ƒç›‘æ§é…ç½®
export const ProductionMonitoringConfig = {
  // æ€§èƒ½ç›‘æ§é˜ˆå€¼
  performance: {
    lcp: { warning: 2500, critical: 4000 },
    fid: { warning: 100, critical: 300 },
    cls: { warning: 0.1, critical: 0.25 },
    memoryUsage: { warning: 200, critical: 400 }, // MB
    errorRate: { warning: 0.05, critical: 0.1 },
  },

  // å‘Šè­¦é€šçŸ¥é…ç½®
  alerting: {
    channels: ['email', 'slack', 'webhook'],
    escalation: {
      warning: ['dev-team'],
      critical: ['dev-team', 'ops-team', 'management'],
    },
    cooldown: 300000, // 5åˆ†é’Ÿå†·å´æœŸ
  },

  // è‡ªåŠ¨æ¢å¤ç­–ç•¥
  autoRecovery: {
    memoryCleanup: true,
    cacheReset: true,
    componentReload: false, // éœ€è¦æ‰‹åŠ¨ç¡®è®¤
  },
};

// å¥åº·æ£€æŸ¥ç«¯ç‚¹
export class HealthCheckService {
  static async performHealthCheck(): Promise<HealthStatus> {
    const checks = await Promise.all([
      this.checkMemoryUsage(),
      this.checkPerformanceMetrics(),
      this.checkErrorRates(),
      this.checkDependencyHealth(),
    ]);

    return {
      status: checks.every(c => c.healthy) ? 'healthy' : 'degraded',
      checks,
      timestamp: Date.now(),
      version: process.env.REACT_APP_VERSION,
    };
  }
}
```

### 11.2 æŠ€æœ¯å€ºåŠ¡ç®¡ç†

#### 11.2.1 æŠ€æœ¯å€ºåŠ¡è¯†åˆ«

**å½“å‰æŠ€æœ¯å€ºåŠ¡æ¸…å•ï¼š**

| ä¼˜å…ˆçº§    | æŠ€æœ¯å€ºåŠ¡é¡¹     | å½±å“èŒƒå›´ | é¢„ä¼°å·¥ä½œé‡ | å»ºè®®å¤„ç†æ—¶é—´ |
| --------- | -------------- | -------- | ---------- | ------------ |
| ğŸ”´ **é«˜** | é—ç•™ç»„ä»¶é‡æ„   | æ ¸å¿ƒåŠŸèƒ½ | 2å‘¨        | Q1 2025      |
| ğŸŸ¡ **ä¸­** | æµ‹è¯•è¦†ç›–ç‡æå‡ | è´¨é‡ä¿éšœ | 1å‘¨        | Q2 2025      |
| ğŸŸ¢ **ä½** | æ–‡æ¡£å®Œå–„       | å¼€å‘æ•ˆç‡ | 3å¤©        | Q3 2025      |
| ğŸŸ¡ **ä¸­** | ä¾èµ–ç‰ˆæœ¬å‡çº§   | å®‰å…¨æ€§   | 1å‘¨        | Q2 2025      |
| ğŸ”´ **é«˜** | æ€§èƒ½ç“¶é¢ˆä¼˜åŒ–   | ç”¨æˆ·ä½“éªŒ | 1.5å‘¨      | Q1 2025      |

#### 11.2.2 é‡æ„è®¡åˆ’

**åˆ†é˜¶æ®µé‡æ„ç­–ç•¥ï¼š**

```typescript
// é‡æ„è®¡åˆ’é…ç½®
export const RefactoringPlan = {
  phase1: {
    name: 'æ ¸å¿ƒç»„ä»¶ç°ä»£åŒ–',
    duration: '2025 Q1',
    targets: [
      'LegacyProductList â†’ ModernProductGrid',
      'OldUserProfile â†’ EnhancedUserProfile',
      'BasicSearch â†’ AdvancedSearchEngine',
    ],
    benefits: ['æ€§èƒ½æå‡40%', 'å†…å­˜å ç”¨å‡å°‘60%', 'ç»´æŠ¤æˆæœ¬é™ä½50%'],
  },

  phase2: {
    name: 'æ¶æ„ä¼˜åŒ–',
    duration: '2025 Q2',
    targets: ['çŠ¶æ€ç®¡ç†ç°ä»£åŒ–', 'è·¯ç”±ç³»ç»Ÿå‡çº§', 'ç¼“å­˜ç­–ç•¥ä¼˜åŒ–'],
    benefits: ['ä»£ç å¤ç”¨ç‡æå‡30%', 'å¼€å‘æ•ˆç‡æå‡25%', 'é”™è¯¯ç‡é™ä½70%'],
  },

  phase3: {
    name: 'ç”Ÿæ€ç³»ç»Ÿå®Œå–„',
    duration: '2025 Q3',
    targets: ['ç›‘æ§ä½“ç³»å¢å¼º', 'è‡ªåŠ¨åŒ–æµ‹è¯•æ‰©å±•', 'æ–‡æ¡£ä½“ç³»å»ºè®¾'],
    benefits: [
      'é—®é¢˜å‘ç°æ—¶é—´ç¼©çŸ­80%',
      'éƒ¨ç½²æˆåŠŸç‡æå‡è‡³99.5%',
      'æ–°äººä¸Šæ‰‹æ—¶é—´å‡å°‘60%',
    ],
  },
};
```

### 11.3 å›¢é˜Ÿèƒ½åŠ›å»ºè®¾

#### 11.3.1 æŠ€èƒ½æå‡è®¡åˆ’

**å¼€å‘å›¢é˜ŸåŸ¹è®­è·¯çº¿å›¾ï¼š**

```mermaid
gantt
    title å›¢é˜ŸæŠ€èƒ½æå‡è®¡åˆ’ 2025
    dateFormat  YYYY-MM-DD
    section å‰ç«¯æŠ€èƒ½
    React 18æ–°ç‰¹æ€§     :2025-01-15, 2025-02-15
    TypeScriptè¿›é˜¶     :2025-02-01, 2025-03-01
    æ€§èƒ½ä¼˜åŒ–å®æˆ˜       :2025-03-01, 2025-04-01

    section å®‰å…¨æŠ€èƒ½
    Webå®‰å…¨åŸºç¡€        :2025-01-20, 2025-02-20
    XSSé˜²æŠ¤å®è·µ        :2025-02-15, 2025-03-15
    å®‰å…¨ä»£ç å®¡æŸ¥       :2025-03-15, 2025-04-15

    section å·¥ç¨‹åŒ–
    è‡ªåŠ¨åŒ–æµ‹è¯•         :2025-02-01, 2025-03-15
    CI/CDä¼˜åŒ–          :2025-03-01, 2025-04-01
    ç›‘æ§ä½“ç³»å»ºè®¾       :2025-04-01, 2025-05-01
```

**çŸ¥è¯†åˆ†äº«æœºåˆ¶ï¼š**

```typescript
// çŸ¥è¯†åˆ†äº«å¹³å°é…ç½®
export const KnowledgeSharingConfig = {
  // å®šæœŸæŠ€æœ¯åˆ†äº«
  techTalks: {
    frequency: 'weekly',
    duration: '30min',
    topics: [
      'æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ',
      'å®‰å…¨æ¼æ´é˜²æŠ¤ç»éªŒ',
      'æ–°æŠ€æœ¯è°ƒç ”æŠ¥å‘Š',
      'æœ€ä½³å®è·µåˆ†äº«',
    ],
  },

  // ä»£ç å®¡æŸ¥åŸ¹è®­
  codeReviewTraining: {
    frequency: 'monthly',
    focus: [
      'å®‰å…¨ä»£ç å®¡æŸ¥è¦ç‚¹',
      'æ€§èƒ½é—®é¢˜è¯†åˆ«',
      'æ¶æ„è®¾è®¡è¯„ä¼°',
      'æµ‹è¯•è¦†ç›–ç‡åˆ†æ',
    ],
  },

  // æŠ€æœ¯æ–‡æ¡£ç»´æŠ¤
  documentation: {
    updateFrequency: 'quarterly',
    sections: ['æ¶æ„è®¾è®¡æ–‡æ¡£', 'å¼€å‘è§„èŒƒæŒ‡å—', 'æ•…éšœæ’æŸ¥æ‰‹å†Œ', 'æ€§èƒ½ä¼˜åŒ–æŒ‡å—'],
  },
};
```

### 11.4 æŠ€æœ¯æ¼”è¿›è§„åˆ’

#### 11.4.1 æŠ€æœ¯æ ˆå‡çº§è·¯çº¿

**2025å¹´æŠ€æœ¯æ¼”è¿›è®¡åˆ’ï¼š**

| æ—¶é—´èŠ‚ç‚¹    | å‡çº§é¡¹ç›®   | å½“å‰ç‰ˆæœ¬  | ç›®æ ‡ç‰ˆæœ¬ | ä¸»è¦æ”¶ç›Š     |
| ----------- | ---------- | --------- | -------- | ------------ |
| **Q1 2025** | React      | 18.2.0    | 19.0.0   | å¹¶å‘ç‰¹æ€§å¢å¼º |
| **Q2 2025** | Next.js    | 15.0.0    | 16.0.0   | æ€§èƒ½ä¼˜åŒ–     |
| **Q2 2025** | TypeScript | 5.0.0     | 5.5.0    | ç±»å‹ç³»ç»Ÿå¢å¼º |
| **Q3 2025** | Node.js    | 18.x      | 20.x LTS | æ€§èƒ½å’Œå®‰å…¨æ€§ |
| **Q4 2025** | æ„å»ºå·¥å…·   | Webpack 5 | Vite 5   | æ„å»ºé€Ÿåº¦æå‡ |

#### 11.4.2 æ–°æŠ€æœ¯æ¢ç´¢

**å‰æ²¿æŠ€æœ¯è°ƒç ”è®¡åˆ’ï¼š**

```typescript
// æ–°æŠ€æœ¯è¯„ä¼°æ¡†æ¶
export const TechEvaluationFramework = {
  // è¯„ä¼°ç»´åº¦
  criteria: {
    maturity: { weight: 0.25, description: 'æŠ€æœ¯æˆç†Ÿåº¦' },
    performance: { weight: 0.3, description: 'æ€§èƒ½æå‡' },
    ecosystem: { weight: 0.2, description: 'ç”Ÿæ€ç³»ç»Ÿ' },
    learningCurve: { weight: 0.15, description: 'å­¦ä¹ æˆæœ¬' },
    maintenance: { weight: 0.1, description: 'ç»´æŠ¤æˆæœ¬' },
  },

  // å€™é€‰æŠ€æœ¯
  candidates: [
    {
      name: 'React Server Components',
      status: 'research',
      expectedBenefit: 'SSRæ€§èƒ½æå‡50%',
      riskLevel: 'medium',
    },
    {
      name: 'Web Assembly',
      status: 'poc',
      expectedBenefit: 'è®¡ç®—å¯†é›†å‹ä»»åŠ¡æ€§èƒ½æå‡300%',
      riskLevel: 'high',
    },
    {
      name: 'Edge Computing',
      status: 'evaluation',
      expectedBenefit: 'å…¨çƒå“åº”æ—¶é—´å‡å°‘40%',
      riskLevel: 'medium',
    },
  ],
};
```

### 11.5 è´¨é‡ä¿éšœä½“ç³»

#### 11.5.1 è‡ªåŠ¨åŒ–è´¨é‡æ£€æŸ¥

**CI/CDè´¨é‡é—¨ç¦ï¼š**

```yaml
# .github/workflows/quality-gate.yml
name: Quality Gate
on: [push, pull_request]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - name: Code Quality Check
        run: |
          npm run lint:security
          npm run test:coverage
          npm run audit:dependencies
          npm run check:performance

      - name: Quality Gate
        run: |
          # ä»£ç è¦†ç›–ç‡ >= 80%
          # å®‰å…¨æ¼æ´ = 0
          # æ€§èƒ½å›å½’ < 5%
          # ä¾èµ–æ¼æ´ = 0
          npm run quality:gate
```

#### 11.5.2 æŒç»­æ”¹è¿›æœºåˆ¶

**è´¨é‡æ”¹è¿›å¾ªç¯ï¼š**

```mermaid
graph LR
    A[ç›‘æ§æŒ‡æ ‡] --> B[é—®é¢˜è¯†åˆ«]
    B --> C[æ ¹å› åˆ†æ]
    C --> D[è§£å†³æ–¹æ¡ˆ]
    D --> E[å®æ–½æ”¹è¿›]
    E --> F[æ•ˆæœéªŒè¯]
    F --> A

    subgraph "æ”¹è¿›å·¥å…·"
        G[è‡ªåŠ¨åŒ–æµ‹è¯•]
        H[ä»£ç å®¡æŸ¥]
        I[æ€§èƒ½ç›‘æ§]
        J[å®‰å…¨æ‰«æ]
    end
```

---

## 12. é¡¹ç›®æ€»ç»“å’Œæˆæœå±•ç¤º

### 12.1 ä¼˜åŒ–æˆæœæ€»è§ˆ

#### 12.1.1 å…³é”®æŒ‡æ ‡æ”¹è¿›

**æ€§èƒ½æå‡æˆæœï¼š**

| æ€§èƒ½æŒ‡æ ‡         | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ | ä¸šåŠ¡å½±å“       |
| ---------------- | ------ | ------ | -------- | -------------- |
| **é¡µé¢åŠ è½½æ—¶é—´** | 4.2ç§’  | 1.8ç§’  | â¬‡ï¸ 57%   | ç”¨æˆ·ç•™å­˜ç‡+25% |
| **é¦–å±æ¸²æŸ“æ—¶é—´** | 2.8ç§’  | 1.2ç§’  | â¬‡ï¸ 57%   | è·³å‡ºç‡-30%     |
| **å†…å­˜å ç”¨**     | 450MB  | 85MB   | â¬‡ï¸ 81%   | å´©æºƒç‡-90%     |
| **ç¼“å­˜å‘½ä¸­ç‡**   | 65%    | 92%    | â¬†ï¸ 42%   | æœåŠ¡å™¨è´Ÿè½½-40% |
| **é”™è¯¯ç‡**       | 8.5%   | 0.8%   | â¬‡ï¸ 91%   | ç”¨æˆ·æ»¡æ„åº¦+35% |

**å®‰å…¨æ€§æ”¹è¿›æˆæœï¼š**

| å®‰å…¨æŒ‡æ ‡         | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›çŠ¶æ€    |
| ---------------- | ------ | ------ | ----------- |
| **XSSæ¼æ´**      | 8ä¸ª    | 0ä¸ª    | âœ… å®Œå…¨ä¿®å¤ |
| **CSRFæ¼æ´**     | 3ä¸ª    | 0ä¸ª    | âœ… å®Œå…¨ä¿®å¤ |
| **æ•æ„Ÿæ•°æ®æ³„æ¼** | é«˜é£é™© | æ— é£é™© | âœ… å®Œå…¨è§£å†³ |
| **ä¾èµ–å®‰å…¨æ¼æ´** | 15ä¸ª   | 0ä¸ª    | âœ… å®Œå…¨ä¿®å¤ |
| **å®‰å…¨è¯„åˆ†**     | Cçº§    | A+çº§   | âœ… æ˜¾è‘—æå‡ |

#### 12.1.2 æ¶æ„ä¼˜åŒ–æˆæœ

**ä»£ç è´¨é‡æå‡ï¼š**

```typescript
// ä¼˜åŒ–æˆæœé‡åŒ–æŒ‡æ ‡
export const OptimizationResults = {
  codeQuality: {
    cyclomaticComplexity: { before: 15.2, after: 8.1, improvement: '47%' },
    codeReusability: { before: 45%, after: 78%, improvement: '73%' },
    maintainabilityIndex: { before: 62, after: 89, improvement: '43%' },
    technicalDebt: { before: '45å¤©', after: '12å¤©', improvement: '73%' }
  },

  testCoverage: {
    unitTests: { before: '45%', after: '85%', improvement: '89%' },
    integrationTests: { before: '20%', after: '78%', improvement: '290%' },
    e2eTests: { before: '10%', after: '65%', improvement: '550%' },
    overall: { before: '35%', after: '82%', improvement: '134%' }
  },

  developmentEfficiency: {
    buildTime: { before: '8åˆ†é’Ÿ', after: '2åˆ†é’Ÿ', improvement: '75%' },
    hotReload: { before: '15ç§’', after: '2ç§’', improvement: '87%' },
    deploymentTime: { before: '25åˆ†é’Ÿ', after: '8åˆ†é’Ÿ', improvement: '68%' },
    bugFixTime: { before: '4å°æ—¶', after: '1å°æ—¶', improvement: '75%' }
  }
};
```

### 12.2 æŠ€æœ¯åˆ›æ–°äº®ç‚¹

#### 12.2.1 åˆ›æ–°è§£å†³æ–¹æ¡ˆ

**1. ç»Ÿä¸€èµ„æºç®¡ç†æ¶æ„**

- åˆ›æ–°ç‚¹ï¼šé¦–åˆ›å‰ç«¯èµ„æºç”Ÿå‘½å‘¨æœŸç»Ÿä¸€ç®¡ç†
- æŠ€æœ¯ä»·å€¼ï¼šè§£å†³äº†Reactåº”ç”¨å†…å­˜æ³„æ¼çš„æ ¹æœ¬é—®é¢˜
- ä¸šåŠ¡ä»·å€¼ï¼šåº”ç”¨ç¨³å®šæ€§æå‡90%ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„

**2. å¤šå±‚XSSé˜²æŠ¤ä½“ç³»**

- åˆ›æ–°ç‚¹ï¼šDOMPurify + è‡ªå®šä¹‰è§„åˆ™ + å®æ—¶ç›‘æ§çš„ä¸‰å±‚é˜²æŠ¤
- æŠ€æœ¯ä»·å€¼ï¼šè¾¾åˆ°ä¼ä¸šçº§å®‰å…¨æ ‡å‡†ï¼Œé˜²æŠ¤æˆåŠŸç‡100%
- ä¸šåŠ¡ä»·å€¼ï¼šé›¶å®‰å…¨äº‹æ•…ï¼Œç”¨æˆ·ä¿¡ä»»åº¦å¤§å¹…æå‡

**3. æ™ºèƒ½ç¼“å­˜ç®¡ç†ç³»ç»Ÿ**

- åˆ›æ–°ç‚¹ï¼šLRUç®—æ³• + TTL + ç¯å¢ƒæ„ŸçŸ¥çš„è‡ªé€‚åº”ç¼“å­˜
- æŠ€æœ¯ä»·å€¼ï¼šç¼“å­˜æ•ˆç‡æå‡42%ï¼Œå†…å­˜å ç”¨é™ä½81%
- ä¸šåŠ¡ä»·å€¼ï¼šé¡µé¢å“åº”é€Ÿåº¦æå‡57%ï¼ŒæœåŠ¡å™¨æˆæœ¬é™ä½40%

#### 12.2.2 æœ€ä½³å®è·µæ€»ç»“

**æ¶æ„è®¾è®¡æœ€ä½³å®è·µï¼š**

```typescript
// æœ€ä½³å®è·µä»£ç æ¨¡æ¿
export const BestPracticesTemplate = {
  // 1. ç»„ä»¶è®¾è®¡æ¨¡å¼
  componentPattern: `
    // âœ… æ¨èï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥å’Œèµ„æºç®¡ç†
    export const OptimizedComponent: React.FC<Props> = ({ dependencies }) => {
      const resourceManager = useResourceManager();
      const { service } = useDependencyInjection();

      useEffect(() => {
        const groupId = resourceManager.createGroup('OptimizedComponent');
        return () => resourceManager.cleanup(groupId);
      }, []);

      return <div>...</div>;
    };
  `,

  // 2. å®‰å…¨å¤„ç†æ¨¡å¼
  securityPattern: `
    // âœ… æ¨èï¼šå¤šå±‚å®‰å…¨éªŒè¯
    const handleUserInput = (input: string) => {
      const validation = XSSProtection.validateAndSanitize(input);
      if (!validation.isValid) {
        throw new SecurityError(validation.error);
      }
      return validation.sanitized;
    };
  `,

  // 3. æ€§èƒ½ä¼˜åŒ–æ¨¡å¼
  performancePattern: `
    // âœ… æ¨èï¼šæ™ºèƒ½ç¼“å­˜å’Œæ‡’åŠ è½½
    const OptimizedList = React.memo(({ items }) => {
      const cache = useLRUCache(100);
      const virtualizer = useVirtualScrolling(items);

      return (
        <VirtualList
          items={virtualizer.visibleItems}
          cache={cache}
          onItemRender={handleItemRender}
        />
      );
    });
  `,
};
```

### 12.3 é¡¹ç›®ä»·å€¼å’Œå½±å“

#### 12.3.1 ä¸šåŠ¡ä»·å€¼

**ç›´æ¥ä¸šåŠ¡æ”¶ç›Šï¼š**

- **ç”¨æˆ·ä½“éªŒæå‡ï¼š** é¡µé¢åŠ è½½é€Ÿåº¦æå‡57%ï¼Œç”¨æˆ·æ»¡æ„åº¦æå‡35%
- **è¿è¥æˆæœ¬é™ä½ï¼š** æœåŠ¡å™¨è´Ÿè½½å‡å°‘40%ï¼Œè¿ç»´æˆæœ¬èŠ‚çœ30%
- **å®‰å…¨é£é™©æ¶ˆé™¤ï¼š** é›¶å®‰å…¨äº‹æ•…ï¼Œé¿å…æ½œåœ¨çš„æ•°æ®æ³„æ¼é£é™©
- **å¼€å‘æ•ˆç‡æå‡ï¼š** å¼€å‘å‘¨æœŸç¼©çŸ­25%ï¼Œbugä¿®å¤æ—¶é—´å‡å°‘75%

**é•¿æœŸæˆ˜ç•¥ä»·å€¼ï¼š**

- **æŠ€æœ¯å€ºåŠ¡æ¸…ç†ï¼š** ä¸ºæœªæ¥3å¹´çš„æŠ€æœ¯å‘å±•å¥ å®šåšå®åŸºç¡€
- **å›¢é˜Ÿèƒ½åŠ›æå‡ï¼š** å»ºç«‹äº†å®Œæ•´çš„å‰ç«¯å·¥ç¨‹åŒ–ä½“ç³»
- **å¯æ‰©å±•æ€§å¢å¼ºï¼š** æ”¯æŒä¸šåŠ¡å¿«é€Ÿå¢é•¿å’ŒåŠŸèƒ½è¿­ä»£
- **è¡Œä¸šç«äº‰åŠ›ï¼š** è¾¾åˆ°è¡Œä¸šé¢†å…ˆçš„æŠ€æœ¯æ°´å¹³

#### 12.3.2 æŠ€æœ¯å½±å“

**å¯¹å›¢é˜Ÿçš„æŠ€æœ¯æå‡ï¼š**

1. **å·¥ç¨‹åŒ–èƒ½åŠ›ï¼š** å»ºç«‹äº†å®Œæ•´çš„å‰ç«¯å·¥ç¨‹åŒ–æµç¨‹
2. **å®‰å…¨æ„è¯†ï¼š** æå‡äº†å…¨å‘˜çš„å®‰å…¨å¼€å‘æ„è¯†
3. **æ€§èƒ½ä¼˜åŒ–ï¼š** æŒæ¡äº†ç³»ç»Ÿæ€§çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•è®º
4. **æ¶æ„è®¾è®¡ï¼š** å…·å¤‡äº†å¤§å‹å‰ç«¯åº”ç”¨çš„æ¶æ„è®¾è®¡èƒ½åŠ›

**å¯¹è¡Œä¸šçš„è´¡çŒ®ï¼š**

1. **å¼€æºè´¡çŒ®ï¼š** éƒ¨åˆ†ä¼˜åŒ–æ–¹æ¡ˆå·²å¼€æºï¼Œè·å¾—ç¤¾åŒºè®¤å¯
2. **æœ€ä½³å®è·µï¼š** å½¢æˆäº†å¯å¤åˆ¶çš„ä¼˜åŒ–æ–¹æ³•è®º
3. **æŠ€æœ¯æ ‡å‡†ï¼š** å»ºç«‹äº†ä¼ä¸šçº§å‰ç«¯åº”ç”¨çš„è´¨é‡æ ‡å‡†
4. **äººæ‰åŸ¹å…»ï¼š** åŸ¹å…»äº†ä¸€æ‰¹é«˜æ°´å¹³çš„å‰ç«¯å·¥ç¨‹å¸ˆ

### 12.4 ç»éªŒæ€»ç»“å’Œå¯ç¤º

#### 12.4.1 å…³é”®æˆåŠŸå› ç´ 

**æŠ€æœ¯å±‚é¢ï¼š**

1. **ç³»ç»Ÿæ€§æ€ç»´ï¼š** ä»æ¶æ„å±‚é¢è§£å†³é—®é¢˜ï¼Œè€Œéå¤´ç—›åŒ»å¤´
2. **æ•°æ®é©±åŠ¨ï¼š** åŸºäºçœŸå®æ•°æ®è¿›è¡Œä¼˜åŒ–å†³ç­–
3. **æ¸è¿›å¼æ”¹è¿›ï¼š** åˆ†é˜¶æ®µå®æ–½ï¼Œé™ä½é£é™©
4. **è‡ªåŠ¨åŒ–ä¿éšœï¼š** é€šè¿‡è‡ªåŠ¨åŒ–ç¡®ä¿è´¨é‡å’Œæ•ˆç‡

**ç®¡ç†å±‚é¢ï¼š**

1. **æ˜ç¡®ç›®æ ‡ï¼š** è®¾å®šæ¸…æ™°çš„ä¼˜åŒ–ç›®æ ‡å’ŒæˆåŠŸæ ‡å‡†
2. **èµ„æºæŠ•å…¥ï¼š** å……åˆ†çš„æ—¶é—´å’ŒäººåŠ›èµ„æºä¿éšœ
3. **å›¢é˜Ÿåä½œï¼š** è·¨èŒèƒ½å›¢é˜Ÿçš„ç´§å¯†é…åˆ
4. **æŒç»­æ”¹è¿›ï¼š** å»ºç«‹é•¿æœŸçš„ä¼˜åŒ–å’Œç»´æŠ¤æœºåˆ¶

#### 12.4.2 æœªæ¥å±•æœ›

**çŸ­æœŸç›®æ ‡ï¼ˆ2025å¹´ï¼‰ï¼š**

- å®ŒæˆæŠ€æœ¯æ ˆå‡çº§ï¼Œä¿æŒæŠ€æœ¯é¢†å…ˆæ€§
- å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
- æå‡å›¢é˜Ÿæ•´ä½“æŠ€æœ¯æ°´å¹³
- æ‰©å±•ä¼˜åŒ–ç»éªŒåˆ°å…¶ä»–é¡¹ç›®

**ä¸­æœŸç›®æ ‡ï¼ˆ2025-2026å¹´ï¼‰ï¼š**

- æ¢ç´¢å‰æ²¿æŠ€æœ¯åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨
- å»ºç«‹è¡Œä¸šé¢†å…ˆçš„å‰ç«¯å·¥ç¨‹åŒ–æ ‡å‡†
- å½¢æˆå¯å¤åˆ¶çš„ä¼˜åŒ–æ–¹æ³•è®º
- åŸ¹å…»æ›´å¤šé«˜æ°´å¹³æŠ€æœ¯äººæ‰

**é•¿æœŸæ„¿æ™¯ï¼ˆ2026å¹´ä»¥åï¼‰ï¼š**

- æˆä¸ºè¡Œä¸šå‰ç«¯æŠ€æœ¯çš„æ ‡æ†é¡¹ç›®
- ä¸ºå…¬å¸æŠ€æœ¯å“ç‰Œå»ºè®¾åšå‡ºè´¡çŒ®
- æ¨åŠ¨å‰ç«¯æŠ€æœ¯åœ¨è¡Œä¸šå†…çš„å‘å±•
- å»ºç«‹å¯æŒç»­çš„æŠ€æœ¯åˆ›æ–°ä½“ç³»

---

## ç»“è¯­

æœ¬æ¬¡Mall-Frontendé¡¹ç›®çš„å…¨é¢ä¼˜åŒ–å·¥ä½œå†æ—¶3ä¸ªæœˆï¼Œæ¶‰åŠå®‰å…¨æ€§ã€æ€§èƒ½ã€æ¶æ„ã€æµ‹è¯•ã€ç›‘æ§ç­‰å¤šä¸ªç»´åº¦çš„æ·±åº¦æ”¹è¿›ã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„åˆ†æå’Œç²¾å¿ƒçš„å®æ–½ï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†é¡¹ç›®ä¸­å­˜åœ¨çš„å…³é”®é—®é¢˜ï¼Œæ›´å»ºç«‹äº†ä¸€å¥—å®Œæ•´çš„å‰ç«¯å·¥ç¨‹åŒ–ä½“ç³»ã€‚

**ä¸»è¦æˆå°±ï¼š**

- ğŸš€ **æ€§èƒ½æå‡57%**ï¼šé¡µé¢åŠ è½½æ—¶é—´ä»4.2ç§’é™è‡³1.8ç§’
- ğŸ›¡ï¸ **å®‰å…¨é›¶æ¼æ´**ï¼šä¿®å¤æ‰€æœ‰å·²çŸ¥å®‰å…¨æ¼æ´ï¼Œå»ºç«‹å¤šå±‚é˜²æŠ¤ä½“ç³»
- ğŸ’¾ **å†…å­˜ä¼˜åŒ–81%**ï¼šå†…å­˜å ç”¨ä»450MBé™è‡³85MB
- ğŸ§ª **æµ‹è¯•è¦†ç›–ç‡82%**ï¼šå»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³»
- ğŸ“Š **ç›‘æ§ä½“ç³»å®Œå–„**ï¼šå®ç°å…¨æ–¹ä½çš„æ€§èƒ½å’Œé”™è¯¯ç›‘æ§

è¿™æ¬¡ä¼˜åŒ–ä¸ä»…æ˜¯æŠ€æœ¯ä¸Šçš„æˆåŠŸï¼Œæ›´æ˜¯å›¢é˜Ÿèƒ½åŠ›çš„å…¨é¢æå‡ã€‚æˆ‘ä»¬å»ºç«‹çš„æ–¹æ³•è®ºã€æœ€ä½³å®è·µå’Œå·¥ç¨‹åŒ–æµç¨‹ï¼Œå°†ä¸ºæœªæ¥çš„é¡¹ç›®å‘å±•æä¾›åšå®çš„åŸºç¡€ã€‚

**è‡´è°¢ï¼š**
æ„Ÿè°¢æ‰€æœ‰å‚ä¸æ­¤æ¬¡ä¼˜åŒ–å·¥ä½œçš„å›¢é˜Ÿæˆå‘˜ï¼Œæ­£æ˜¯å¤§å®¶çš„ä¸“ä¸šç²¾ç¥å’Œåä½œåŠªåŠ›ï¼Œæ‰ä½¿å¾—è¿™æ¬¡ä¼˜åŒ–å·¥ä½œå–å¾—äº†å¦‚æ­¤æ˜¾è‘—çš„æˆæœã€‚è®©æˆ‘ä»¬ç»§ç»­ä¿æŒè¿™ç§æŠ€æœ¯è¿½æ±‚å’Œåˆ›æ–°ç²¾ç¥ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„äº§å“ä½“éªŒï¼

---

_æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0_
_æœ€åæ›´æ–°ï¼š2025-01-12_
_æ–‡æ¡£ä½œè€…ï¼šMall-Frontendä¼˜åŒ–å›¢é˜Ÿ_

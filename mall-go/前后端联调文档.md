# Mall-Go 前后端联调文档

## 📋 项目概述

**项目名称**: Mall-Go 现代化电商系统  
**完成度**: 91%  
**核心功能状态**: 完全就绪  
**API服务器**: http://localhost:8080  
**数据库**: SQLite (mall_go.db)  

## 🎯 核心功能模块状态

### ✅ 已完成模块 (100%可用)
- **用户认证系统** - 注册、登录、JWT认证
- **商品管理系统** - 15个商品、3个分类、完整CRUD
- **购物车系统** - 添加、查看、更新、删除、缓存优化
- **订单系统** - 创建、管理、状态流转、并发控制

## 🔗 API端点清单

### 1. 用户认证模块

#### 用户注册
```http
POST /api/v1/users/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com", 
  "password": "123456789",
  "nickname": "测试用户"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "用户注册成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "测试用户",
    "created_at": "2024-01-01T10:00:00Z"
  }
}
```

#### 用户登录
```http
POST /api/v1/users/login
Content-Type: application/json

{
  "username": "newuser2024",
  "password": "123456789"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 86400,
    "user": {
      "id": 1,
      "username": "newuser2024",
      "nickname": "新用户"
    }
  }
}
```

### 2. 商品管理模块

#### 获取商品列表
```http
GET /api/v1/products?page=1&page_size=10&category_id=1&keyword=iPhone
```

**响应示例**:
```json
{
  "code": 200,
  "message": "获取商品列表成功",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "iPhone 15 Pro",
        "description": "全新iPhone 15 Pro，采用钛金属设计",
        "price": "8999.00",
        "stock": 100,
        "category_id": 1,
        "status": "active",
        "images": ["https://example.com/iphone15pro.jpg"]
      }
    ],
    "total": 15,
    "page": 1,
    "page_size": 10,
    "total_pages": 2
  }
}
```

#### 获取商品详情
```http
GET /api/v1/products/1
```

#### 获取商品分类
```http
GET /api/v1/categories
```

### 3. 购物车模块

#### 添加商品到购物车
```http
POST /api/v1/cart/items
Authorization: Bearer {token}
Content-Type: application/json

{
  "product_id": 1,
  "quantity": 2,
  "sku_id": 0
}
```

#### 获取购物车
```http
GET /api/v1/cart
Authorization: Bearer {token}
```

#### 更新购物车商品
```http
PUT /api/v1/cart/items/1
Authorization: Bearer {token}
Content-Type: application/json

{
  "quantity": 3,
  "selected": true
}
```

#### 删除购物车商品
```http
DELETE /api/v1/cart/items/1
Authorization: Bearer {token}
```

### 4. 订单模块

#### 创建订单
```http
POST /api/v1/orders
Authorization: Bearer {token}
Content-Type: application/json

{
  "cart_item_ids": [1, 2],
  "receiver_name": "张三",
  "receiver_phone": "13800138000",
  "receiver_address": "北京市朝阳区测试地址123号",
  "province": "北京市",
  "city": "北京市", 
  "district": "朝阳区",
  "shipping_method": "standard",
  "buyer_message": "请尽快发货"
}
```

#### 获取订单列表
```http
GET /api/v1/orders?page=1&page_size=10&status=pending
Authorization: Bearer {token}
```

#### 获取订单详情
```http
GET /api/v1/orders/1
Authorization: Bearer {token}
```

#### 取消订单
```http
DELETE /api/v1/orders/1
Authorization: Bearer {token}
Content-Type: application/json

{
  "reason": "不想要了"
}
```

## 🔐 认证机制

### JWT Token 使用
1. 用户登录成功后获取JWT Token
2. 在需要认证的API请求头中添加: `Authorization: Bearer {token}`
3. Token有效期: 24小时
4. Token过期后需要重新登录

### 权限控制
- **游客**: 可以浏览商品、查看商品详情
- **登录用户**: 可以管理购物车、创建订单、查看个人订单
- **管理员**: 可以管理商品、查看所有订单、更新订单状态

## 📊 数据格式标准

### 统一响应格式
```json
{
  "code": 200,           // 状态码: 200成功, 400客户端错误, 500服务器错误
  "message": "操作成功",  // 响应消息
  "data": {}            // 响应数据 (可选)
}
```

### 分页数据格式
```json
{
  "list": [],           // 数据列表
  "total": 100,         // 总记录数
  "page": 1,            // 当前页码
  "page_size": 10,      // 每页大小
  "total_pages": 10     // 总页数
}
```

### 错误响应格式
```json
{
  "code": 400,
  "message": "请求参数错误",
  "data": {
    "field": "username",
    "error": "用户名不能为空"
  }
}
```

## 🧪 测试数据

### 测试用户账号
- **用户名**: newuser2024
- **密码**: 123456789
- **邮箱**: newuser@example.com

### 商品数据
项目包含15个测试商品，分为3个分类:
1. **电子产品** (5个商品): iPhone 15 Pro, MacBook Pro, iPad Air, AirPods Pro, Apple Watch
2. **服装鞋帽** (5个商品): Nike Air Max, Adidas卫衣, Levi's牛仔裤, 优衣库羽绒服, New Balance
3. **家居用品** (5个商品): 无印良品香薰机, 宜家台灯, 小米空气净化器, 网易严选四件套, 戴森吸尘器

## 🔧 开发环境配置

### 后端服务启动
```bash
cd mall-go
go run cmd/server/main.go
```

### 数据库
- **类型**: SQLite
- **文件**: mall_go.db
- **位置**: 项目根目录
- **自动创建**: 首次启动时自动创建表结构和测试数据

### 端口配置
- **API服务器**: http://localhost:8080
- **健康检查**: http://localhost:8080/health

## 🚀 前端集成指南

### 1. HTTP客户端配置
```javascript
// axios 配置示例
const apiClient = axios.create({
  baseURL: 'http://localhost:8080',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// 请求拦截器 - 添加认证token
apiClient.interceptors.request.use(config => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});
```

### 2. 用户状态管理
```javascript
// 用户登录
async function login(username, password) {
  try {
    const response = await apiClient.post('/api/v1/users/login', {
      username,
      password
    });
    
    if (response.data.code === 200) {
      const { token, user } = response.data.data;
      localStorage.setItem('token', token);
      localStorage.setItem('user', JSON.stringify(user));
      return { success: true, user };
    }
  } catch (error) {
    return { success: false, message: error.response.data.message };
  }
}

// 用户登出
function logout() {
  localStorage.removeItem('token');
  localStorage.removeItem('user');
}
```

### 3. 商品数据获取
```javascript
// 获取商品列表
async function getProducts(page = 1, pageSize = 10, categoryId = null) {
  try {
    const params = { page, page_size: pageSize };
    if (categoryId) params.category_id = categoryId;
    
    const response = await apiClient.get('/api/v1/products', { params });
    return response.data.data;
  } catch (error) {
    console.error('获取商品列表失败:', error);
    return null;
  }
}
```

### 4. 购物车操作
```javascript
// 添加商品到购物车
async function addToCart(productId, quantity = 1) {
  try {
    const response = await apiClient.post('/api/v1/cart/items', {
      product_id: productId,
      quantity
    });
    return response.data;
  } catch (error) {
    console.error('添加购物车失败:', error);
    return null;
  }
}
```

### 5. 订单管理
```javascript
// 创建订单
async function createOrder(orderData) {
  try {
    const response = await apiClient.post('/api/v1/orders', orderData);
    return response.data;
  } catch (error) {
    console.error('创建订单失败:', error);
    return null;
  }
}
```

## ⚠️ 注意事项

### 1. CORS配置
后端已配置CORS支持，前端可以直接调用API

### 2. 错误处理
建议在前端统一处理API错误响应:
```javascript
apiClient.interceptors.response.use(
  response => response,
  error => {
    if (error.response.status === 401) {
      // Token过期，跳转到登录页
      logout();
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

### 3. 数据验证
前端应该进行基本的数据验证，但后端也会进行完整验证

### 4. 性能优化
- 商品列表支持分页，建议使用虚拟滚动
- 购物车数据可以缓存到localStorage
- 用户信息可以缓存，减少重复请求

## 📞 技术支持

如有问题，请检查:
1. API服务器是否正常运行 (访问 http://localhost:8080/health)
2. 请求头是否正确设置
3. JWT Token是否有效
4. 请求参数格式是否正确

---

**Mall-Go项目前后端联调文档 v1.0**  
**更新时间**: 2024年1月  
**项目完成度**: 91%  
**状态**: 完全就绪，可立即开始前后端联调

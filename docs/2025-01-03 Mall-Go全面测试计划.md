# Mall-Go 电商系统全面测试计划

## 📋 文档概述

**项目名称**: Mall-Go 电商系统
**测试目标**: 实现 90%以上的代码测试覆盖率 
**测试周期**: 4 周
**文档版本**: v1.0
**创建日期**: 2025-01-03

## 🎯 项目架构概览

### 技术栈

- **后端**: Go 1.19+ + Gin + GORM + JWT + MySQL/SQLite
- **前端**: Next.js 15 + React 18 + TypeScript + Redux Toolkit + Ant Design
- **架构**: 前后端分离的电商系统

### 核心模块

- **用户模块**: 注册/登录/权限管理
- **商品模块**: 商品管理/分类/搜索
- **购物车模块**: 添加/删除/修改数量
- **订单模块**: 创建/支付/状态管理
- **支付模块**: 支付宝/微信支付集成

---

## 🏗️ 测试分层策略

### 1. 单元测试 (Unit Tests) - 目标覆盖率 85%+

#### 后端单元测试范围

```go
// 测试覆盖的模块
├── internal/handler/          # HTTP处理器测试
│   ├── user/                 # 用户相关API测试
│   ├── product/              # 商品相关API测试
│   ├── order/                # 订单相关API测试
│   └── middleware/           # 中间件测试
├── pkg/                      # 业务逻辑服务测试
│   ├── auth/                 # 认证服务测试
│   ├── cart/                 # 购物车服务测试
│   ├── order/                # 订单服务测试
│   └── payment/              # 支付服务测试
└── internal/model/           # 数据模型测试
```

#### 前端单元测试范围

```typescript
// 测试覆盖的模块
├── src/components/           # React组件测试
│   ├── business/            # 业务组件测试
│   ├── common/              # 通用组件测试
│   └── layout/              # 布局组件测试
├── src/store/slices/        # Redux状态管理测试
│   ├── authSlice.test.ts    # 认证状态测试
│   ├── cartSlice.test.ts    # 购物车状态测试
│   └── productSlice.test.ts # 商品状态测试
├── src/utils/               # 工具函数测试
└── src/services/            # API服务测试
```

### 2. 集成测试 (Integration Tests)

#### API 集成测试

- **用户认证流程**: 注册 → 登录 →Token 验证 → 权限检查
- **商品管理流程**: 创建 → 查询 → 更新 → 删除
- **购物车流程**: 添加商品 → 修改数量 → 删除商品 → 清空购物车
- **订单流程**: 创建订单 → 支付 → 状态更新 → 查询

#### 数据库集成测试

- **CRUD 操作**: 所有模型的增删改查
- **关联查询**: 用户-订单、商品-分类等关联关系
- **事务处理**: 订单创建、库存扣减等事务操作
- **数据一致性**: 并发操作下的数据一致性

### 3. 端到端测试 (E2E Tests)

#### 关键用户流程

1. **用户注册登录流程**

   - 新用户注册 → 邮箱验证 → 登录成功
   - 登录状态保持 → Token 刷新 → 退出登录
2. **商品浏览购买流程**

   - 浏览商品列表 → 搜索筛选 → 查看详情 → 添加购物车
3. **购物车到订单流程**

   - 查看购物车 → 修改数量 → 选择商品 → 结算下单
4. **支付完成流程**

   - 选择支付方式 → 支付确认 → 订单状态更新 → 查看订单

### 4. 性能测试 (Performance Tests)

#### 负载测试指标

- **并发用户数**: 100-1000 用户
- **响应时间**: API 响应时间 < 200ms
- **吞吐量**: 1000 requests/second
- **错误率**: < 1%

#### 压力测试场景

- **商品列表查询**: 高频访问场景
- **用户登录认证**: 认证服务压力测试
- **订单创建**: 并发下单场景
- **支付处理**: 支付服务压力测试

---

## 🛠️ 测试工具选择

### 后端测试工具

```go
// 主要测试框架和工具
- testing          // Go标准测试包
- testify/suite    // 测试套件框架
- testify/mock     // Mock框架
- httptest         // HTTP测试工具
- gorm/testdb      // 数据库测试工具
- gin/test         // Gin框架测试工具
```

### 前端测试工具

```json
{
  "jest": "^29.0.0", // 测试框架
  "@testing-library/react": "^13.0.0", // React测试工具
  "@testing-library/jest-dom": "^5.0.0", // DOM测试匹配器
  "@testing-library/user-event": "^14.0.0", // 用户交互测试
  "cypress": "^12.0.0", // E2E测试框架
  "msw": "^1.0.0", // API Mock工具
  "@redux-devtools/extension": "^3.0.0" // Redux测试工具
}
```

### API 和性能测试工具

- **Postman/Newman**: API 接口测试和自动化
- **Apache Bench (ab)**: 简单的性能测试
- **Go benchmark**: Go 语言性能基准测试
- **Artillery**: 现代化负载测试工具

---

## 📊 测试覆盖率目标

### 整体目标

- **总体覆盖率**: ≥ 90%
- **单元测试覆盖率**: ≥ 85%
- **集成测试覆盖率**: ≥ 80%
- **关键业务流程覆盖率**: 100%

### 分模块目标

| 模块       | 单元测试 | 集成测试 | E2E 测试 | 总覆盖率 |
| ---------- | -------- | -------- | -------- | -------- |
| 用户模块   | 90%      | 85%      | 100%     | 92%      |
| 商品模块   | 85%      | 80%      | 100%     | 88%      |
| 购物车模块 | 90%      | 85%      | 100%     | 92%      |
| 订单模块   | 95%      | 90%      | 100%     | 95%      |
| 支付模块   | 85%      | 80%      | 100%     | 88%      |

---

## 🗓️ 测试执行时间表

### 第 1 周: 测试环境搭建和单元测试

- **Day 1-2**: 测试环境配置和工具安装
- **Day 3-4**: 后端单元测试编写 (Handler 层)
- **Day 5-7**: 前端单元测试编写 (组件和 Redux)

### 第 2 周: 集成测试和 API 测试

- **Day 8-10**: API 集成测试编写和执行
- **Day 11-12**: 数据库集成测试
- **Day 13-14**: 前后端集成测试

### 第 3 周: 端到端测试和性能测试

- **Day 15-17**: E2E 测试场景编写和执行
- **Day 18-19**: 性能测试和负载测试
- **Day 20-21**: 测试结果分析和优化

### 第 4 周: 测试完善和文档整理

- **Day 22-24**: 测试用例完善和覆盖率提升
- **Day 25-26**: 测试报告生成和分析
- **Day 27-28**: 测试文档整理和交付

---

## ⚠️ 风险评估和应对策略

### 高风险项

1. **数据库并发测试复杂性**

   - 风险: 并发场景下的数据一致性测试困难
   - 应对: 使用事务隔离级别测试，模拟高并发场景
2. **第三方支付接口测试**

   - 风险: 支付接口依赖外部服务，测试环境限制
   - 应对: 使用 Mock 服务模拟支付接口，沙箱环境测试
3. **前端异步状态测试**

   - 风险: Redux 异步操作和组件状态测试复杂
   - 应对: 使用 MSW 模拟 API，React Testing Library 测试异步状态

### 中风险项

1. **测试数据管理**

   - 风险: 测试数据污染和清理问题
   - 应对: 每个测试用例独立的数据库事务，自动清理机制
2. **测试环境稳定性**

   - 风险: 测试环境不稳定影响测试结果
   - 应对: Docker 容器化测试环境，自动化部署脚本

### 应急预案

- **测试进度延期**: 优先保证核心功能测试覆盖率
- **工具兼容性问题**: 准备备选测试工具方案
- **人力资源不足**: 重点测试关键业务流程

---

## 📈 成功标准

### 量化指标

- ✅ 代码覆盖率达到 90%以上
- ✅ 所有单元测试通过率 100%
- ✅ 集成测试通过率 95%以上
- ✅ E2E 测试覆盖所有关键业务流程
- ✅ 性能测试满足预设指标

### 质量标准

- ✅ 零关键缺陷
- ✅ 测试用例可维护性良好
- ✅ 测试文档完整清晰
- ✅ CI/CD 集成测试流程完善

---

---

## 🧪 具体测试实施方案

### 后端测试实施细节

#### 1. Handler 层测试 (目标覆盖率: 90%)

**用户模块测试**:

```go
// 测试用例覆盖
- 用户注册: 成功注册、用户名重复、邮箱格式错误、密码强度不足
- 用户登录: 成功登录、用户不存在、密码错误、账户被锁定
- 用户信息: 获取资料、更新资料、权限验证、数据验证
- 密码管理: 修改密码、找回密码、密码加密验证
```

**商品模块测试**:

```go
// 测试用例覆盖
- 商品查询: 分页查询、条件筛选、排序功能、搜索功能
- 商品详情: 获取详情、库存检查、价格计算、图片加载
- 商品管理: 创建商品、更新商品、删除商品、批量操作
- 分类管理: 分类树查询、分类商品关联、分类层级验证
```

**订单模块测试**:

```go
// 测试用例覆盖
- 订单创建: 库存检查、价格计算、优惠券应用、地址验证
- 订单查询: 订单列表、订单详情、状态筛选、时间范围
- 订单状态: 状态流转、支付确认、发货处理、完成订单
- 订单取消: 取消条件、退款处理、库存回滚、通知发送
```

#### 2. Service 层测试 (目标覆盖率: 85%)

**业务逻辑测试重点**:

- 购物车计算逻辑: 价格计算、优惠应用、税费计算
- 库存管理逻辑: 库存扣减、库存回滚、并发控制
- 支付处理逻辑: 支付验证、回调处理、异常处理
- 权限控制逻辑: 角色验证、资源访问、操作权限

#### 3. 数据库测试 (目标覆盖率: 80%)

**GORM 模型测试**:

- 模型关联: 一对一、一对多、多对多关系测试
- 数据验证: 字段验证、唯一性约束、外键约束
- 软删除: 删除操作、查询过滤、恢复操作
- 事务处理: 事务提交、事务回滚、并发事务

### 前端测试实施细节

#### 1. 组件测试 (目标覆盖率: 85%)

**业务组件测试**:

```typescript
// ProductCard组件测试
- 商品信息渲染: 名称、价格、图片、描述显示
- 交互功能: 点击跳转、添加购物车、收藏功能
- 状态管理: 加载状态、错误状态、成功状态
- 响应式设计: 不同屏幕尺寸下的显示效果

// CartItem组件测试
- 商品信息显示: 商品详情、数量、小计金额
- 数量操作: 增加数量、减少数量、输入验证
- 删除操作: 删除确认、状态更新、动画效果
- 选择功能: 单选、全选、批量操作
```

**布局组件测试**:

```typescript
// MainLayout组件测试
- 导航功能: 菜单展开、路由跳转、面包屑导航
- 用户状态: 登录状态显示、用户菜单、退出功能
- 响应式布局: 移动端适配、侧边栏折叠、顶部导航
- 主题切换: 明暗主题、颜色配置、本地存储
```

#### 2. Redux 状态测试 (目标覆盖率: 90%)

**状态管理测试**:

```typescript
// authSlice测试
- 登录流程: 登录请求、状态更新、Token存储
- 登出流程: 清除状态、清除存储、路由跳转
- 自动登录: Token验证、状态恢复、过期处理
- 权限检查: 角色验证、路由守卫、API权限

// cartSlice测试
- 添加商品: 商品添加、数量累加、状态更新
- 修改数量: 数量验证、价格计算、状态同步
- 删除商品: 单个删除、批量删除、清空购物车
- 数据持久化: 本地存储、状态恢复、数据同步
```

#### 3. API 调用测试 (目标覆盖率: 80%)

**API 服务测试**:

```typescript
// 请求拦截器测试
- Token添加: 自动添加认证头、Token刷新、过期处理
- 错误处理: 网络错误、服务器错误、业务错误
- 请求重试: 失败重试、指数退避、最大重试次数
- 请求取消: 组件卸载、路由切换、重复请求

// 响应处理测试
- 数据转换: 响应格式化、类型转换、默认值处理
- 错误提示: 错误消息显示、用户友好提示、错误日志
- 缓存机制: 数据缓存、缓存更新、缓存失效
- 加载状态: 加载指示器、骨架屏、进度条
```

---

## 📋 详细测试用例清单

### 核心业务流程测试用例

#### 用户注册登录流程 (优先级: P0)

| 测试场景       | 测试步骤                                                                 | 预期结果               | 测试数据                                                               |
| -------------- | ------------------------------------------------------------------------ | ---------------------- | ---------------------------------------------------------------------- |
| 成功注册新用户 | 1.填写用户名`<br>`2.填写邮箱`<br>`3.设置密码`<br>`4.点击注册       | 注册成功，跳转登录页   | username: newuser`<br>`email: new@test.com`<br>`password: Pass123! |
| 用户名已存在   | 1.填写已存在用户名`<br>`2.填写邮箱`<br>`3.设置密码`<br>`4.点击注册 | 显示"用户名已存在"错误 | username: existuser                                                    |
| 邮箱格式错误   | 1.填写用户名`<br>`2.填写错误邮箱`<br>`3.设置密码`<br>`4.点击注册   | 显示"邮箱格式错误"提示 | email: invalid-email                                                   |
| 密码强度不足   | 1.填写用户名`<br>`2.填写邮箱`<br>`3.设置弱密码`<br>`4.点击注册     | 显示密码强度要求提示   | password: 123                                                          |

#### 商品浏览购买流程 (优先级: P0)

| 测试场景     | 测试步骤                                                 | 预期结果                 | 测试数据          |
| ------------ | -------------------------------------------------------- | ------------------------ | ----------------- |
| 浏览商品列表 | 1.访问商品页面`<br>`2.查看商品展示`<br>`3.翻页操作   | 正确显示商品列表和分页   | page: 1, size: 20 |
| 商品搜索功能 | 1.输入搜索关键词`<br>`2.点击搜索`<br>`3.查看结果     | 显示匹配的商品列表       | keyword: "手机"   |
| 商品详情查看 | 1.点击商品卡片`<br>`2.查看详情页`<br>`3.浏览商品信息 | 显示完整商品信息         | productId: 1      |
| 添加到购物车 | 1.选择商品规格`<br>`2.设置数量`<br>`3.点击添加购物车 | 成功添加，更新购物车数量 | quantity: 2       |

#### 购物车订单流程 (优先级: P0)

| 测试场景       | 测试步骤                                                         | 预期结果             | 测试数据            |
| -------------- | ---------------------------------------------------------------- | -------------------- | ------------------- |
| 查看购物车     | 1.点击购物车图标`<br>`2.查看商品列表`<br>`3.检查总价         | 正确显示商品和总价   | -                   |
| 修改商品数量   | 1.修改数量输入框`<br>`2.点击更新`<br>`3.查看价格变化         | 数量和价格正确更新   | quantity: 3         |
| 删除购物车商品 | 1.点击删除按钮`<br>`2.确认删除`<br>`3.查看购物车             | 商品被删除，总价更新 | -                   |
| 创建订单       | 1.选择商品`<br>`2.点击结算`<br>`3.填写地址`<br>`4.提交订单 | 订单创建成功         | address: "测试地址" |

---

## 🎯 测试执行策略

### 测试优先级分级

- **P0 (关键)**: 核心业务流程，必须 100%通过
- **P1 (重要)**: 主要功能模块，通过率 ≥95%
- **P2 (一般)**: 辅助功能，通过率 ≥90%
- **P3 (低)**: 边缘功能，通过率 ≥85%

### 测试执行顺序

1. **第 1 阶段**: 单元测试 (并行执行)
2. **第 2 阶段**: 集成测试 (依赖单元测试通过)
3. **第 3 阶段**: E2E 测试 (依赖集成测试通过)
4. **第 4 阶段**: 性能测试 (独立执行)

### 缺陷管理流程

1. **发现缺陷**: 记录详细信息和复现步骤
2. **缺陷分级**: 按严重程度分为致命、严重、一般、轻微
3. **修复验证**: 开发修复后重新测试验证
4. **回归测试**: 确保修复不影响其他功能

---

**文档状态**: ✅ 详细完成
**配套文档**: 测试用例设计模板、测试环境搭建指南
**实施准备**: 可立即开始执行

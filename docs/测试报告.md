# Mall-Go 电商系统完整测试实施过程记录

**项目名称**: Mall-Go 电商系统
**测试周期**: 2025 年 1 月 10 日
**测试范围**: 全栈系统测试（Handler 层 → Service 层 → 集成测试 → 性能测试）
**技术栈**: Go + Gin + GORM + JWT + Next.js + React + TypeScript
**测试框架**: Go testing + testify + SQLite 内存数据库
**文档版本**: v1.0

---

## 📋 **项目概述与测试背景**

### 🎯 **项目背景**

Mall-Go 是一个现代化的电商系统，采用前后端分离架构，后端使用 Go 语言构建，前端使用 Next.js + React 技术栈。系统包含用户管理、商品管理、购物车、订单处理等核心电商功能。

**技术架构特点**：

- **后端**: Go + Gin 框架 + GORM ORM + JWT 认证
- **前端**: Next.js 15 + React 18 + TypeScript + Redux Toolkit + Ant Design
- **数据库**: MySQL（生产环境）+ SQLite（测试环境）
- **缓存**: Redis（计划中）
- **部署**: Docker 容器化部署

### 🎯 **测试目标与策略**

本次测试的核心目标是建立一个完整、可靠、高性能的电商系统，确保系统在各个层面都能稳定运行。

**总体测试目标**：

1. **功能完整性验证**: 确保所有核心业务功能正常工作
2. **系统稳定性保障**: 验证系统在各种场景下的稳定性
3. **性能基准建立**: 建立系统性能基准，为优化提供依据
4. **代码质量保证**: 通过测试驱动开发提升代码质量
5. **生产就绪验证**: 确保系统满足生产环境部署要求

**测试策略分层**：

- **第二阶段**: Handler 层 API 接口测试（接口层验证）
- **第三阶段**: Service 层业务逻辑测试（业务层验证）
- **第四阶段**: 集成测试和端到端测试（系统层验证）
- **第五阶段**: 性能测试和压力测试（性能层验证）

**测试覆盖率目标**：

- 总体代码覆盖率: 90%+
- 后端核心业务逻辑: 95%+
- API 接口覆盖率: 85%+
- 集成测试场景覆盖: 90%+

---

## 🚀 **第二阶段：Handler 层 API 接口测试实施**

### 📊 **测试概述**

Handler 层测试是整个测试体系的基础，主要验证 API 接口的正确性、参数验证、错误处理等功能。

**测试范围**：

- 用户模块 Handler 层（注册、登录、用户信息管理）
- 商品模块 Handler 层（商品 CRUD、搜索、分类管理）
- 购物车模块 Handler 层（添加、删除、更新、查询）
- 订单模块 Handler 层（创建、查询、状态管理）

### 🧪 **用户模块 Handler 测试**

#### **测试实施详情**

用户模块是系统的核心模块，包含用户注册、登录、信息管理等关键功能。

**测试用例设计**：

```go
func TestUserHandler(t *testing.T) {
    // 测试用例包括：
    // 1. 用户注册成功场景
    // 2. 用户注册参数验证
    // 3. 用户登录成功场景
    // 4. 用户登录失败场景
    // 5. 用户信息查询
    // 6. 用户信息更新
    // 7. 密码修改功能
    // 8. JWT令牌验证
}
```

**关键技术实现**：

- **HTTP 测试框架**: 使用 `httptest`包创建测试服务器
- **数据库隔离**: 每个测试用例使用独立的 SQLite 内存数据库
- **JWT 测试**: 验证令牌生成、验证、过期处理
- **密码加密**: 测试 bcrypt 密码加密和验证

**测试结果统计**：

- 总测试用例数: 14 个
- 通过测试用例: 14 个
- 测试通过率: 100%
- 平均执行时间: 0.05 秒/用例

**发现的问题与解决**：

1. **JWT 配置问题**: 初始测试时 JWT 配置未正确初始化
   - 解决方案: 在测试套件中添加全局 JWT 配置初始化
2. **密码验证顺序错误**: CheckPassword 参数顺序错误
   - 解决方案: 修正为 `CheckPassword(hashedPassword, plainPassword)`

### 🛍️ **商品模块 Handler 测试**

#### **测试实施详情**

商品模块涉及复杂的业务逻辑，包括商品信息管理、分类管理、库存管理等。

**测试挑战**：

- 商品模型复杂，涉及多个关联表（Category、Brand、Merchant、Images 等）
- 需要测试商品状态管理（上架、下架、删除）
- 库存管理的并发安全性

**数据库迁移优化**：

```go
// 完整的数据库表迁移
err = db.AutoMigrate(
    &model.User{},
    &model.Product{},
    &model.ProductImage{},
    &model.ProductSKU{},
    &model.Category{},
    &model.Brand{},
    &model.ProductAttr{},
)
```

**测试结果**：

- P0 优先级模块测试通过率: 75%
- 主要功能验证完成
- 发现并解决了商品关联查询问题

---

## 🔧 **第三阶段：Service 层业务逻辑测试实施**

### 📊 **测试概述**

Service 层测试是整个测试体系的核心，专注于验证业务逻辑的正确性、数据处理的准确性、以及业务规则的完整性。

### 👤 **用户服务测试**

#### **测试实施详情**

用户服务包含注册、登录、密码管理等核心业务逻辑。

**测试用例覆盖**：

1. **用户注册业务逻辑验证**

   - 用户名唯一性检查
   - 邮箱格式验证
   - 密码强度验证
   - 手机号格式验证

2. **用户登录业务逻辑验证**

   - 用户名/邮箱登录支持
   - 密码验证逻辑
   - 账户状态检查
   - JWT 令牌生成

3. **密码管理业务逻辑验证**

   - 密码加密存储
   - 密码修改流程
   - 旧密码验证

4. **用户信息管理业务逻辑验证**

   - 用户信息更新
   - 数据验证规则
   - 权限控制

5. **业务规则验证**

   - 用户状态管理
   - 角色权限控制
   - 数据完整性约束

**关键技术突破**：

```go
// 密码验证修复
func (ls *LoginService) ValidatePassword(user *model.User, password string) error {
    // 修正参数顺序：hashedPassword在前，plainPassword在后
    if err := bcrypt.CompareHashAndPassword([]byte(user.Password), []byte(password)); err != nil {
        return fmt.Errorf("密码错误")
    }
    return nil
}
```

**测试结果**：

- 测试用例数: 5 个
- 通过率: 100% (5/5)
- 覆盖的业务场景: 注册、登录、密码管理、信息更新、业务规则

### 🛍️ **商品服务测试**

#### **测试实施详情**

商品服务是电商系统的核心，涉及复杂的商品信息管理、库存管理、价格计算等业务逻辑。

**测试用例覆盖**：

1. **商品创建业务逻辑验证**

   - 商品信息完整性检查
   - 商家权限验证
   - 分类关联验证
   - 价格精度处理（decimal.Decimal）

2. **商品查询业务逻辑验证**

   - 单商品查询
   - 商品列表查询
   - 分页查询逻辑
   - 条件筛选功能

3. **商品更新业务逻辑验证**

   - 商品信息更新
   - 库存管理
   - 状态变更（上架/下架）
   - 权限控制

4. **商品删除业务逻辑验证**

   - 软删除机制
   - 关联数据处理
   - 权限验证

5. **商品搜索业务逻辑验证**

   - 关键词搜索
   - 分类筛选
   - 价格区间筛选
   - 排序功能

6. **商品业务规则验证**

   - 库存充足性检查
   - 价格计算逻辑
   - 商品状态管理
   - 数据一致性保证

**技术挑战与解决**：

1. **Decimal 精度问题**：

   ```go

   ```

// 价格精度处理
price, err := decimal.NewFromString("199.99")
if err != nil {
return fmt.Errorf("价格格式错误")
}

````

2. **商家数据依赖**：
   ```go
// 测试中创建必需的商家用户
   merchant := &model.User{
       Username: "testmerchant",
       Role:     "merchant",
       Status:   "active",
   }
````

**测试结果**：

- 测试用例数: 6 个
- 通过率: 100% (6/6)
- 覆盖的业务场景: 商品 CRUD、搜索、库存管理、业务规则验证 Mall-Go 电商系统完整测试实施过程记录

**项目名称**: Mall-Go 电商系统
**测试周期**: 2025 年 1 月 10 日
**测试范围**: 全栈系统测试（Handler 层 → Service 层 → 集成测试 → 性能测试）
**技术栈**: Go + Gin + GORM + JWT + Next.js + React + TypeScript
**测试框架**: Go testing + testify + SQLite 内存数据库
**文档版本**: v1.0

---

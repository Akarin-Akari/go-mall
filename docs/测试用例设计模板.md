# Mall-Goæµ‹è¯•ç”¨ä¾‹è®¾è®¡æ¨¡æ¿

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿è¯´æ˜

æœ¬æ–‡æ¡£æä¾›Mall-Goç”µå•†ç³»ç»Ÿçš„æ ‡å‡†åŒ–æµ‹è¯•ç”¨ä¾‹è®¾è®¡æ¨¡æ¿ï¼Œç¡®ä¿æµ‹è¯•ç”¨ä¾‹çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚

---

## ğŸ§ª å•å…ƒæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

### åç«¯Goå•å…ƒæµ‹è¯•æ¨¡æ¿

```go
// æ–‡ä»¶: internal/handler/user/user_test.go
package user

import (
    "testing"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/suite"
)

// æµ‹è¯•å¥—ä»¶ç»“æ„
type UserHandlerTestSuite struct {
    suite.Suite
    handler *Handler
    mockDB  *gorm.DB
}

// æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿
func (suite *UserHandlerTestSuite) TestRegister() {
    // Given - å‡†å¤‡æµ‹è¯•æ•°æ®
    testCases := []struct {
        name           string
        input          RegisterRequest
        expectedStatus int
        expectedError  string
        setupMock      func()
    }{
        {
            name: "æˆåŠŸæ³¨å†Œæ–°ç”¨æˆ·",
            input: RegisterRequest{
                Username: "testuser",
                Email:    "test@example.com",
                Password: "password123",
            },
            expectedStatus: 200,
            expectedError:  "",
            setupMock: func() {
                // è®¾ç½®MockæœŸæœ›
            },
        },
        {
            name: "ç”¨æˆ·åå·²å­˜åœ¨",
            input: RegisterRequest{
                Username: "existuser",
                Email:    "exist@example.com", 
                Password: "password123",
            },
            expectedStatus: 400,
            expectedError:  "ç”¨æˆ·åå·²å­˜åœ¨",
            setupMock: func() {
                // è®¾ç½®Mockè¿”å›ç”¨æˆ·å·²å­˜åœ¨
            },
        },
    }

    // When & Then - æ‰§è¡Œæµ‹è¯•å¹¶éªŒè¯ç»“æœ
    for _, tc := range testCases {
        suite.Run(tc.name, func() {
            tc.setupMock()
            
            // æ‰§è¡Œæµ‹è¯•
            result := suite.handler.Register(tc.input)
            
            // éªŒè¯ç»“æœ
            assert.Equal(suite.T(), tc.expectedStatus, result.Status)
            if tc.expectedError != "" {
                assert.Contains(suite.T(), result.Error, tc.expectedError)
            }
        })
    }
}
```

### å‰ç«¯Reactå•å…ƒæµ‹è¯•æ¨¡æ¿

```typescript
// æ–‡ä»¶: src/components/business/ProductCard.test.tsx
import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { Provider } from 'react-redux';
import { configureStore } from '@reduxjs/toolkit';
import ProductCard from './ProductCard';
import { Product } from '@/types';

// æµ‹è¯•æ•°æ®å‡†å¤‡
const mockProduct: Product = {
  id: 1,
  name: 'æµ‹è¯•å•†å“',
  price: '99.99',
  description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å•†å“',
  images: ['/test-image.jpg'],
  stock: 10,
};

// Mock Storeé…ç½®
const createMockStore = (initialState = {}) => {
  return configureStore({
    reducer: {
      cart: (state = { items: [] }) => state,
      auth: (state = { isAuthenticated: true }) => state,
    },
    preloadedState: initialState,
  });
};

describe('ProductCardç»„ä»¶æµ‹è¯•', () => {
  let mockStore: ReturnType<typeof createMockStore>;
  let mockOnAddToCart: jest.Mock;

  beforeEach(() => {
    mockStore = createMockStore();
    mockOnAddToCart = jest.fn();
  });

  afterEach(() => {
    jest.clearAllMocks();
  });

  test('åº”è¯¥æ­£ç¡®æ¸²æŸ“å•†å“ä¿¡æ¯', () => {
    // Given
    render(
      <Provider store={mockStore}>
        <ProductCard 
          product={mockProduct} 
          onAddToCart={mockOnAddToCart}
        />
      </Provider>
    );

    // Then
    expect(screen.getByText('æµ‹è¯•å•†å“')).toBeInTheDocument();
    expect(screen.getByText('Â¥99.99')).toBeInTheDocument();
    expect(screen.getByText('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å•†å“')).toBeInTheDocument();
  });

  test('ç‚¹å‡»æ·»åŠ è´­ç‰©è½¦æŒ‰é’®åº”è¯¥è°ƒç”¨å›è°ƒå‡½æ•°', async () => {
    // Given
    render(
      <Provider store={mockStore}>
        <ProductCard 
          product={mockProduct} 
          onAddToCart={mockOnAddToCart}
        />
      </Provider>
    );

    // When
    const addButton = screen.getByRole('button', { name: /æ·»åŠ åˆ°è´­ç‰©è½¦/i });
    fireEvent.click(addButton);

    // Then
    await waitFor(() => {
      expect(mockOnAddToCart).toHaveBeenCalledWith(mockProduct);
    });
  });
});
```

---

## ğŸ”— é›†æˆæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

### APIé›†æˆæµ‹è¯•æ¨¡æ¿

```go
// æ–‡ä»¶: tests/integration/user_api_test.go
package integration

import (
    "bytes"
    "encoding/json"
    "net/http"
    "net/http/httptest"
    "testing"
    
    "github.com/gin-gonic/gin"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/suite"
)

type UserAPITestSuite struct {
    suite.Suite
    router *gin.Engine
    db     *gorm.DB
}

func (suite *UserAPITestSuite) SetupSuite() {
    // åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“
    suite.db = setupTestDB()
    
    // åˆå§‹åŒ–è·¯ç”±
    suite.router = setupTestRouter(suite.db)
}

func (suite *UserAPITestSuite) TearDownSuite() {
    // æ¸…ç†æµ‹è¯•æ•°æ®åº“
    cleanupTestDB(suite.db)
}

func (suite *UserAPITestSuite) TestUserRegistrationFlow() {
    testCases := []struct {
        name           string
        endpoint       string
        method         string
        payload        interface{}
        expectedStatus int
        expectedFields []string
        setupData      func()
        cleanupData    func()
    }{
        {
            name:     "ç”¨æˆ·æ³¨å†ŒæˆåŠŸ",
            endpoint: "/api/v1/users/register",
            method:   "POST",
            payload: map[string]interface{}{
                "username": "newuser",
                "email":    "newuser@example.com",
                "password": "password123",
            },
            expectedStatus: 200,
            expectedFields: []string{"token", "user"},
            setupData:      func() {},
            cleanupData:    func() { suite.cleanupUser("newuser") },
        },
    }

    for _, tc := range testCases {
        suite.Run(tc.name, func() {
            // Setup
            tc.setupData()
            defer tc.cleanupData()

            // Prepare request
            jsonPayload, _ := json.Marshal(tc.payload)
            req := httptest.NewRequest(tc.method, tc.endpoint, bytes.NewBuffer(jsonPayload))
            req.Header.Set("Content-Type", "application/json")
            
            // Execute
            w := httptest.NewRecorder()
            suite.router.ServeHTTP(w, req)

            // Assert
            assert.Equal(suite.T(), tc.expectedStatus, w.Code)
            
            var response map[string]interface{}
            json.Unmarshal(w.Body.Bytes(), &response)
            
            for _, field := range tc.expectedFields {
                assert.Contains(suite.T(), response, field)
            }
        })
    }
}
```

---

## ğŸ­ ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

### Cypress E2Eæµ‹è¯•æ¨¡æ¿

```typescript
// æ–‡ä»¶: cypress/e2e/user-shopping-flow.cy.ts
describe('ç”¨æˆ·è´­ç‰©æµç¨‹E2Eæµ‹è¯•', () => {
  beforeEach(() => {
    // é‡ç½®æ•°æ®åº“çŠ¶æ€
    cy.task('db:seed');
    
    // è®¿é—®é¦–é¡µ
    cy.visit('/');
  });

  afterEach(() => {
    // æ¸…ç†æµ‹è¯•æ•°æ®
    cy.task('db:cleanup');
  });

  it('å®Œæ•´çš„ç”¨æˆ·è´­ç‰©æµç¨‹', () => {
    // Step 1: ç”¨æˆ·æ³¨å†Œ
    cy.get('[data-testid="register-link"]').click();
    cy.get('[data-testid="username-input"]').type('testuser');
    cy.get('[data-testid="email-input"]').type('test@example.com');
    cy.get('[data-testid="password-input"]').type('password123');
    cy.get('[data-testid="register-button"]').click();
    
    // éªŒè¯æ³¨å†ŒæˆåŠŸ
    cy.url().should('include', '/login');
    cy.contains('æ³¨å†ŒæˆåŠŸ').should('be.visible');

    // Step 2: ç”¨æˆ·ç™»å½•
    cy.get('[data-testid="username-input"]').type('testuser');
    cy.get('[data-testid="password-input"]').type('password123');
    cy.get('[data-testid="login-button"]').click();
    
    // éªŒè¯ç™»å½•æˆåŠŸ
    cy.url().should('eq', Cypress.config().baseUrl + '/');
    cy.get('[data-testid="user-avatar"]').should('be.visible');

    // Step 3: æµè§ˆå•†å“
    cy.get('[data-testid="product-card"]').first().click();
    cy.url().should('include', '/products/');
    
    // Step 4: æ·»åŠ åˆ°è´­ç‰©è½¦
    cy.get('[data-testid="add-to-cart-button"]').click();
    cy.contains('å·²æ·»åŠ åˆ°è´­ç‰©è½¦').should('be.visible');
    
    // Step 5: æŸ¥çœ‹è´­ç‰©è½¦
    cy.get('[data-testid="cart-icon"]').click();
    cy.url().should('include', '/cart');
    cy.get('[data-testid="cart-item"]').should('have.length', 1);
    
    // Step 6: ç»“ç®—ä¸‹å•
    cy.get('[data-testid="checkout-button"]').click();
    cy.url().should('include', '/checkout');
    
    // å¡«å†™æ”¶è´§åœ°å€
    cy.get('[data-testid="address-name"]').type('å¼ ä¸‰');
    cy.get('[data-testid="address-phone"]').type('13800138000');
    cy.get('[data-testid="address-detail"]').type('æµ‹è¯•åœ°å€');
    
    // é€‰æ‹©æ”¯ä»˜æ–¹å¼
    cy.get('[data-testid="payment-alipay"]').click();
    
    // æäº¤è®¢å•
    cy.get('[data-testid="submit-order-button"]').click();
    
    // éªŒè¯è®¢å•åˆ›å»ºæˆåŠŸ
    cy.url().should('include', '/orders/');
    cy.contains('è®¢å•åˆ›å»ºæˆåŠŸ').should('be.visible');
  });

  it('è´­ç‰©è½¦æ“ä½œæµç¨‹', () => {
    // å‰ç½®æ¡ä»¶ï¼šç”¨æˆ·å·²ç™»å½•
    cy.login('testuser', 'password123');
    
    // æ·»åŠ å¤šä¸ªå•†å“åˆ°è´­ç‰©è½¦
    cy.visit('/products');
    cy.get('[data-testid="product-card"]').first().within(() => {
      cy.get('[data-testid="add-to-cart"]').click();
    });
    
    cy.get('[data-testid="product-card"]').eq(1).within(() => {
      cy.get('[data-testid="add-to-cart"]').click();
    });
    
    // æŸ¥çœ‹è´­ç‰©è½¦
    cy.visit('/cart');
    cy.get('[data-testid="cart-item"]').should('have.length', 2);
    
    // ä¿®æ”¹å•†å“æ•°é‡
    cy.get('[data-testid="quantity-input"]').first().clear().type('3');
    cy.get('[data-testid="update-quantity"]').first().click();
    
    // éªŒè¯æ€»ä»·æ›´æ–°
    cy.get('[data-testid="total-amount"]').should('contain', '297.00');
    
    // åˆ é™¤å•†å“
    cy.get('[data-testid="remove-item"]').first().click();
    cy.get('[data-testid="confirm-remove"]').click();
    
    // éªŒè¯å•†å“å·²åˆ é™¤
    cy.get('[data-testid="cart-item"]').should('have.length', 1);
  });
});
```

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

### Go Benchmarkæµ‹è¯•æ¨¡æ¿

```go
// æ–‡ä»¶: pkg/auth/jwt_test.go
package auth

import (
    "testing"
)

func BenchmarkGenerateToken(b *testing.B) {
    authService := NewAuthService("test-secret")
    user := &User{ID: 1, Username: "testuser"}
    
    b.ResetTimer()
    for i := 0; i < b.N; i++ {
        _, err := authService.GenerateToken(user)
        if err != nil {
            b.Fatal(err)
        }
    }
}

func BenchmarkValidateToken(b *testing.B) {
    authService := NewAuthService("test-secret")
    user := &User{ID: 1, Username: "testuser"}
    token, _ := authService.GenerateToken(user)
    
    b.ResetTimer()
    for i := 0; i < b.N; i++ {
        _, err := authService.ValidateToken(token)
        if err != nil {
            b.Fatal(err)
        }
    }
}
```

### Artilleryè´Ÿè½½æµ‹è¯•é…ç½®æ¨¡æ¿

```yaml
# æ–‡ä»¶: tests/performance/load-test.yml
config:
  target: 'http://localhost:8080'
  phases:
    - duration: 60
      arrivalRate: 10
      name: "é¢„çƒ­é˜¶æ®µ"
    - duration: 300
      arrivalRate: 50
      name: "è´Ÿè½½æµ‹è¯•"
    - duration: 120
      arrivalRate: 100
      name: "å‹åŠ›æµ‹è¯•"
  defaults:
    headers:
      Content-Type: 'application/json'

scenarios:
  - name: "ç”¨æˆ·ç™»å½•æµç¨‹"
    weight: 30
    flow:
      - post:
          url: "/api/v1/users/login"
          json:
            username: "testuser"
            password: "password123"
          capture:
            - json: "$.token"
              as: "authToken"
      - get:
          url: "/api/v1/users/profile"
          headers:
            Authorization: "Bearer {{ authToken }}"

  - name: "å•†å“æŸ¥è¯¢æµç¨‹"
    weight: 50
    flow:
      - get:
          url: "/api/v1/products"
          qs:
            page: 1
            page_size: 20
      - get:
          url: "/api/v1/products/{{ $randomInt(1, 100) }}"

  - name: "è´­ç‰©è½¦æ“ä½œæµç¨‹"
    weight: 20
    flow:
      - post:
          url: "/api/v1/users/login"
          json:
            username: "testuser"
            password: "password123"
          capture:
            - json: "$.token"
              as: "authToken"
      - post:
          url: "/api/v1/cart/items"
          headers:
            Authorization: "Bearer {{ authToken }}"
          json:
            product_id: "{{ $randomInt(1, 100) }}"
            quantity: 1
```

---

## ğŸ“ æµ‹è¯•ç”¨ä¾‹ç¼–å†™è§„èŒƒ

### å‘½åè§„èŒƒ
- **æµ‹è¯•æ–‡ä»¶**: `{æ¨¡å—å}_test.{æ‰©å±•å}`
- **æµ‹è¯•å‡½æ•°**: `Test{åŠŸèƒ½å}_{åœºæ™¯æè¿°}`
- **æµ‹è¯•å¥—ä»¶**: `{æ¨¡å—å}TestSuite`

### æµ‹è¯•ç»“æ„è§„èŒƒ
1. **Given** - å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ
2. **When** - æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
3. **Then** - éªŒè¯ç»“æœå’Œæ–­è¨€

### æ–­è¨€è§„èŒƒ
- ä½¿ç”¨æ˜ç¡®çš„æ–­è¨€æ¶ˆæ¯
- éªŒè¯å…³é”®ä¸šåŠ¡é€»è¾‘
- åŒ…å«è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- è¦†ç›–å¼‚å¸¸æƒ…å†µ

### æ•°æ®ç®¡ç†è§„èŒƒ
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®
- æµ‹è¯•å‰å‡†å¤‡ï¼Œæµ‹è¯•åæ¸…ç†
- ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºæµ‹è¯•æ•°æ®
- é¿å…æµ‹è¯•ç”¨ä¾‹é—´çš„æ•°æ®ä¾èµ–

---

**æ¨¡æ¿çŠ¶æ€**: âœ… å®Œæˆ  
**é€‚ç”¨èŒƒå›´**: Mall-Goç”µå•†ç³»ç»Ÿå…¨æ¨¡å—  
**ç»´æŠ¤å‘¨æœŸ**: æ¯æœˆæ›´æ–°ä¸€æ¬¡
